import{j as e}from"./data-vendor-DN4GCDiI.js";import{r as n}from"./react-vendor-C5Agepg6.js";import{z as d,d as $,l as y,a2 as H,aP as j,m as B}from"./ui-vendor-B5EPSjh4.js";function Q(){const[l,i]=n.useState([]),[r,c]=n.useState(null),[D,f]=n.useState(!0),[O,x]=n.useState(!1),[N,L]=n.useState([]),[b,v]=n.useState(""),[k,w]=n.useState(""),[C,u]=n.useState(!1),[m,S]=n.useState(""),[g,E]=n.useState(0),[P,I]=n.useState("");n.useEffect(()=>{G(),T()},[]);const G=async()=>{try{f(!0);const t=[{id:"1",description:"Contagem Mensal - Janeiro 2025",location:"Depósito Principal",status:"IN_PROGRESS",createdAt:new Date().toISOString(),items:[]}];i(t)}catch{d.error("Erro ao carregar contagens")}finally{f(!1)}},T=async()=>{try{L([{id:"1",name:"Luva Descartável P",sku:"LUV-001-P",currentStock:150,unit:"un"},{id:"2",name:"Máscara Cirúrgica",sku:"MASK-002",currentStock:200,unit:"un"}])}catch(t){console.error("Erro ao carregar produtos:",t)}},M=async()=>{if(!b.trim()){d.error("Descrição é obrigatória");return}try{const t={id:Date.now().toString(),description:b,location:k,status:"IN_PROGRESS",createdAt:new Date().toISOString(),items:[]};i([t,...l]),v(""),w(""),x(!1),d.success("Contagem criada com sucesso!")}catch{d.error("Erro ao criar contagem")}},R=t=>{c(t),u(!1)},_=async()=>{if(!r||!m||g===void 0){d.error("Selecione um produto e informe a quantidade contada");return}try{const t=N.find(p=>p.id===m);if(!t)return;const a=g-t.currentStock;let s;a>0?s="SURPLUS":a<0?s="SHORTAGE":s="MATCH";const h={id:Date.now().toString(),productId:m,product:{name:t.name,unit:t.unit},systemStock:t.currentStock,countedStock:g,difference:a,discrepancyType:s,adjusted:!1,notes:P},o={...r,items:[...r.items,h]};c(o),i(l.map(p=>p.id===r.id?o:p)),S(""),E(0),I(""),u(!1),d.success("Item adicionado à contagem")}catch{d.error("Erro ao adicionar item")}},z=t=>{if(!r)return;const a={...r,items:r.items.filter(s=>s.id!==t)};c(a),i(l.map(s=>s.id===r.id?a:s)),d.success("Item removido")},q=async t=>{if(!r)return;const a=r.items.find(s=>s.id===t);if(a)try{const s={...a,adjusted:!0},h={...r,items:r.items.map(o=>o.id===t?s:o)};c(h),i(l.map(o=>o.id===r.id?h:o)),d.success("Item ajustado no estoque")}catch{d.error("Erro ao ajustar item")}},F=async()=>{if(!r)return;const t=r.items.filter(a=>!a.adjusted).length;if(t>0){d.error(`Ajuste todos os ${t} itens antes de finalizar`);return}try{const a={...r,status:"COMPLETED",completedAt:new Date().toISOString()};c(a),i(l.map(s=>s.id===r.id?a:s)),d.success("Contagem finalizada!")}catch{d.error("Erro ao finalizar contagem")}},A=t=>{switch(t){case"IN_PROGRESS":return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case"COMPLETED":return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case"CANCELLED":return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400";default:return"bg-gray-100 text-gray-800"}},U=t=>{switch(t){case"SURPLUS":return"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-700";case"SHORTAGE":return"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-700";case"MATCH":return"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-700";default:return"bg-gray-50 border-gray-200"}};return D?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):r?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>c(null),className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white",children:"← Voltar"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:r.description}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${A(r.status)}`,children:r.status==="IN_PROGRESS"?"Em Andamento":r.status==="COMPLETED"?"Concluída":"Cancelada"})]}),r.status==="IN_PROGRESS"&&e.jsxs("button",{onClick:F,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx($,{className:"h-5 w-5 inline mr-2"}),"Finalizar Contagem"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600 dark:text-gray-400",children:[r.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Local:"})," ",r.location]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Criado em:"})," ",new Date(r.createdAt).toLocaleString("pt-BR")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Itens:"})," ",r.items.length]})]})]}),r.status==="IN_PROGRESS"&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>u(!C),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(y,{className:"h-5 w-5 inline mr-2"}),"Adicionar Produto"]})}),C&&r.status==="IN_PROGRESS"&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-xl p-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white mb-4",children:"Adicionar Produto à Contagem"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Produto"}),e.jsxs("select",{value:m,onChange:t=>S(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),N.map(t=>e.jsxs("option",{value:t.id,children:[t.name," - Estoque: ",t.currentStock," ",t.unit]},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quantidade Contada"}),e.jsx("input",{type:"number",min:"0",step:"1",value:g,onChange:t=>E(parseFloat(t.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Observações"}),e.jsx("input",{type:"text",value:P,onChange:t=>I(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",placeholder:"Opcional"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900",children:"Cancelar"}),e.jsxs("button",{onClick:_,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(H,{className:"h-5 w-5 inline mr-2"}),"Salvar"]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Produtos Contados"}),r.items.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(j,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:'Nenhum produto adicionado ainda. Clique em "Adicionar Produto" para começar.'})]}):e.jsx("div",{className:"space-y-3",children:r.items.map(t=>e.jsx("div",{className:`border-2 rounded-lg p-4 ${U(t.discrepancyType)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-white mb-2",children:[t.product.name,t.adjusted&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-600 text-white rounded-full",children:"✓ Ajustado"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Sistema:"}),e.jsxs("span",{className:"font-medium ml-1",children:[t.systemStock," ",t.product.unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Contado:"}),e.jsxs("span",{className:"font-medium ml-1",children:[t.countedStock," ",t.product.unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Diferença:"}),e.jsxs("span",{className:`font-bold ml-1 ${t.difference>0?"text-green-600":t.difference<0?"text-red-600":"text-blue-600"}`,children:[t.difference>0?"+":"",t.difference," ",t.product.unit]})]})]}),t.notes&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2 italic",children:t.notes})]}),e.jsx("div",{className:"flex space-x-2 ml-4",children:!t.adjusted&&r.status==="IN_PROGRESS"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>q(t.id),className:"px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700",children:"Ajustar"}),e.jsx("button",{onClick:()=>z(t.id),className:"px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700",children:e.jsx(B,{className:"h-4 w-4"})})]})})]})},t.id))})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 border border-purple-100 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"h-12 w-12 bg-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(j,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Contagem de Inventário"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"Realize contagens físicas do estoque e ajuste divergências automaticamente"})]}),e.jsxs("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(y,{className:"h-5 w-5 inline mr-2"}),"Nova Contagem"]})]})}),O&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Nova Contagem de Inventário"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Descrição *"}),e.jsx("input",{type:"text",value:b,onChange:t=>v(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-gray-900 bg-white",placeholder:"Ex: Contagem Mensal - Janeiro 2025"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Local"}),e.jsx("input",{type:"text",value:k,onChange:t=>w(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-gray-900 bg-white",placeholder:"Ex: Depósito Principal"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:()=>x(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900",children:"Cancelar"}),e.jsx("button",{onClick:M,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Criar Contagem"})]})]}),l.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-12 border border-gray-100 dark:border-gray-700 text-center",children:[e.jsx(j,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhuma contagem cadastrada"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Crie sua primeira contagem de inventário para começar"}),e.jsxs("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(y,{className:"h-5 w-5 inline mr-2"}),"Nova Contagem"]})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:l.map(t=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>R(t),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:t.description}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${A(t.status)}`,children:t.status==="IN_PROGRESS"?"Em Andamento":t.status==="COMPLETED"?"Concluída":"Cancelada"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-gray-600 dark:text-gray-400",children:[t.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Local:"})," ",t.location]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Itens:"})," ",t.items.length]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Criado em:"})," ",new Date(t.createdAt).toLocaleDateString("pt-BR")]})]})]}),e.jsx("button",{onClick:a=>{a.stopPropagation(),R(t)},className:"ml-4 text-blue-600 dark:text-blue-400 hover:text-blue-700 font-medium",children:"Gerenciar →"})]})},t.id))})]})}export{Q as default};
