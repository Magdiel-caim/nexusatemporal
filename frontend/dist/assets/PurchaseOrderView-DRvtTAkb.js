import{j as e}from"./data-vendor-CPXAi296.js";import{r as c}from"./react-vendor-B1IcTyqJ.js";import{f as m}from"./index-CU5-6mn9.js";import{ai as i,X as q,l as O,m as E,n as F,S as T,ar as S,t as A,az as R,b6 as z,d as B,e as _}from"./ui-vendor-CmqegqKX.js";function L({orderId:l,onClose:h,onSuccess:D}){const[j,p]=c.useState(!1),[f,N]=c.useState([]),[d,x]=c.useState({supplierId:"",orderDate:new Date().toISOString().split("T")[0],expectedDeliveryDate:"",priority:"normal",notes:""}),[n,o]=c.useState([{description:"",quantity:1,unitPrice:0,totalPrice:0}]);c.useEffect(()=>{y(),l&&u()},[l]);const y=async()=>{try{const a=await m.getSuppliers({isActive:!0});N(a)}catch(a){i.error("Erro ao carregar fornecedores: "+a.message)}},u=async()=>{var a;if(l)try{p(!0);const r=(await m.getPurchaseOrders({})).find(s=>s.id===l);r&&(x({supplierId:r.supplierId,orderDate:r.orderDate.split("T")[0],expectedDeliveryDate:((a=r.expectedDeliveryDate)==null?void 0:a.split("T")[0])||"",priority:r.priority,notes:r.notes||""}),o(r.items.map(s=>({description:s.description,quantity:s.quantity,unitPrice:s.unitPrice,totalPrice:s.totalPrice}))))}catch(t){i.error("Erro ao carregar ordem: "+t.message)}finally{p(!1)}},b=(a,t,r)=>{const s=[...n];if(s[a]={...s[a],[t]:r},t==="quantity"||t==="unitPrice"){const g=t==="quantity"?Number(r):s[a].quantity,I=t==="unitPrice"?Number(r):s[a].unitPrice;s[a].totalPrice=g*I}o(s)},P=()=>{o([...n,{description:"",quantity:1,unitPrice:0,totalPrice:0}])},C=a=>{if(n.length===1){i.error("Deve haver pelo menos um item");return}o(n.filter((t,r)=>r!==a))},v=()=>n.reduce((a,t)=>a+t.totalPrice,0),k=async a=>{if(a.preventDefault(),!d.supplierId){i.error("Selecione um fornecedor");return}if(n.some(t=>!t.description||t.quantity<=0||t.unitPrice<=0)){i.error("Preencha todos os itens corretamente");return}try{p(!0);const t={supplierId:d.supplierId,orderDate:d.orderDate,expectedDeliveryDate:d.expectedDeliveryDate||void 0,priority:d.priority,notes:d.notes||void 0,items:n.map(r=>({description:r.description,quantity:r.quantity,unitPrice:r.unitPrice,totalPrice:r.totalPrice})),totalAmount:v()};l?(await m.updatePurchaseOrder(l,t),i.success("Ordem atualizada com sucesso!")):(await m.createPurchaseOrder(t),i.success("Ordem criada com sucesso!")),D(),h()}catch(t){i.error("Erro ao salvar ordem: "+t.message)}finally{p(!1)}},w=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a);return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-center justify-center p-4",children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50",onClick:h}),e.jsxs("div",{className:"relative bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-4xl w-full p-6 max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:l?"Editar Ordem de Compra":"Nova Ordem de Compra"}),e.jsx("button",{onClick:h,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:e.jsx(q,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:k,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Fornecedor *"}),e.jsxs("select",{value:d.supplierId,onChange:a=>x({...d,supplierId:a.target.value}),required:!0,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm",children:[e.jsx("option",{value:"",children:"Selecione..."}),f.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Prioridade *"}),e.jsxs("select",{value:d.priority,onChange:a=>x({...d,priority:a.target.value}),required:!0,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm",children:[e.jsx("option",{value:"baixa",children:"Baixa"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"alta",children:"Alta"}),e.jsx("option",{value:"urgente",children:"Urgente"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Data do Pedido *"}),e.jsx("input",{type:"date",value:d.orderDate,onChange:a=>x({...d,orderDate:a.target.value}),required:!0,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Data de Entrega Prevista"}),e.jsx("input",{type:"date",value:d.expectedDeliveryDate,onChange:a=>x({...d,expectedDeliveryDate:a.target.value}),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Observações"}),e.jsx("textarea",{value:d.notes,onChange:a=>x({...d,notes:a.target.value}),rows:3,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm",placeholder:"Informações adicionais..."})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Itens da Ordem *"}),e.jsxs("button",{type:"button",onClick:P,className:"inline-flex items-center px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Adicionar Item"]})]}),e.jsx("div",{className:"space-y-3",children:n.map((a,t)=>e.jsxs("div",{className:"flex gap-2 items-start p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-4 gap-2",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx("input",{type:"text",value:a.description,onChange:r=>b(t,"description",r.target.value),placeholder:"Descrição do item *",required:!0,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm text-sm"})}),e.jsx("div",{children:e.jsx("input",{type:"number",value:a.quantity,onChange:r=>b(t,"quantity",r.target.value),placeholder:"Qtd *",min:"1",required:!0,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm text-sm"})}),e.jsx("div",{children:e.jsx("input",{type:"number",value:a.unitPrice,onChange:r=>b(t,"unitPrice",r.target.value),placeholder:"Preço Unit. *",min:"0",step:"0.01",required:!0,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm text-sm"})})]}),e.jsx("div",{className:"w-32",children:e.jsx("input",{type:"text",value:w(a.totalPrice),disabled:!0,className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white shadow-sm text-sm font-medium"})}),n.length>1&&e.jsx("button",{type:"button",onClick:()=>C(t),className:"p-2 text-red-600 hover:text-red-800 dark:text-red-400",children:e.jsx(E,{className:"w-4 h-4"})})]},t))}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex justify-end items-center gap-4",children:[e.jsx("span",{className:"text-lg font-medium text-gray-700 dark:text-gray-300",children:"Total:"}),e.jsx("span",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:w(v())})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:h,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:j,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-md disabled:opacity-50",children:j?"Salvando...":l?"Atualizar Ordem":"Criar Ordem"})]})]})]})]})})}function X(){const[l,h]=c.useState([]),[D,j]=c.useState([]),[p,f]=c.useState(!0),[N,d]=c.useState(!1),[x,n]=c.useState(!1),[o,y]=c.useState({search:"",status:"",supplierId:"",priority:""});c.useEffect(()=>{u()},[]);const u=async()=>{try{f(!0);const[t,r]=await Promise.all([m.getPurchaseOrders({search:o.search||void 0,status:o.status||void 0,supplierId:o.supplierId||void 0,priority:o.priority||void 0}),m.getSuppliers({isActive:!0})]);h(t),j(r)}catch(t){i.error("Erro ao carregar ordens: "+t.message)}finally{f(!1)}},b=async t=>{try{await m.approvePurchaseOrder(t),i.success("Ordem aprovada!"),u()}catch(r){i.error("Erro: "+r.message)}},P=async t=>{try{await m.markPurchaseOrderInTransit(t),i.success("Marcado como em trânsito!"),u()}catch(r){i.error("Erro: "+r.message)}},C=async t=>{try{const r=l.find(g=>g.id===t);if(!r)return;const s=r.items.map(g=>({...g,receivedQuantity:g.quantity}));await m.receivePurchaseOrder(t,{items:s,receivedDate:new Date().toISOString()}),i.success("Ordem recebida!"),u()}catch(r){i.error("Erro: "+r.message)}},v=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),k=t=>new Date(t).toLocaleDateString("pt-BR"),w=t=>{const r={orcamento:{bg:"bg-gray-100 dark:bg-gray-700",text:"text-gray-800 dark:text-gray-200",label:"Orçamento",icon:e.jsx(_,{className:"w-4 h-4"})},aprovado:{bg:"bg-blue-100 dark:bg-blue-900",text:"text-blue-800 dark:text-blue-200",label:"Aprovado",icon:e.jsx(B,{className:"w-4 h-4"})},pedido_realizado:{bg:"bg-indigo-100 dark:bg-indigo-900",text:"text-indigo-800 dark:text-indigo-200",label:"Pedido Realizado",icon:e.jsx(S,{className:"w-4 h-4"})},em_transito:{bg:"bg-yellow-100 dark:bg-yellow-900",text:"text-yellow-800 dark:text-yellow-200",label:"Em Trânsito",icon:e.jsx(z,{className:"w-4 h-4"})},recebido:{bg:"bg-green-100 dark:bg-green-900",text:"text-green-800 dark:text-green-200",label:"Recebido",icon:e.jsx(R,{className:"w-4 h-4"})},cancelado:{bg:"bg-red-100 dark:bg-red-900",text:"text-red-800 dark:text-red-200",label:"Cancelado",icon:e.jsx(A,{className:"w-4 h-4"})}},s=r[t]||r.orcamento;return e.jsxs("span",{className:`inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ${s.bg} ${s.text}`,children:[s.icon,s.label]})},a=t=>{const r={baixa:"text-gray-600",normal:"text-blue-600",alta:"text-orange-600",urgente:"text-red-600"};return e.jsx("span",{className:`text-xs font-medium ${r[t]||r.normal}`,children:t.toUpperCase()})};return p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Ordens de Compra"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[l.length," ordem(ns)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>d(!N),className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Filtros"]}),e.jsxs("button",{onClick:()=>n(!0),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700",children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Nova Ordem"]})]})]}),N&&e.jsx("div",{className:"card p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:o.search,onChange:t=>y(r=>({...r,search:t.target.value})),placeholder:"Número, descrição...",className:"pl-10 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),e.jsxs("select",{value:o.status,onChange:t=>y(r=>({...r,status:t.target.value})),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"orcamento",children:"Orçamento"}),e.jsx("option",{value:"aprovado",children:"Aprovado"}),e.jsx("option",{value:"pedido_realizado",children:"Pedido Realizado"}),e.jsx("option",{value:"em_transito",children:"Em Trânsito"}),e.jsx("option",{value:"recebido",children:"Recebido"}),e.jsx("option",{value:"cancelado",children:"Cancelado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Fornecedor"}),e.jsxs("select",{value:o.supplierId,onChange:t=>y(r=>({...r,supplierId:t.target.value})),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm",children:[e.jsx("option",{value:"",children:"Todos"}),D.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:u,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Aplicar"})})]})}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:l.length===0?e.jsxs("div",{className:"card text-center py-12",children:[e.jsx(S,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Nenhuma ordem encontrada"})]}):l.map(t=>{var r;return e.jsxs("div",{className:"card p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.orderNumber}),w(t.status),a(t.priority)]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Fornecedor: ",((r=t.supplier)==null?void 0:r.name)||"N/A"]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:["Data: ",k(t.orderDate)," |",t.expectedDeliveryDate&&` Entrega prevista: ${k(t.expectedDeliveryDate)}`]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xl font-bold text-gray-900 dark:text-white",children:v(t.totalAmount)}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t.items.length," item(ns)"]})]})]}),e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Itens:"}),e.jsxs("div",{className:"space-y-1",children:[t.items.slice(0,3).map((s,g)=>e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[s.description," (x",s.quantity,")"]}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:v(s.totalPrice)})]},g)),t.items.length>3&&e.jsxs("p",{className:"text-xs text-gray-500",children:["+ ",t.items.length-3," mais..."]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 pt-3 border-t border-gray-200 dark:border-gray-700",children:[t.status==="orcamento"&&e.jsx("button",{onClick:()=>b(t.id),className:"text-xs px-3 py-1 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Aprovar"}),t.status==="pedido_realizado"&&e.jsx("button",{onClick:()=>P(t.id),className:"text-xs px-3 py-1 bg-yellow-600 text-white rounded hover:bg-yellow-700",children:"Em Trânsito"}),t.status==="em_transito"&&e.jsx("button",{onClick:()=>C(t.id),className:"text-xs px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700",children:"Receber"})]})]},t.id)})}),x&&e.jsx(L,{onClose:()=>n(!1),onSuccess:u})]})}export{X as default};
