import{j as t}from"./data-vendor-DkslvP0H.js";import{r as c}from"./react-vendor-C5Agepg6.js";import{A as T,s as d,E as D,b as k}from"./index-DNdWYF4P.js";import{z as o,F as C,d as F,a5 as I}from"./ui-vendor-CNf7S7pz.js";function q({refreshKey:b,onRefresh:u}){const[l,y]=c.useState([]),[f,m]=c.useState(!0),[a,v]=c.useState(T.ACTIVE);c.useEffect(()=>{j()},[b,a]);const j=async()=>{try{m(!0);const e=await d.getAlerts({status:a||void 0,limit:100});y(e.data||[])}catch(e){console.error("Erro ao carregar alertas:",e),o.error("Erro ao carregar alertas")}finally{m(!1)}},N=async e=>{const s=prompt("Digite a resolução do alerta:");if(s)try{await d.resolveAlert(e.id,s),o.success("Alerta resolvido com sucesso!"),u()}catch{o.error("Erro ao resolver alerta")}},S=async e=>{if(confirm("Tem certeza que deseja ignorar este alerta?"))try{await d.ignoreAlert(e.id),o.success("Alerta ignorado"),u()}catch{o.error("Erro ao ignorar alerta")}},w=e=>{switch(e){case"LOW_STOCK":return"bg-yellow-100 text-yellow-800 border-yellow-200";case"OUT_OF_STOCK":return"bg-red-100 text-red-800 border-red-200";case"EXPIRING_SOON":return"bg-orange-100 text-orange-800 border-orange-200";case"EXPIRED":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-blue-100 text-blue-800 border-blue-200"}},E=()=>{try{const e=new D;e.setFontSize(18),e.text("Relatório de Alertas de Estoque",14,20),e.setFontSize(11);const s=new Date().toLocaleString("pt-BR");e.text(`Gerado em: ${s}`,14,28);const n=a?`Status: ${a==="ACTIVE"?"Ativos":a==="RESOLVED"?"Resolvidos":"Ignorados"}`:"Todos os status";e.text(`Filtro: ${n}`,14,34);const i=l.map(r=>{var p,g,h;return[((p=r.product)==null?void 0:p.name)||"N/A",r.type.replace("_"," "),r.status,r.currentStock!==void 0?`${r.currentStock} ${((g=r.product)==null?void 0:g.unit)||""}`:"N/A",r.minimumStock?`${r.minimumStock} ${((h=r.product)==null?void 0:h.unit)||""}`:"N/A",new Date(r.createdAt).toLocaleDateString("pt-BR")]});k(e,{startY:40,head:[["Produto","Tipo","Status","Estoque Atual","Estoque Mínimo","Data"]],body:i,theme:"striped",headStyles:{fillColor:[59,130,246]},styles:{fontSize:9},columnStyles:{0:{cellWidth:50},1:{cellWidth:35},2:{cellWidth:25},3:{cellWidth:25},4:{cellWidth:25},5:{cellWidth:25}}});const A=e.lastAutoTable.finalY||40;e.setFontSize(11),e.text(`Total de alertas: ${l.length}`,14,A+10);const x=`alertas_${new Date().toISOString().split("T")[0]}.pdf`;e.save(x),o.success(`Arquivo ${x} exportado com sucesso!`)}catch(e){console.error("Erro ao exportar PDF:",e),o.error("Erro ao exportar arquivo PDF")}};return f?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t.jsxs("div",{className:"space-y-4",children:[t.jsx("div",{className:"flex justify-end",children:t.jsxs("button",{onClick:E,disabled:l.length===0,className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",title:"Exportar lista de alertas para PDF",children:[t.jsx(C,{className:"h-5 w-5 mr-2"}),"Exportar PDF"]})}),t.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 border border-gray-100 dark:border-gray-700",children:t.jsxs("select",{value:a,onChange:e=>v(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[t.jsx("option",{value:"",children:"Todos os status"}),t.jsx("option",{value:"ACTIVE",children:"Ativos"}),t.jsx("option",{value:"RESOLVED",children:"Resolvidos"}),t.jsx("option",{value:"IGNORED",children:"Ignorados"})]})}),l.length===0?t.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-12 border border-gray-100 text-center",children:[t.jsx(F,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Nenhum alerta encontrado"}),t.jsx("p",{className:"text-gray-600",children:"Todos os itens estão dentro dos parâmetros normais"})]}):t.jsx("div",{className:"space-y-3",children:l.map(e=>{var s,n,i;return t.jsx("div",{className:`rounded-xl shadow-sm p-6 border-2 ${w(e.type)}`,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[t.jsx(I,{className:"h-5 w-5"}),t.jsx("h3",{className:"font-bold text-lg",children:(s=e.product)==null?void 0:s.name}),t.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-white bg-opacity-50",children:e.type.replace("_"," ")})]}),t.jsx("p",{className:"text-sm mb-3",children:e.message}),e.currentStock!==void 0&&t.jsxs("p",{className:"text-sm font-medium",children:["Estoque atual: ",e.currentStock," ",(n=e.product)==null?void 0:n.unit,e.minimumStock&&` • Mínimo: ${e.minimumStock} ${(i=e.product)==null?void 0:i.unit}`]}),t.jsxs("p",{className:"text-xs mt-2 opacity-75",children:["Criado em: ",new Date(e.createdAt).toLocaleString("pt-BR")]})]}),e.status==="ACTIVE"&&t.jsxs("div",{className:"flex space-x-2 ml-4",children:[t.jsx("button",{onClick:()=>N(e),className:"px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700 transition-colors",children:"Resolver"}),t.jsx("button",{onClick:()=>S(e),className:"px-3 py-1 bg-gray-600 text-white text-sm rounded-lg hover:bg-gray-700 transition-colors",children:"Ignorar"})]})]})},e.id)})})]})}export{q as default};
