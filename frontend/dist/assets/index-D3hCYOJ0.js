var On=Object.defineProperty;var Mn=(t,e,s)=>e in t?On(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var Qs=(t,e,s)=>Mn(t,typeof e!="symbol"?e+"":e,s);import{a as Ln,c as Dn,j as r,Q as Pn,b as In}from"./data-vendor-C706I2UW.js";import{a as Fe,r as u,u as Vt,L as Mt,R as Y,b as Tr,N as _r,B as Bn,c as Wn,d as re}from"./react-vendor-CDqR2DTq.js";import{z as O,U as ls,a as qn,T as Fn,b as $n,D as Or,B as Ks,A as Vn,c as Gs,C as ds,d as zn,X as ut,e as Ge,f as us,g as Xe,h as ks,M as Lt,i as Mr,j as Un,k as Cs,P as zt,F as Lr,l as Yn,m as Hn,S as Dr,n as Xn,o as Qn,L as Kn,p as Gn,q as Jn,r as hs,s as Js,t as Zn,Q as ea,R as ta,V as sa,u as ra,v as na,w as aa,x as oa,I as ia,y as ca,E as la,G as da,H as Zs,J as ua,K as ha,N as ma,O as fa,W as ga,Y as pa,Z as xa,_ as er,$ as ya}from"./ui-vendor-BuE8vdtU.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();var ms={},tr=Fe;ms.createRoot=tr.createRoot,ms.hydrateRoot=tr.hydrateRoot;const ba="https://api.nexusatemporal.com.br/api",j=Ln.create({baseURL:ba,headers:{"Content-Type":"application/json"}});j.interceptors.request.use(t=>{const e=localStorage.getItem("token");return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));j.interceptors.response.use(t=>t,t=>{var e,s,n;return((e=t.response)==null?void 0:e.status)===401?(localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/login",O.error("Sess√£o expirada. Fa√ßa login novamente.")):((s=t.response)==null?void 0:s.status)===403?O.error("Voc√™ n√£o tem permiss√£o para acessar este recurso."):((n=t.response)==null?void 0:n.status)>=500&&O.error("Erro no servidor. Tente novamente mais tarde."),Promise.reject(t)});const he={async login(t){const{data:e}=await j.post("/auth/login",t);return{user:e.data.user,token:e.data.accessToken,refreshToken:e.data.refreshToken}},async register(t){const{data:e}=await j.post("/auth/register",t);return{user:e.data,token:"",refreshToken:""}},async logout(){await j.post("/auth/logout"),localStorage.removeItem("token"),localStorage.removeItem("user")},async getProfile(){const{data:t}=await j.get("/auth/profile");return t},async refreshToken(t){const{data:e}=await j.post("/auth/refresh",{refreshToken:t});return e},async forgotPassword(t){await j.post("/auth/forgot-password",{email:t})},async resetPassword(t,e){await j.post("/auth/reset-password",{token:t,password:e})},setToken(t){localStorage.setItem("token",t)},getToken(){return localStorage.getItem("token")},setUser(t){localStorage.setItem("user",JSON.stringify(t))},getUser(){const t=localStorage.getItem("user");return t?JSON.parse(t):null}},gt=Dn(t=>({user:he.getUser(),token:he.getToken(),isAuthenticated:!!he.getToken(),isLoading:!1,login:async e=>{var s,n;t({isLoading:!0});try{const{user:a,token:o}=await he.login(e);he.setToken(o),he.setUser(a),t({user:a,token:o,isAuthenticated:!0,isLoading:!1}),O.success("Login realizado com sucesso!")}catch(a){throw t({isLoading:!1}),O.error(((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.error)||"Erro ao fazer login"),a}},register:async e=>{var s,n;t({isLoading:!0});try{const{user:a,token:o}=await he.register(e);he.setToken(o),he.setUser(a),t({user:a,token:o,isAuthenticated:!0,isLoading:!1}),O.success("Conta criada com sucesso!")}catch(a){throw t({isLoading:!1}),O.error(((n=(s=a.response)==null?void 0:s.data)==null?void 0:n.error)||"Erro ao criar conta"),a}},logout:async()=>{try{await he.logout()}catch(e){console.error("Erro ao fazer logout:",e)}finally{t({user:null,token:null,isAuthenticated:!1}),O.success("Logout realizado com sucesso!")}},loadUser:()=>{const e=he.getUser(),s=he.getToken();t({user:e,token:s,isAuthenticated:!!s})}})),Ss="/assets/logo-full-B3Op3OHa.png";function va(){const[t,e]=u.useState(""),[s,n]=u.useState(""),{login:a,isLoading:o}=gt(),i=Vt(),c=async l=>{l.preventDefault();try{await a({email:t,password:s}),i("/dashboard")}catch{}};return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-50 to-primary-100 dark:from-gray-900 dark:to-gray-800",children:r.jsx("div",{className:"w-full max-w-md",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("img",{src:Ss,alt:"Nexus Atemporal",className:"h-20 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Sistema de Gest√£o para Cl√≠nicas"})]}),r.jsxs("form",{onSubmit:c,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),r.jsx("input",{type:"email",value:t,onChange:l=>e(l.target.value),className:"input-field",placeholder:"seu@email.com",required:!0,autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Senha"}),r.jsx("input",{type:"password",value:s,onChange:l=>n(l.target.value),className:"input-field",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("label",{className:"flex items-center",children:[r.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),r.jsx("span",{className:"ml-2 text-sm text-gray-600 dark:text-gray-400",children:"Lembrar-me"})]}),r.jsx(Mt,{to:"/forgot-password",className:"text-sm text-primary-600 hover:text-primary-700",children:"Esqueceu a senha?"})]}),r.jsx("button",{type:"submit",disabled:o,className:"btn-primary w-full",children:o?"Entrando...":"Entrar"})]}),r.jsx("div",{className:"mt-6 text-center",children:r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["N√£o tem uma conta?"," ",r.jsx(Mt,{to:"/register",className:"font-medium text-primary-600 hover:text-primary-700",children:"Criar conta"})]})})]})})})}function wa(){const[t,e]=u.useState(""),[s,n]=u.useState(""),[a,o]=u.useState(""),[i,c]=u.useState(""),[l,h]=u.useState(""),{register:d,isLoading:g}=gt(),f=Vt(),b=async w=>{if(w.preventDefault(),i!==l){alert("As senhas n√£o coincidem");return}try{await d({name:t,email:s,phone:a,password:i}),f("/dashboard")}catch{}};return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-primary-50 to-primary-100 dark:from-gray-900 dark:to-gray-800 py-12",children:r.jsx("div",{className:"w-full max-w-md",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-8",children:[r.jsxs("div",{className:"text-center mb-8",children:[r.jsx("img",{src:Ss,alt:"Nexus Atemporal",className:"h-16 mx-auto mb-4"}),r.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-1",children:"Criar Conta"}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Preencha os dados para come√ßar"})]}),r.jsxs("form",{onSubmit:b,className:"space-y-5",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Nome Completo"}),r.jsx("input",{type:"text",value:t,onChange:w=>e(w.target.value),className:"input-field",placeholder:"Seu nome",required:!0,autoFocus:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Email"}),r.jsx("input",{type:"email",value:s,onChange:w=>n(w.target.value),className:"input-field",placeholder:"seu@email.com",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Telefone"}),r.jsx("input",{type:"tel",value:a,onChange:w=>o(w.target.value),className:"input-field",placeholder:"(00) 00000-0000"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Senha"}),r.jsx("input",{type:"password",value:i,onChange:w=>c(w.target.value),className:"input-field",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0,minLength:6})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Confirmar Senha"}),r.jsx("input",{type:"password",value:l,onChange:w=>h(w.target.value),className:"input-field",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",required:!0,minLength:6})]}),r.jsx("button",{type:"submit",disabled:g,className:"btn-primary w-full",children:g?"Criando conta...":"Criar Conta"})]}),r.jsx("div",{className:"mt-6 text-center",children:r.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["J√° tem uma conta?"," ",r.jsx(Mt,{to:"/login",className:"font-medium text-primary-600 hover:text-primary-700",children:"Fazer login"})]})})]})})})}const ye={async getPipelines(){const{data:t}=await j.get("/leads/pipelines");return t},async getPipeline(t){const{data:e}=await j.get(`/leads/pipelines/${t}`);return e},async createPipeline(t){const{data:e}=await j.post("/leads/pipelines",t);return e},async updatePipeline(t,e){const{data:s}=await j.put(`/leads/pipelines/${t}`,e);return s},async deletePipeline(t){await j.delete(`/leads/pipelines/${t}`)},async createStage(t){const{data:e}=await j.post("/leads/stages",t);return e},async updateStage(t,e){const{data:s}=await j.put(`/leads/stages/${t}`,e);return s},async deleteStage(t){await j.delete(`/leads/stages/${t}`)},async reorderStages(t){await j.post("/leads/stages/reorder",{stageOrders:t})},async getLeads(t){const{data:e}=await j.get("/leads/leads",{params:t});return e},async getLead(t){const{data:e}=await j.get(`/leads/leads/${t}`);return e},async createLead(t){const{data:e}=await j.post("/leads/leads",t);return e},async updateLead(t,e){const{data:s}=await j.put(`/leads/leads/${t}`,e);return s},async deleteLead(t){await j.delete(`/leads/leads/${t}`)},async moveLeadToStage(t,e){const{data:s}=await j.post(`/leads/leads/${t}/move`,{stageId:e});return s},async bulkUpdateLeads(t,e){const{data:s}=await j.post("/leads/leads/bulk-update",{leadIds:t,data:e});return s},async getLeadActivities(t){const{data:e}=await j.get(`/leads/leads/${t}/activities`);return e},async createActivity(t,e){const{data:s}=await j.post(`/leads/leads/${t}/activities`,e);return s},async completeActivity(t){const{data:e}=await j.put(`/leads/activities/${t}/complete`);return e},async getLeadStats(){const{data:t}=await j.get("/leads/leads/stats");return t},async getProcedures(){const{data:t}=await j.get("/leads/procedures");return t},async getProcedure(t){const{data:e}=await j.get(`/leads/procedures/${t}`);return e},async createProcedure(t){const{data:e}=await j.post("/leads/procedures",t);return e},async updateProcedure(t,e){const{data:s}=await j.put(`/leads/procedures/${t}`,e);return s},async deleteProcedure(t){await j.delete(`/leads/procedures/${t}`)}};function ja(){const{user:t}=gt(),e=Vt(),[s,n]=u.useState(!0),[a,o]=u.useState({newLeads:0,totalPatients:0,avgAttendanceTime:0,conversionRate:0,avgTicket:0,uptime:99.9,attendancesByClinic:{moema:0,avPaulista:0}}),[i,c]=u.useState([]),[l,h]=u.useState(!1),[d,g]=u.useState([]),[f,b]=u.useState([]),[w,x]=u.useState(0);u.useEffect(()=>{S()},[]);const S=async()=>{try{n(!0);const p=await ye.getLeads(),T=new Date;T.setHours(0,0,0,0);const m=p.filter(F=>{const Q=new Date(F.createdAt);return Q.setHours(0,0,0,0),Q.getTime()===T.getTime()}),E=new Date;E.setDate(E.getDate()-2);const A=p.filter(F=>!F.activities||F.activities.length===0?!0:new Date(F.activities[0].createdAt)<E),R=p.filter(F=>F.state==="won"),I=p.length>0?R.length/p.length*100:0,B=R.reduce((F,Q)=>F+(Q.estimatedValue||0),0),D=R.length>0?B/R.length:0,U=p.filter(F=>{var Q;return F.attendanceLocation==="moema"||((Q=F.city)==null?void 0:Q.toLowerCase().includes("moema"))}),J=p.filter(F=>{var Q;return(Q=F.city)==null?void 0:Q.toLowerCase().includes("paulista")});o({newLeads:m.length,totalPatients:p.length,avgAttendanceTime:45,conversionRate:Math.round(I),avgTicket:D,uptime:99.9,attendancesByClinic:{moema:U.length,avPaulista:J.length}}),c(m.slice(0,10)),x(A.length),g([{id:"1",type:"lead",title:"Novo lead cadastrado",description:m.length>0?m[0].name:"Aguardando novos leads",time:"H√° 5 minutos",color:"bg-blue-100 text-blue-600"},{id:"2",type:"appointment",title:"Agendamento confirmado",description:"Cliente confirmou consulta para amanh√£",time:"H√° 15 minutos",color:"bg-green-100 text-green-600"},{id:"3",type:"payment",title:"Pagamento recebido",description:"R$ 350,00 via PIX",time:"H√° 1 hora",color:"bg-purple-100 text-purple-600"}]),b([{id:"1",patientName:"Maria Silva",doctorName:"Dr. Jo√£o Santos",room:"Sala 1",procedure:"Consulta Inicial",status:"em_atendimento"},{id:"2",patientName:"Pedro Oliveira",doctorName:"Dra. Ana Costa",room:"Sala 2",procedure:"Retorno",status:"aguardando"}])}catch(p){console.error("Erro ao carregar dashboard:",p),O.error("Erro ao carregar dados do dashboard")}finally{n(!1)}},v=p=>({aguardando:"Aguardando",em_atendimento:"Em Atendimento",finalizado:"Finalizado",retorno_marcado:"Retorno Marcado"})[p]||p,C=p=>({aguardando:"bg-yellow-100 text-yellow-800",em_atendimento:"bg-blue-100 text-blue-800",finalizado:"bg-green-100 text-green-800",retorno_marcado:"bg-purple-100 text-purple-800"})[p]||"bg-gray-100 text-gray-800";return s?r.jsx("div",{className:"flex items-center justify-center h-screen",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{children:[r.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:["Bem-vindo, ",t==null?void 0:t.name,"!"]}),r.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Vis√£o geral do seu sistema Nexus"})]}),r.jsx("div",{onClick:()=>h(!0),className:"bg-gradient-to-r from-primary-600 to-primary-700 rounded-lg p-6 cursor-pointer hover:from-primary-700 hover:to-primary-800 transition-all shadow-lg",children:r.jsxs("div",{className:"flex items-center justify-between text-white",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm opacity-90 mb-1",children:"Novos Leads Hoje"}),r.jsx("p",{className:"text-4xl font-bold",children:a.newLeads}),r.jsx("p",{className:"text-sm mt-2 opacity-90",children:"Clique para ver detalhes"})]}),r.jsx("div",{className:"bg-white/20 p-4 rounded-full",children:r.jsx(ls,{size:40})})]})}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[r.jsx("div",{className:"card",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Total de Pacientes"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.totalPatients}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Atendidos pela cl√≠nica"})]}),r.jsx("div",{className:"p-3 rounded-lg bg-blue-100 dark:bg-blue-900/20",children:r.jsx(qn,{className:"text-blue-600",size:24})})]})}),r.jsx("div",{className:"card",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Tempo M√©dio"}),r.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a.avgAttendanceTime,"min"]}),r.jsx("p",{className:"text-xs text-green-600 mt-1",children:"-5min vs m√™s anterior"})]}),r.jsx("div",{className:"p-3 rounded-lg bg-orange-100 dark:bg-orange-900/20",children:r.jsx(Fn,{className:"text-orange-600",size:24})})]})}),r.jsx("div",{className:"card",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Taxa de Convers√£o"}),r.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a.conversionRate,"%"]}),r.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Lead ‚Üí Fechado"})]}),r.jsx("div",{className:"p-3 rounded-lg bg-green-100 dark:bg-green-900/20",children:r.jsx($n,{className:"text-green-600",size:24})})]})}),r.jsx("div",{className:"card",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Ticket M√©dio"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a.avgTicket)}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Por cliente fechado"})]}),r.jsx("div",{className:"p-3 rounded-lg bg-purple-100 dark:bg-purple-900/20",children:r.jsx(Or,{className:"text-purple-600",size:24})})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[r.jsx("div",{className:"card",children:r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx("div",{className:"p-2 rounded-lg bg-indigo-100",children:r.jsx(Ks,{className:"text-indigo-600",size:20})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Moema"}),r.jsx("p",{className:"text-xl font-bold",children:a.attendancesByClinic.moema})]})]})}),r.jsx("div",{className:"card",children:r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx("div",{className:"p-2 rounded-lg bg-indigo-100",children:r.jsx(Ks,{className:"text-indigo-600",size:20})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"AV Paulista"}),r.jsx("p",{className:"text-xl font-bold",children:a.attendancesByClinic.avPaulista})]})]})}),r.jsx("div",{className:"card",children:r.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[r.jsx("div",{className:"p-2 rounded-lg bg-green-100",children:r.jsx(Vn,{className:"text-green-600",size:20})}),r.jsxs("div",{children:[r.jsx("p",{className:"text-sm text-gray-600",children:"Uptime"}),r.jsxs("p",{className:"text-xl font-bold",children:[a.uptime,"%"]})]})]})})]}),r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[r.jsxs("div",{className:"card",children:[r.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[r.jsx(Gs,{className:"text-orange-600",size:24}),"Alertas"]}),r.jsxs("div",{className:"space-y-3",children:[w>0&&r.jsx("div",{className:"p-4 bg-orange-50 border border-orange-200 rounded-lg",children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx(Gs,{className:"text-orange-600 flex-shrink-0 mt-0.5",size:20}),r.jsxs("div",{children:[r.jsxs("p",{className:"font-medium text-orange-900",children:[w," Lead",w>1?"s":""," sem resposta"]}),r.jsx("p",{className:"text-sm text-orange-700 mt-1",children:"Existem leads aguardando retorno h√° mais de 2 dias"})]})]})}),w===0&&r.jsxs("div",{className:"text-center py-8 text-gray-500",children:[r.jsx(ds,{className:"mx-auto mb-2 text-green-600",size:40}),r.jsx("p",{children:"Nenhum alerta no momento"})]})]})]}),r.jsxs("div",{className:"card",children:[r.jsx("h2",{className:"text-xl font-bold mb-4",children:"Atividades Recentes"}),r.jsx("div",{className:"space-y-3",children:d.map(p=>r.jsxs("div",{className:"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[r.jsx("div",{className:`w-2 h-2 rounded-full mt-2 flex-shrink-0 ${p.color.split(" ")[0]}`}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:p.title}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate",children:p.description}),r.jsx("p",{className:"text-xs text-gray-400 mt-1",children:p.time})]})]},p.id))})]})]}),r.jsxs("div",{className:"card",children:[r.jsx("h2",{className:"text-xl font-bold mb-4",children:"Atendimentos Hoje"}),r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[r.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Paciente"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"M√©dico"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Sala"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Procedimento"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"})]})}),r.jsx("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:f.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:5,className:"px-6 py-8 text-center text-gray-500",children:"Nenhum atendimento agendado para hoje"})}):f.map(p=>r.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-800",children:[r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:p.patientName}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:p.doctorName}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:p.room}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:p.procedure}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${C(p.status)}`,children:v(p.status)})})]},p.id))})]})})]}),l&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full max-h-[80vh] overflow-hidden",children:[r.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Novos Leads Hoje (",i.length,")"]}),r.jsx("button",{onClick:()=>h(!1),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),r.jsx("div",{className:"p-6 overflow-y-auto max-h-[calc(80vh-120px)]",children:i.length===0?r.jsxs("div",{className:"text-center py-12 text-gray-500",children:[r.jsx(ls,{className:"mx-auto mb-3 opacity-50",size:48}),r.jsx("p",{children:"Nenhum lead novo hoje"})]}):r.jsx("div",{className:"space-y-3",children:i.map(p=>r.jsx("div",{onClick:()=>{h(!1),e("/leads",{state:{openLeadId:p.id}})},className:"p-4 border border-gray-200 dark:border-gray-700 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer transition-colors",children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-gray-900 dark:text-white",children:p.name}),r.jsxs("div",{className:"flex items-center gap-4 mt-2 text-sm text-gray-600 dark:text-gray-400",children:[p.phone&&r.jsxs("span",{children:["üìû ",p.phone]}),p.procedure&&r.jsx("span",{children:p.procedure.name}),p.estimatedValue&&r.jsx("span",{className:"text-green-600 font-medium",children:new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(p.estimatedValue)})]})]}),r.jsx(zn,{className:"text-gray-400",size:20})]})},p.id))})}),r.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:r.jsx("button",{onClick:()=>{h(!1),e("/leads")},className:"w-full btn-primary",children:"Ver Todos os Leads"})})]})})]})}function Pr({isOpen:t,onClose:e,title:s,children:n,size:a="md"}){if(u.useEffect(()=>{const c=l=>{l.key==="Escape"&&e()};if(t){document.addEventListener("keydown",c);const l=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",c),document.body.style.overflow=l}}},[t,e]),!t)return null;const o={sm:"max-w-md",md:"max-w-2xl",lg:"max-w-4xl",xl:"max-w-6xl"},i=r.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4 overflow-y-auto",children:[r.jsx("div",{className:"fixed inset-0 bg-black/50",onClick:e,"aria-hidden":"true"}),r.jsxs("div",{className:`relative w-full ${o[a]} bg-white rounded-lg shadow-2xl z-[10000] my-8`,onClick:c=>c.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[r.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:s}),r.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors p-1 rounded-md hover:bg-gray-100",type:"button",children:r.jsx(ut,{size:24})})]}),r.jsx("div",{className:"p-6 max-h-[calc(100vh-16rem)] overflow-y-auto",children:n})]})]});return Fe.createPortal(i,document.body)}const Ir={async getUsers(){const{data:t}=await j.get("/auth/users");return t.data}};function Na({onSubmit:t,onCancel:e,initialData:s,stages:n}){var S,v,C,p,T;const[a,o]=u.useState(!1),[i,c]=u.useState([]),[l,h]=u.useState([]),[d,g]=u.useState({name:(s==null?void 0:s.name)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",phone2:(s==null?void 0:s.phone2)||"",whatsapp:(s==null?void 0:s.whatsapp)||"",neighborhood:(s==null?void 0:s.neighborhood)||"",city:(s==null?void 0:s.city)||"",state:(s==null?void 0:s.state)||"",stageId:(s==null?void 0:s.stageId)||((S=n[0])==null?void 0:S.id)||"",procedureId:(s==null?void 0:s.procedureId)||((v=s==null?void 0:s.procedure)==null?void 0:v.id)||"",assignedToId:((C=s==null?void 0:s.assignedTo)==null?void 0:C.id)||"",source:(s==null?void 0:s.source)||"website",channel:(s==null?void 0:s.channel)||"whatsapp",clientStatus:(s==null?void 0:s.clientStatus)||"conversa_iniciada",attendanceLocation:(s==null?void 0:s.attendanceLocation)||"moema",estimatedValue:(s==null?void 0:s.estimatedValue)||"",expectedCloseDate:((p=s==null?void 0:s.expectedCloseDate)==null?void 0:p.split("T")[0])||"",notes:(s==null?void 0:s.notes)||"",tags:((T=s==null?void 0:s.tags)==null?void 0:T.join(", "))||""});u.useEffect(()=>{f(),b()},[]);const f=async()=>{try{const m=await ye.getProcedures();c(m)}catch(m){console.error("Erro ao carregar procedimentos:",m)}},b=async()=>{try{const m=await Ir.getUsers();h(m)}catch(m){console.error("Erro ao carregar usu√°rios:",m)}},w=async m=>{if(m.preventDefault(),!d.name.trim()){O.error("Nome √© obrigat√≥rio");return}if(!d.stageId){O.error("Selecione um est√°gio");return}o(!0);try{const E={...d,procedureId:d.procedureId||void 0,assignedToId:d.assignedToId||void 0,email:d.email||void 0,phone:d.phone||void 0,phone2:d.phone2||void 0,whatsapp:d.whatsapp||void 0,neighborhood:d.neighborhood||void 0,city:d.city||void 0,state:d.state||void 0,expectedCloseDate:d.expectedCloseDate||void 0,estimatedValue:d.estimatedValue?parseFloat(d.estimatedValue):void 0,tags:d.tags?d.tags.split(",").map(A=>A.trim()).filter(Boolean):[],notes:d.notes||void 0};await t(E),O.success(s?"Lead atualizado com sucesso":"Lead criado com sucesso")}catch(E){O.error(E.message||"Erro ao salvar lead")}finally{o(!1)}},x=(m,E)=>{g(A=>({...A,[m]:E}))};return r.jsxs("form",{onSubmit:w,className:"space-y-6",children:[r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Informa√ß√µes B√°sicas"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nome do Lead ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",value:d.name,onChange:m=>x("name",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Nome completo",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),r.jsx("input",{type:"email",value:d.email,onChange:m=>x("email",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"email@exemplo.com"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),r.jsx("input",{type:"tel",value:d.phone,onChange:m=>x("phone",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"(00) 00000-0000"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone 2"}),r.jsx("input",{type:"tel",value:d.phone2,onChange:m=>x("phone2",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"(00) 00000-0000"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"WhatsApp"}),r.jsx("input",{type:"tel",value:d.whatsapp,onChange:m=>x("whatsapp",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"(00) 00000-0000"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bairro"}),r.jsx("input",{type:"text",value:d.neighborhood,onChange:m=>x("neighborhood",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Bairro"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade"}),r.jsx("input",{type:"text",value:d.city,onChange:m=>x("city",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Cidade"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),r.jsxs("select",{value:d.state,onChange:m=>x("state",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"",children:"Selecione"}),r.jsx("option",{value:"AC",children:"Acre"}),r.jsx("option",{value:"AL",children:"Alagoas"}),r.jsx("option",{value:"AP",children:"Amap√°"}),r.jsx("option",{value:"AM",children:"Amazonas"}),r.jsx("option",{value:"BA",children:"Bahia"}),r.jsx("option",{value:"CE",children:"Cear√°"}),r.jsx("option",{value:"DF",children:"Distrito Federal"}),r.jsx("option",{value:"ES",children:"Esp√≠rito Santo"}),r.jsx("option",{value:"GO",children:"Goi√°s"}),r.jsx("option",{value:"MA",children:"Maranh√£o"}),r.jsx("option",{value:"MT",children:"Mato Grosso"}),r.jsx("option",{value:"MS",children:"Mato Grosso do Sul"}),r.jsx("option",{value:"MG",children:"Minas Gerais"}),r.jsx("option",{value:"PA",children:"Par√°"}),r.jsx("option",{value:"PB",children:"Para√≠ba"}),r.jsx("option",{value:"PR",children:"Paran√°"}),r.jsx("option",{value:"PE",children:"Pernambuco"}),r.jsx("option",{value:"PI",children:"Piau√≠"}),r.jsx("option",{value:"RJ",children:"Rio de Janeiro"}),r.jsx("option",{value:"RN",children:"Rio Grande do Norte"}),r.jsx("option",{value:"RS",children:"Rio Grande do Sul"}),r.jsx("option",{value:"RO",children:"Rond√¥nia"}),r.jsx("option",{value:"RR",children:"Roraima"}),r.jsx("option",{value:"SC",children:"Santa Catarina"}),r.jsx("option",{value:"SP",children:"S√£o Paulo"}),r.jsx("option",{value:"SE",children:"Sergipe"}),r.jsx("option",{value:"TO",children:"Tocantins"})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Est√°gio ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("select",{value:d.stageId,onChange:m=>x("stageId",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0,children:n.map(m=>r.jsx("option",{value:m.id,children:m.name},m.id))})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Procedimento"}),r.jsxs("select",{value:d.procedureId,onChange:m=>x("procedureId",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"",children:"Selecione um procedimento"}),i.map(m=>{const E=m.price?Number(m.price):null;return r.jsxs("option",{value:m.id,children:[m.name," ",E?`- R$ ${E.toFixed(2)}`:""]},m.id)})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Respons√°vel ",r.jsx("span",{className:"text-xs text-gray-500",children:"(Atendimento)"})]}),r.jsxs("select",{value:d.assignedToId,onChange:m=>x("assignedToId",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"",children:"Selecione um respons√°vel"}),l.map(m=>r.jsxs("option",{value:m.id,children:[m.name," (",m.email,")"]},m.id))]})]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Detalhes da Venda"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Origem"}),r.jsxs("select",{value:d.source,onChange:m=>x("source",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"website",children:"Website"}),r.jsx("option",{value:"referral",children:"Indica√ß√£o"}),r.jsx("option",{value:"social_media",children:"Redes Sociais"}),r.jsx("option",{value:"email",children:"Email"}),r.jsx("option",{value:"phone",children:"Telefone"}),r.jsx("option",{value:"other",children:"Outro"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Canal"}),r.jsxs("select",{value:d.channel,onChange:m=>x("channel",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"whatsapp",children:"WhatsApp"}),r.jsx("option",{value:"instagram",children:"Instagram"}),r.jsx("option",{value:"facebook",children:"Facebook"}),r.jsx("option",{value:"site",children:"Site"}),r.jsx("option",{value:"campanha",children:"Campanha"}),r.jsx("option",{value:"bairro",children:"Bairro"}),r.jsx("option",{value:"indicacao",children:"Indica√ß√£o"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Situa√ß√£o do Cliente"}),r.jsxs("select",{value:d.clientStatus,onChange:m=>x("clientStatus",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"conversa_iniciada",children:"Conversa Iniciada"}),r.jsx("option",{value:"cliente_potencial",children:"Cliente Potencial"}),r.jsx("option",{value:"sem_potencial",children:"Sem Potencial"}),r.jsx("option",{value:"contatar_futuro",children:"Contatar no Futuro"}),r.jsx("option",{value:"sem_retorno",children:"Sem Retorno"}),r.jsx("option",{value:"pre_qualificado",children:"Pr√© Qualificado"}),r.jsx("option",{value:"qualificado",children:"Qualificado"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Local de Atendimento"}),r.jsxs("select",{value:d.attendanceLocation,onChange:m=>x("attendanceLocation",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"moema",children:"Moema"}),r.jsx("option",{value:"av_paulista",children:"Av. Paulista"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor Estimado"}),r.jsx("input",{type:"number",step:"0.01",value:d.estimatedValue,onChange:m=>x("estimatedValue",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"0.00"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Fechamento Esperada"}),r.jsx("input",{type:"date",value:d.expectedCloseDate,onChange:m=>x("expectedCloseDate",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]})]}),r.jsxs("div",{children:[r.jsx("h4",{className:"text-sm font-semibold text-gray-700 mb-4",children:"Informa√ß√µes Adicionais"}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tags"}),r.jsx("input",{type:"text",value:d.tags,onChange:m=>x("tags",m.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Separadas por v√≠rgula: tag1, tag2, tag3"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Separe as tags com v√≠rgulas"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa√ß√µes"}),r.jsx("textarea",{value:d.notes,onChange:m=>x("notes",m.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Adicione observa√ß√µes sobre este lead..."})]})]})]}),r.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[r.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",disabled:a,children:"Cancelar"}),r.jsx("button",{type:"submit",className:"px-4 py-2 text-white bg-primary-600 rounded-lg hover:bg-primary-700 disabled:opacity-50",disabled:a,children:a?"Salvando...":s?"Atualizar Lead":"Criar Lead"})]})]})}function V(t){const e=Object.prototype.toString.call(t);return t instanceof Date||typeof t=="object"&&e==="[object Date]"?new t.constructor(+t):typeof t=="number"||e==="[object Number]"||typeof t=="string"||e==="[object String]"?new Date(t):new Date(NaN)}function Ie(t,e){return t instanceof Date?new t.constructor(e):new Date(e)}const Br=6048e5,ka=864e5,kt=43200,sr=1440;let Ca={};function pt(){return Ca}function ht(t,e){var c,l,h,d;const s=pt(),n=(e==null?void 0:e.weekStartsOn)??((l=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:l.weekStartsOn)??s.weekStartsOn??((d=(h=s.locale)==null?void 0:h.options)==null?void 0:d.weekStartsOn)??0,a=V(t),o=a.getDay(),i=(o<n?7:0)+o-n;return a.setDate(a.getDate()-i),a.setHours(0,0,0,0),a}function Dt(t){return ht(t,{weekStartsOn:1})}function Wr(t){const e=V(t),s=e.getFullYear(),n=Ie(t,0);n.setFullYear(s+1,0,4),n.setHours(0,0,0,0);const a=Dt(n),o=Ie(t,0);o.setFullYear(s,0,4),o.setHours(0,0,0,0);const i=Dt(o);return e.getTime()>=a.getTime()?s+1:e.getTime()>=i.getTime()?s:s-1}function rr(t){const e=V(t);return e.setHours(0,0,0,0),e}function Pt(t){const e=V(t),s=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return s.setUTCFullYear(e.getFullYear()),+t-+s}function Sa(t,e){const s=rr(t),n=rr(e),a=+s-Pt(s),o=+n-Pt(n);return Math.round((a-o)/ka)}function Ea(t){const e=Wr(t),s=Ie(t,0);return s.setFullYear(e,0,4),s.setHours(0,0,0,0),Dt(s)}function Et(t,e){const s=V(t),n=V(e),a=s.getTime()-n.getTime();return a<0?-1:a>0?1:a}function Aa(t){return Ie(t,Date.now())}function Ra(t){return t instanceof Date||typeof t=="object"&&Object.prototype.toString.call(t)==="[object Date]"}function Ta(t){if(!Ra(t)&&typeof t!="number")return!1;const e=V(t);return!isNaN(Number(e))}function _a(t,e){const s=V(t),n=V(e),a=s.getFullYear()-n.getFullYear(),o=s.getMonth()-n.getMonth();return a*12+o}function Oa(t){return e=>{const n=(t?Math[t]:Math.trunc)(e);return n===0?0:n}}function Ma(t,e){return+V(t)-+V(e)}function La(t){const e=V(t);return e.setHours(23,59,59,999),e}function Da(t){const e=V(t),s=e.getMonth();return e.setFullYear(e.getFullYear(),s+1,0),e.setHours(23,59,59,999),e}function Pa(t){const e=V(t);return+La(e)==+Da(e)}function Ia(t,e){const s=V(t),n=V(e),a=Et(s,n),o=Math.abs(_a(s,n));let i;if(o<1)i=0;else{s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-a*o);let c=Et(s,n)===-a;Pa(V(t))&&o===1&&Et(t,n)===1&&(c=!1),i=a*(o-Number(c))}return i===0?0:i}function Ba(t,e,s){const n=Ma(t,e)/1e3;return Oa(s==null?void 0:s.roundingMethod)(n)}function Wa(t){const e=V(t),s=Ie(t,0);return s.setFullYear(e.getFullYear(),0,1),s.setHours(0,0,0,0),s}const qa={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Fa=(t,e,s)=>{let n;const a=qa[t];return typeof a=="string"?n=a:e===1?n=a.one:n=a.other.replace("{{count}}",e.toString()),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"in "+n:n+" ago":n};function Qe(t){return(e={})=>{const s=e.width?String(e.width):t.defaultWidth;return t.formats[s]||t.formats[t.defaultWidth]}}const $a={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Va={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},za={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ua={date:Qe({formats:$a,defaultWidth:"full"}),time:Qe({formats:Va,defaultWidth:"full"}),dateTime:Qe({formats:za,defaultWidth:"full"})},Ya={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Ha=(t,e,s,n)=>Ya[t];function Ne(t){return(e,s)=>{const n=s!=null&&s.context?String(s.context):"standalone";let a;if(n==="formatting"&&t.formattingValues){const i=t.defaultFormattingWidth||t.defaultWidth,c=s!=null&&s.width?String(s.width):i;a=t.formattingValues[c]||t.formattingValues[i]}else{const i=t.defaultWidth,c=s!=null&&s.width?String(s.width):t.defaultWidth;a=t.values[c]||t.values[i]}const o=t.argumentCallback?t.argumentCallback(e):e;return a[o]}}const Xa={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Qa={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Ka={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Ga={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Ja={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Za={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},eo=(t,e)=>{const s=Number(t),n=s%100;if(n>20||n<10)switch(n%10){case 1:return s+"st";case 2:return s+"nd";case 3:return s+"rd"}return s+"th"},to={ordinalNumber:eo,era:Ne({values:Xa,defaultWidth:"wide"}),quarter:Ne({values:Qa,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Ne({values:Ka,defaultWidth:"wide"}),day:Ne({values:Ga,defaultWidth:"wide"}),dayPeriod:Ne({values:Ja,defaultWidth:"wide",formattingValues:Za,defaultFormattingWidth:"wide"})};function ke(t){return(e,s={})=>{const n=s.width,a=n&&t.matchPatterns[n]||t.matchPatterns[t.defaultMatchWidth],o=e.match(a);if(!o)return null;const i=o[0],c=n&&t.parsePatterns[n]||t.parsePatterns[t.defaultParseWidth],l=Array.isArray(c)?ro(c,g=>g.test(i)):so(c,g=>g.test(i));let h;h=t.valueCallback?t.valueCallback(l):l,h=s.valueCallback?s.valueCallback(h):h;const d=e.slice(i.length);return{value:h,rest:d}}}function so(t,e){for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&e(t[s]))return s}function ro(t,e){for(let s=0;s<t.length;s++)if(e(t[s]))return s}function qr(t){return(e,s={})=>{const n=e.match(t.matchPattern);if(!n)return null;const a=n[0],o=e.match(t.parsePattern);if(!o)return null;let i=t.valueCallback?t.valueCallback(o[0]):o[0];i=s.valueCallback?s.valueCallback(i):i;const c=e.slice(a.length);return{value:i,rest:c}}}const no=/^(\d+)(th|st|nd|rd)?/i,ao=/\d+/i,oo={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},io={any:[/^b/i,/^(a|c)/i]},co={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},lo={any:[/1/i,/2/i,/3/i,/4/i]},uo={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},ho={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},mo={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},fo={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},go={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},po={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},xo={ordinalNumber:qr({matchPattern:no,parsePattern:ao,valueCallback:t=>parseInt(t,10)}),era:ke({matchPatterns:oo,defaultMatchWidth:"wide",parsePatterns:io,defaultParseWidth:"any"}),quarter:ke({matchPatterns:co,defaultMatchWidth:"wide",parsePatterns:lo,defaultParseWidth:"any",valueCallback:t=>t+1}),month:ke({matchPatterns:uo,defaultMatchWidth:"wide",parsePatterns:ho,defaultParseWidth:"any"}),day:ke({matchPatterns:mo,defaultMatchWidth:"wide",parsePatterns:fo,defaultParseWidth:"any"}),dayPeriod:ke({matchPatterns:go,defaultMatchWidth:"any",parsePatterns:po,defaultParseWidth:"any"})},Fr={code:"en-US",formatDistance:Fa,formatLong:Ua,formatRelative:Ha,localize:to,match:xo,options:{weekStartsOn:0,firstWeekContainsDate:1}};function yo(t){const e=V(t);return Sa(e,Wa(e))+1}function bo(t){const e=V(t),s=+Dt(e)-+Ea(e);return Math.round(s/Br)+1}function $r(t,e){var d,g,f,b;const s=V(t),n=s.getFullYear(),a=pt(),o=(e==null?void 0:e.firstWeekContainsDate)??((g=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:g.firstWeekContainsDate)??a.firstWeekContainsDate??((b=(f=a.locale)==null?void 0:f.options)==null?void 0:b.firstWeekContainsDate)??1,i=Ie(t,0);i.setFullYear(n+1,0,o),i.setHours(0,0,0,0);const c=ht(i,e),l=Ie(t,0);l.setFullYear(n,0,o),l.setHours(0,0,0,0);const h=ht(l,e);return s.getTime()>=c.getTime()?n+1:s.getTime()>=h.getTime()?n:n-1}function vo(t,e){var c,l,h,d;const s=pt(),n=(e==null?void 0:e.firstWeekContainsDate)??((l=(c=e==null?void 0:e.locale)==null?void 0:c.options)==null?void 0:l.firstWeekContainsDate)??s.firstWeekContainsDate??((d=(h=s.locale)==null?void 0:h.options)==null?void 0:d.firstWeekContainsDate)??1,a=$r(t,e),o=Ie(t,0);return o.setFullYear(a,0,n),o.setHours(0,0,0,0),ht(o,e)}function wo(t,e){const s=V(t),n=+ht(s,e)-+vo(s,e);return Math.round(n/Br)+1}function q(t,e){const s=t<0?"-":"",n=Math.abs(t).toString().padStart(e,"0");return s+n}const Le={y(t,e){const s=t.getFullYear(),n=s>0?s:1-s;return q(e==="yy"?n%100:n,e.length)},M(t,e){const s=t.getMonth();return e==="M"?String(s+1):q(s+1,2)},d(t,e){return q(t.getDate(),e.length)},a(t,e){const s=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return s.toUpperCase();case"aaa":return s;case"aaaaa":return s[0];case"aaaa":default:return s==="am"?"a.m.":"p.m."}},h(t,e){return q(t.getHours()%12||12,e.length)},H(t,e){return q(t.getHours(),e.length)},m(t,e){return q(t.getMinutes(),e.length)},s(t,e){return q(t.getSeconds(),e.length)},S(t,e){const s=e.length,n=t.getMilliseconds(),a=Math.trunc(n*Math.pow(10,s-3));return q(a,e.length)}},He={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},nr={G:function(t,e,s){const n=t.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return s.era(n,{width:"abbreviated"});case"GGGGG":return s.era(n,{width:"narrow"});case"GGGG":default:return s.era(n,{width:"wide"})}},y:function(t,e,s){if(e==="yo"){const n=t.getFullYear(),a=n>0?n:1-n;return s.ordinalNumber(a,{unit:"year"})}return Le.y(t,e)},Y:function(t,e,s,n){const a=$r(t,n),o=a>0?a:1-a;if(e==="YY"){const i=o%100;return q(i,2)}return e==="Yo"?s.ordinalNumber(o,{unit:"year"}):q(o,e.length)},R:function(t,e){const s=Wr(t);return q(s,e.length)},u:function(t,e){const s=t.getFullYear();return q(s,e.length)},Q:function(t,e,s){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return q(n,2);case"Qo":return s.ordinalNumber(n,{unit:"quarter"});case"QQQ":return s.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return s.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(n,{width:"wide",context:"formatting"})}},q:function(t,e,s){const n=Math.ceil((t.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return q(n,2);case"qo":return s.ordinalNumber(n,{unit:"quarter"});case"qqq":return s.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return s.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(n,{width:"wide",context:"standalone"})}},M:function(t,e,s){const n=t.getMonth();switch(e){case"M":case"MM":return Le.M(t,e);case"Mo":return s.ordinalNumber(n+1,{unit:"month"});case"MMM":return s.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return s.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(n,{width:"wide",context:"formatting"})}},L:function(t,e,s){const n=t.getMonth();switch(e){case"L":return String(n+1);case"LL":return q(n+1,2);case"Lo":return s.ordinalNumber(n+1,{unit:"month"});case"LLL":return s.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return s.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(n,{width:"wide",context:"standalone"})}},w:function(t,e,s,n){const a=wo(t,n);return e==="wo"?s.ordinalNumber(a,{unit:"week"}):q(a,e.length)},I:function(t,e,s){const n=bo(t);return e==="Io"?s.ordinalNumber(n,{unit:"week"}):q(n,e.length)},d:function(t,e,s){return e==="do"?s.ordinalNumber(t.getDate(),{unit:"date"}):Le.d(t,e)},D:function(t,e,s){const n=yo(t);return e==="Do"?s.ordinalNumber(n,{unit:"dayOfYear"}):q(n,e.length)},E:function(t,e,s){const n=t.getDay();switch(e){case"E":case"EE":case"EEE":return s.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return s.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(n,{width:"short",context:"formatting"});case"EEEE":default:return s.day(n,{width:"wide",context:"formatting"})}},e:function(t,e,s,n){const a=t.getDay(),o=(a-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(o);case"ee":return q(o,2);case"eo":return s.ordinalNumber(o,{unit:"day"});case"eee":return s.day(a,{width:"abbreviated",context:"formatting"});case"eeeee":return s.day(a,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(a,{width:"short",context:"formatting"});case"eeee":default:return s.day(a,{width:"wide",context:"formatting"})}},c:function(t,e,s,n){const a=t.getDay(),o=(a-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(o);case"cc":return q(o,e.length);case"co":return s.ordinalNumber(o,{unit:"day"});case"ccc":return s.day(a,{width:"abbreviated",context:"standalone"});case"ccccc":return s.day(a,{width:"narrow",context:"standalone"});case"cccccc":return s.day(a,{width:"short",context:"standalone"});case"cccc":default:return s.day(a,{width:"wide",context:"standalone"})}},i:function(t,e,s){const n=t.getDay(),a=n===0?7:n;switch(e){case"i":return String(a);case"ii":return q(a,e.length);case"io":return s.ordinalNumber(a,{unit:"day"});case"iii":return s.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return s.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return s.day(n,{width:"short",context:"formatting"});case"iiii":default:return s.day(n,{width:"wide",context:"formatting"})}},a:function(t,e,s){const a=t.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"aaa":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},b:function(t,e,s){const n=t.getHours();let a;switch(n===12?a=He.noon:n===0?a=He.midnight:a=n/12>=1?"pm":"am",e){case"b":case"bb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"bbb":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},B:function(t,e,s){const n=t.getHours();let a;switch(n>=17?a=He.evening:n>=12?a=He.afternoon:n>=4?a=He.morning:a=He.night,e){case"B":case"BB":case"BBB":return s.dayPeriod(a,{width:"abbreviated",context:"formatting"});case"BBBBB":return s.dayPeriod(a,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(a,{width:"wide",context:"formatting"})}},h:function(t,e,s){if(e==="ho"){let n=t.getHours()%12;return n===0&&(n=12),s.ordinalNumber(n,{unit:"hour"})}return Le.h(t,e)},H:function(t,e,s){return e==="Ho"?s.ordinalNumber(t.getHours(),{unit:"hour"}):Le.H(t,e)},K:function(t,e,s){const n=t.getHours()%12;return e==="Ko"?s.ordinalNumber(n,{unit:"hour"}):q(n,e.length)},k:function(t,e,s){let n=t.getHours();return n===0&&(n=24),e==="ko"?s.ordinalNumber(n,{unit:"hour"}):q(n,e.length)},m:function(t,e,s){return e==="mo"?s.ordinalNumber(t.getMinutes(),{unit:"minute"}):Le.m(t,e)},s:function(t,e,s){return e==="so"?s.ordinalNumber(t.getSeconds(),{unit:"second"}):Le.s(t,e)},S:function(t,e){return Le.S(t,e)},X:function(t,e,s){const n=t.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return or(n);case"XXXX":case"XX":return qe(n);case"XXXXX":case"XXX":default:return qe(n,":")}},x:function(t,e,s){const n=t.getTimezoneOffset();switch(e){case"x":return or(n);case"xxxx":case"xx":return qe(n);case"xxxxx":case"xxx":default:return qe(n,":")}},O:function(t,e,s){const n=t.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+ar(n,":");case"OOOO":default:return"GMT"+qe(n,":")}},z:function(t,e,s){const n=t.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+ar(n,":");case"zzzz":default:return"GMT"+qe(n,":")}},t:function(t,e,s){const n=Math.trunc(t.getTime()/1e3);return q(n,e.length)},T:function(t,e,s){const n=t.getTime();return q(n,e.length)}};function ar(t,e=""){const s=t>0?"-":"+",n=Math.abs(t),a=Math.trunc(n/60),o=n%60;return o===0?s+String(a):s+String(a)+e+q(o,2)}function or(t,e){return t%60===0?(t>0?"-":"+")+q(Math.abs(t)/60,2):qe(t,e)}function qe(t,e=""){const s=t>0?"-":"+",n=Math.abs(t),a=q(Math.trunc(n/60),2),o=q(n%60,2);return s+a+e+o}const ir=(t,e)=>{switch(t){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Vr=(t,e)=>{switch(t){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},jo=(t,e)=>{const s=t.match(/(P+)(p+)?/)||[],n=s[1],a=s[2];if(!a)return ir(t,e);let o;switch(n){case"P":o=e.dateTime({width:"short"});break;case"PP":o=e.dateTime({width:"medium"});break;case"PPP":o=e.dateTime({width:"long"});break;case"PPPP":default:o=e.dateTime({width:"full"});break}return o.replace("{{date}}",ir(n,e)).replace("{{time}}",Vr(a,e))},No={p:Vr,P:jo},ko=/^D+$/,Co=/^Y+$/,So=["D","DD","YY","YYYY"];function Eo(t){return ko.test(t)}function Ao(t){return Co.test(t)}function Ro(t,e,s){const n=To(t,e,s);if(console.warn(n),So.includes(t))throw new RangeError(n)}function To(t,e,s){const n=t[0]==="Y"?"years":"days of the month";return`Use \`${t.toLowerCase()}\` instead of \`${t}\` (in \`${e}\`) for formatting ${n} to the input \`${s}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const _o=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Oo=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Mo=/^'([^]*?)'?$/,Lo=/''/g,Do=/[a-zA-Z]/;function zr(t,e,s){var d,g,f,b,w,x,S,v;const n=pt(),a=(s==null?void 0:s.locale)??n.locale??Fr,o=(s==null?void 0:s.firstWeekContainsDate)??((g=(d=s==null?void 0:s.locale)==null?void 0:d.options)==null?void 0:g.firstWeekContainsDate)??n.firstWeekContainsDate??((b=(f=n.locale)==null?void 0:f.options)==null?void 0:b.firstWeekContainsDate)??1,i=(s==null?void 0:s.weekStartsOn)??((x=(w=s==null?void 0:s.locale)==null?void 0:w.options)==null?void 0:x.weekStartsOn)??n.weekStartsOn??((v=(S=n.locale)==null?void 0:S.options)==null?void 0:v.weekStartsOn)??0,c=V(t);if(!Ta(c))throw new RangeError("Invalid time value");let l=e.match(Oo).map(C=>{const p=C[0];if(p==="p"||p==="P"){const T=No[p];return T(C,a.formatLong)}return C}).join("").match(_o).map(C=>{if(C==="''")return{isToken:!1,value:"'"};const p=C[0];if(p==="'")return{isToken:!1,value:Po(C)};if(nr[p])return{isToken:!0,value:C};if(p.match(Do))throw new RangeError("Format string contains an unescaped latin alphabet character `"+p+"`");return{isToken:!1,value:C}});a.localize.preprocessor&&(l=a.localize.preprocessor(c,l));const h={firstWeekContainsDate:o,weekStartsOn:i,locale:a};return l.map(C=>{if(!C.isToken)return C.value;const p=C.value;(!(s!=null&&s.useAdditionalWeekYearTokens)&&Ao(p)||!(s!=null&&s.useAdditionalDayOfYearTokens)&&Eo(p))&&Ro(p,e,String(t));const T=nr[p[0]];return T(c,p,a.localize,h)}).join("")}function Po(t){const e=t.match(Mo);return e?e[1].replace(Lo,"'"):t}function Io(t,e,s){const n=pt(),a=(s==null?void 0:s.locale)??n.locale??Fr,o=2520,i=Et(t,e);if(isNaN(i))throw new RangeError("Invalid time value");const c=Object.assign({},s,{addSuffix:s==null?void 0:s.addSuffix,comparison:i});let l,h;i>0?(l=V(e),h=V(t)):(l=V(t),h=V(e));const d=Ba(h,l),g=(Pt(h)-Pt(l))/1e3,f=Math.round((d-g)/60);let b;if(f<2)return s!=null&&s.includeSeconds?d<5?a.formatDistance("lessThanXSeconds",5,c):d<10?a.formatDistance("lessThanXSeconds",10,c):d<20?a.formatDistance("lessThanXSeconds",20,c):d<40?a.formatDistance("halfAMinute",0,c):d<60?a.formatDistance("lessThanXMinutes",1,c):a.formatDistance("xMinutes",1,c):f===0?a.formatDistance("lessThanXMinutes",1,c):a.formatDistance("xMinutes",f,c);if(f<45)return a.formatDistance("xMinutes",f,c);if(f<90)return a.formatDistance("aboutXHours",1,c);if(f<sr){const w=Math.round(f/60);return a.formatDistance("aboutXHours",w,c)}else{if(f<o)return a.formatDistance("xDays",1,c);if(f<kt){const w=Math.round(f/sr);return a.formatDistance("xDays",w,c)}else if(f<kt*2)return b=Math.round(f/kt),a.formatDistance("aboutXMonths",b,c)}if(b=Ia(h,l),b<12){const w=Math.round(f/kt);return a.formatDistance("xMonths",w,c)}else{const w=b%12,x=Math.trunc(b/12);return w<3?a.formatDistance("aboutXYears",x,c):w<9?a.formatDistance("overXYears",x,c):a.formatDistance("almostXYears",x+1,c)}}function Bo(t,e){return Io(t,Aa(t),e)}const Wo={lessThanXSeconds:{one:"menos de um segundo",other:"menos de {{count}} segundos"},xSeconds:{one:"1 segundo",other:"{{count}} segundos"},halfAMinute:"meio minuto",lessThanXMinutes:{one:"menos de um minuto",other:"menos de {{count}} minutos"},xMinutes:{one:"1 minuto",other:"{{count}} minutos"},aboutXHours:{one:"cerca de 1 hora",other:"cerca de {{count}} horas"},xHours:{one:"1 hora",other:"{{count}} horas"},xDays:{one:"1 dia",other:"{{count}} dias"},aboutXWeeks:{one:"cerca de 1 semana",other:"cerca de {{count}} semanas"},xWeeks:{one:"1 semana",other:"{{count}} semanas"},aboutXMonths:{one:"cerca de 1 m√™s",other:"cerca de {{count}} meses"},xMonths:{one:"1 m√™s",other:"{{count}} meses"},aboutXYears:{one:"cerca de 1 ano",other:"cerca de {{count}} anos"},xYears:{one:"1 ano",other:"{{count}} anos"},overXYears:{one:"mais de 1 ano",other:"mais de {{count}} anos"},almostXYears:{one:"quase 1 ano",other:"quase {{count}} anos"}},qo=(t,e,s)=>{let n;const a=Wo[t];return typeof a=="string"?n=a:e===1?n=a.one:n=a.other.replace("{{count}}",String(e)),s!=null&&s.addSuffix?s.comparison&&s.comparison>0?"em "+n:"h√° "+n:n},Fo={full:"EEEE, d 'de' MMMM 'de' y",long:"d 'de' MMMM 'de' y",medium:"d MMM y",short:"dd/MM/yyyy"},$o={full:"HH:mm:ss zzzz",long:"HH:mm:ss z",medium:"HH:mm:ss",short:"HH:mm"},Vo={full:"{{date}} '√†s' {{time}}",long:"{{date}} '√†s' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},zo={date:Qe({formats:Fo,defaultWidth:"full"}),time:Qe({formats:$o,defaultWidth:"full"}),dateTime:Qe({formats:Vo,defaultWidth:"full"})},Uo={lastWeek:t=>{const e=t.getDay();return"'"+(e===0||e===6?"√∫ltimo":"√∫ltima")+"' eeee '√†s' p"},yesterday:"'ontem √†s' p",today:"'hoje √†s' p",tomorrow:"'amanh√£ √†s' p",nextWeek:"eeee '√†s' p",other:"P"},Yo=(t,e,s,n)=>{const a=Uo[t];return typeof a=="function"?a(e):a},Ho={narrow:["AC","DC"],abbreviated:["AC","DC"],wide:["antes de cristo","depois de cristo"]},Xo={narrow:["1","2","3","4"],abbreviated:["T1","T2","T3","T4"],wide:["1¬∫ trimestre","2¬∫ trimestre","3¬∫ trimestre","4¬∫ trimestre"]},Qo={narrow:["j","f","m","a","m","j","j","a","s","o","n","d"],abbreviated:["jan","fev","mar","abr","mai","jun","jul","ago","set","out","nov","dez"],wide:["janeiro","fevereiro","mar√ßo","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"]},Ko={narrow:["D","S","T","Q","Q","S","S"],short:["dom","seg","ter","qua","qui","sex","sab"],abbreviated:["domingo","segunda","ter√ßa","quarta","quinta","sexta","s√°bado"],wide:["domingo","segunda-feira","ter√ßa-feira","quarta-feira","quinta-feira","sexta-feira","s√°bado"]},Go={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"manh√£",afternoon:"tarde",evening:"tarde",night:"noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"manh√£",afternoon:"tarde",evening:"tarde",night:"noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"manh√£",afternoon:"tarde",evening:"tarde",night:"noite"}},Jo={narrow:{am:"a",pm:"p",midnight:"mn",noon:"md",morning:"da manh√£",afternoon:"da tarde",evening:"da tarde",night:"da noite"},abbreviated:{am:"AM",pm:"PM",midnight:"meia-noite",noon:"meio-dia",morning:"da manh√£",afternoon:"da tarde",evening:"da tarde",night:"da noite"},wide:{am:"a.m.",pm:"p.m.",midnight:"meia-noite",noon:"meio-dia",morning:"da manh√£",afternoon:"da tarde",evening:"da tarde",night:"da noite"}},Zo=(t,e)=>{const s=Number(t);return(e==null?void 0:e.unit)==="week"?s+"¬™":s+"¬∫"},ei={ordinalNumber:Zo,era:Ne({values:Ho,defaultWidth:"wide"}),quarter:Ne({values:Xo,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Ne({values:Qo,defaultWidth:"wide"}),day:Ne({values:Ko,defaultWidth:"wide"}),dayPeriod:Ne({values:Go,defaultWidth:"wide",formattingValues:Jo,defaultFormattingWidth:"wide"})},ti=/^(\d+)[¬∫¬™o]?/i,si=/\d+/i,ri={narrow:/^(ac|dc|a|d)/i,abbreviated:/^(a\.?\s?c\.?|d\.?\s?c\.?)/i,wide:/^(antes de cristo|depois de cristo)/i},ni={any:[/^ac/i,/^dc/i],wide:[/^antes de cristo/i,/^depois de cristo/i]},ai={narrow:/^[1234]/i,abbreviated:/^T[1234]/i,wide:/^[1234](¬∫)? trimestre/i},oi={any:[/1/i,/2/i,/3/i,/4/i]},ii={narrow:/^[jfmajsond]/i,abbreviated:/^(jan|fev|mar|abr|mai|jun|jul|ago|set|out|nov|dez)/i,wide:/^(janeiro|fevereiro|mar√ßo|abril|maio|junho|julho|agosto|setembro|outubro|novembro|dezembro)/i},ci={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^fev/i,/^mar/i,/^abr/i,/^mai/i,/^jun/i,/^jul/i,/^ago/i,/^set/i,/^out/i,/^nov/i,/^dez/i]},li={narrow:/^(dom|[23456]¬™?|s[a√°]b)/i,short:/^(dom|[23456]¬™?|s[a√°]b)/i,abbreviated:/^(dom|seg|ter|qua|qui|sex|s[a√°]b)/i,wide:/^(domingo|(segunda|ter[c√ß]a|quarta|quinta|sexta)([- ]feira)?|s[a√°]bado)/i},di={short:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a√°]/i],narrow:[/^d/i,/^2/i,/^3/i,/^4/i,/^5/i,/^6/i,/^s[a√°]/i],any:[/^d/i,/^seg/i,/^t/i,/^qua/i,/^qui/i,/^sex/i,/^s[a√°]b/i]},ui={narrow:/^(a|p|mn|md|(da) (manh√£|tarde|noite))/i,any:/^([ap]\.?\s?m\.?|meia[-\s]noite|meio[-\s]dia|(da) (manh√£|tarde|noite))/i},hi={any:{am:/^a/i,pm:/^p/i,midnight:/^mn|^meia[-\s]noite/i,noon:/^md|^meio[-\s]dia/i,morning:/manh√£/i,afternoon:/tarde/i,evening:/tarde/i,night:/noite/i}},mi={ordinalNumber:qr({matchPattern:ti,parsePattern:si,valueCallback:t=>parseInt(t,10)}),era:ke({matchPatterns:ri,defaultMatchWidth:"wide",parsePatterns:ni,defaultParseWidth:"any"}),quarter:ke({matchPatterns:ai,defaultMatchWidth:"wide",parsePatterns:oi,defaultParseWidth:"any",valueCallback:t=>t+1}),month:ke({matchPatterns:ii,defaultMatchWidth:"wide",parsePatterns:ci,defaultParseWidth:"any"}),day:ke({matchPatterns:li,defaultMatchWidth:"wide",parsePatterns:di,defaultParseWidth:"any"}),dayPeriod:ke({matchPatterns:ui,defaultMatchWidth:"any",parsePatterns:hi,defaultParseWidth:"any"})},fs={code:"pt-BR",formatDistance:qo,formatLong:zo,formatRelative:Yo,localize:ei,match:mi,options:{weekStartsOn:0,firstWeekContainsDate:1}},fi=t=>{const e="w-4 h-4";switch(t){case"call":return r.jsx(zt,{className:e});case"email":return r.jsx(Cs,{className:e});case"meeting":return r.jsx(ks,{className:e});case"task":return r.jsx(Un,{className:e});case"note":return r.jsx(Mr,{className:e});case"whatsapp":return r.jsx(Lt,{className:e});case"lead_created":case"lead_assigned":case"stage_change":case"status_change":case"field_change":return r.jsx(Xe,{className:e});default:return r.jsx(Ge,{className:e})}},cr=t=>{switch(t){case"call":return"bg-blue-100 text-blue-600 border-blue-200";case"email":return"bg-purple-100 text-purple-600 border-purple-200";case"meeting":return"bg-green-100 text-green-600 border-green-200";case"task":return"bg-orange-100 text-orange-600 border-orange-200";case"note":return"bg-gray-100 text-gray-600 border-gray-200";case"whatsapp":return"bg-emerald-100 text-emerald-600 border-emerald-200";case"lead_created":case"lead_assigned":case"stage_change":case"status_change":case"field_change":return"bg-indigo-100 text-indigo-600 border-indigo-200";default:return"bg-gray-100 text-gray-600 border-gray-200"}},gi=t=>({call:"Liga√ß√£o",email:"E-mail",meeting:"Reuni√£o",task:"Tarefa",note:"Nota",whatsapp:"WhatsApp",sms:"SMS",stage_change:"Mudan√ßa de Est√°gio",status_change:"Mudan√ßa de Status",lead_created:"Lead Criado",lead_assigned:"Lead Atribu√≠do",field_change:"Altera√ß√£o",other:"Outro"})[t]||t;function lr({leadId:t,showOnlyHistory:e=!1}){const[s,n]=u.useState([]),[a,o]=u.useState(!0);u.useEffect(()=>{i()},[t]);const i=async()=>{try{o(!0);const f=await ye.getLeadActivities(t);n(f)}catch(f){console.error("Erro ao carregar atividades:",f),O.error("Erro ao carregar atividades")}finally{o(!1)}},c=async f=>{try{await ye.completeActivity(f),O.success("Atividade conclu√≠da!"),await i()}catch(b){console.error("Erro ao concluir atividade:",b),O.error("Erro ao concluir atividade")}},l=f=>{try{return zr(new Date(f),"dd 'de' MMMM '√†s' HH:mm",{locale:fs})}catch{return f}},h=["stage_change","status_change","lead_created","lead_assigned","field_change"],d=["call","email","meeting","task","note","whatsapp","sms","other"],g=e?s.filter(f=>h.includes(f.type)):s.filter(f=>d.includes(f.type));return a?r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}):r.jsxs("div",{className:"space-y-4",children:[r.jsx("div",{className:"flex items-center justify-between",children:r.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:[e?"Hist√≥rico":"Atividades"," (",g.length,")"]})}),g.length===0?r.jsxs("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:[r.jsx(Ge,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),r.jsx("p",{className:"text-gray-600 text-sm",children:e?"Nenhuma altera√ß√£o registrada ainda":'Nenhuma atividade criada ainda. Use o bot√£o "Nova Atividade" para adicionar follow-ups, liga√ß√µes, reuni√µes e mais.'})]}):r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute left-5 top-0 bottom-0 w-0.5 bg-gray-200"}),r.jsx("div",{className:"space-y-4",children:g.map(f=>r.jsxs("div",{className:"relative flex gap-4",children:[r.jsx("div",{className:`flex-shrink-0 w-10 h-10 rounded-full border-2 flex items-center justify-center ${cr(f.type)} z-10`,children:fi(f.type)}),r.jsx("div",{className:"flex-1 pb-8",children:r.jsxs("div",{className:`bg-white rounded-lg border p-4 shadow-sm ${f.isCompleted?"opacity-70":""}`,children:[r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("h4",{className:"font-semibold text-gray-900 text-sm",children:f.title}),r.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${cr(f.type)}`,children:gi(f.type)})]}),f.description&&r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:f.description})]}),!f.isCompleted&&(f.type==="task"||f.type==="call"||f.type==="meeting")&&r.jsx("button",{onClick:()=>c(f.id),className:"flex-shrink-0 p-1.5 text-green-600 hover:bg-green-50 rounded-full transition-colors",title:"Marcar como conclu√≠da",children:r.jsx(us,{className:"w-4 h-4"})})]}),r.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 mt-2",children:[r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Ge,{className:"w-3 h-3"}),l(f.createdAt)]}),f.user&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx(Xe,{className:"w-3 h-3"}),f.user.name]}),f.scheduledAt&&r.jsxs("span",{className:"flex items-center gap-1 text-orange-600",children:[r.jsx(ks,{className:"w-3 h-3"}),"Agendado: ",l(f.scheduledAt)]}),f.isCompleted&&f.completedAt&&r.jsxs("span",{className:"flex items-center gap-1 text-green-600",children:[r.jsx(us,{className:"w-3 h-3"}),"Conclu√≠da: ",l(f.completedAt)]})]})]})})]},f.id))})]})]})}function pi({onSubmit:t,onCancel:e}){const[s,n]=u.useState(!1),[a,o]=u.useState({type:"note",title:"",description:"",scheduledAt:""}),i=async l=>{if(l.preventDefault(),!a.title.trim()){O.error("T√≠tulo √© obrigat√≥rio");return}n(!0);try{const h={type:a.type,title:a.title,description:a.description||void 0,scheduledAt:a.scheduledAt?new Date(a.scheduledAt).toISOString():void 0};await t(h),O.success("Atividade criada com sucesso")}catch(h){O.error(h.message||"Erro ao criar atividade")}finally{n(!1)}},c=(l,h)=>{o(d=>({...d,[l]:h}))};return r.jsxs("form",{onSubmit:i,className:"space-y-4",children:[r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tipo de Atividade ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsxs("select",{value:a.type,onChange:l=>c("type",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",required:!0,children:[r.jsx("option",{value:"note",children:"üìù Nota"}),r.jsx("option",{value:"call",children:"üìû Liga√ß√£o"}),r.jsx("option",{value:"email",children:"üìß E-mail"}),r.jsx("option",{value:"meeting",children:"üìÖ Reuni√£o"}),r.jsx("option",{value:"task",children:"‚úÖ Tarefa"}),r.jsx("option",{value:"whatsapp",children:"üí¨ WhatsApp"}),r.jsx("option",{value:"sms",children:"üì± SMS"}),r.jsx("option",{value:"other",children:"üîπ Outro"})]})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["T√≠tulo ",r.jsx("span",{className:"text-red-500",children:"*"})]}),r.jsx("input",{type:"text",value:a.title,onChange:l=>c("title",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Ex: Ligar para agendar consulta",required:!0})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Descri√ß√£o"}),r.jsx("textarea",{value:a.description,onChange:l=>c("description",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Detalhes da atividade...",rows:3})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Agendar para"}),r.jsx("input",{type:"datetime-local",value:a.scheduledAt,onChange:l=>c("scheduledAt",l.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Opcional: Defina uma data/hora para ser lembrado desta atividade"})]}),r.jsxs("div",{className:"flex items-center justify-end gap-3 pt-4 border-t",children:[r.jsx("button",{type:"button",onClick:e,className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",disabled:s,children:"Cancelar"}),r.jsx("button",{type:"submit",className:"px-4 py-2 text-white bg-primary-600 rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",disabled:s,children:s?"Criando...":"Criar Atividade"})]})]})}function xi({lead:t,stages:e,onSubmit:s,onClose:n}){const[a,o]=u.useState("details"),[i,c]=u.useState(!1),[l,h]=u.useState(0),d=async g=>{t&&(await ye.createActivity(t.id,g),c(!1),h(f=>f+1))};return r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 mb-6",children:[r.jsxs("div",{className:"flex gap-6",children:[r.jsxs("button",{onClick:()=>o("details"),className:`flex items-center gap-2 px-1 py-3 border-b-2 font-medium text-sm transition-colors ${a==="details"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[r.jsx(Lr,{className:"w-4 h-4"}),"Detalhes"]}),t&&r.jsxs("button",{onClick:()=>o("activities"),className:`flex items-center gap-2 px-1 py-3 border-b-2 font-medium text-sm transition-colors ${a==="activities"?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:[r.jsx(Ge,{className:"w-4 h-4"}),"Hist√≥rico"]})]}),a==="details"&&t&&r.jsxs("button",{onClick:()=>c(!0),className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-primary-600 bg-primary-50 rounded-lg hover:bg-primary-100 transition-colors",children:[r.jsx(Yn,{className:"w-4 h-4"}),"Nova Atividade"]})]}),r.jsxs("div",{children:[a==="details"&&r.jsxs("div",{className:"space-y-6",children:[r.jsx(Na,{onSubmit:s,onCancel:n,initialData:t,stages:e}),t&&r.jsxs("div",{className:"border-t pt-6",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Atividades e Follow-ups"}),r.jsx(lr,{leadId:t.id,showOnlyHistory:!1},`activities-${l}`)]})]}),a==="activities"&&t&&r.jsxs("div",{children:[r.jsx("div",{className:"mb-4",children:r.jsx("p",{className:"text-sm text-gray-600",children:"Hist√≥rico de altera√ß√µes e atividades realizadas neste lead"})}),r.jsx(lr,{leadId:t.id,showOnlyHistory:!0},`history-${l}`)]})]}),i&&r.jsx(Pr,{isOpen:i,onClose:()=>c(!1),title:"Nova Atividade",size:"md",children:r.jsx(pi,{onSubmit:d,onCancel:()=>c(!1)})})]})}function yi({isOpen:t,onClose:e,stages:s,filters:n,onApplyFilters:a,onClearFilters:o}){const[i,c]=u.useState(n),[l,h]=u.useState([]),[d,g]=u.useState([]);u.useEffect(()=>{f()},[]),u.useEffect(()=>{c(n)},[n]);const f=async()=>{try{const[v,C]=await Promise.all([ye.getProcedures(),Ir.getUsers()]);h(v),g(C)}catch(v){console.error("Erro ao carregar dados:",v)}},b=(v,C)=>{c(p=>({...p,[v]:C||void 0}))},w=()=>{a(i),e()},x=()=>{c({}),o()},S=Object.keys(n).filter(v=>n[v]!==void 0&&n[v]!=="").length;return t?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-start justify-end",children:r.jsxs("div",{className:"bg-white h-full w-full max-w-md shadow-xl flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Hn,{className:"w-5 h-5 text-gray-600"}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Filtros"}),S>0&&r.jsx("span",{className:"px-2 py-0.5 bg-primary-100 text-primary-600 text-xs font-medium rounded-full",children:S})]}),r.jsx("button",{onClick:e,className:"p-1 hover:bg-gray-100 rounded-lg transition-colors",children:r.jsx(ut,{className:"w-5 h-5 text-gray-500"})})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Buscar por nome"}),r.jsxs("div",{className:"relative",children:[r.jsx(Dr,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),r.jsx("input",{type:"text",value:i.search||"",onChange:v=>b("search",v.target.value),placeholder:"Digite o nome do lead...",className:"w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Est√°gio"}),r.jsxs("select",{value:i.stageId||"",onChange:v=>b("stageId",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"",children:"Todos os est√°gios"}),s.map(v=>r.jsx("option",{value:v.id,children:v.name},v.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Procedimento"}),r.jsxs("select",{value:i.procedureId||"",onChange:v=>b("procedureId",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"",children:"Todos os procedimentos"}),l.map(v=>r.jsx("option",{value:v.id,children:v.name},v.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Respons√°vel"}),r.jsxs("select",{value:i.assignedToId||"",onChange:v=>b("assignedToId",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"",children:"Todos os respons√°veis"}),d.map(v=>r.jsx("option",{value:v.id,children:v.name},v.id))]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status do Cliente"}),r.jsxs("select",{value:i.clientStatus||"",onChange:v=>b("clientStatus",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"",children:"Todos os status"}),r.jsx("option",{value:"novo",children:"Novo"}),r.jsx("option",{value:"recorrente",children:"Recorrente"}),r.jsx("option",{value:"vip",children:"VIP"}),r.jsx("option",{value:"retorno",children:"Retorno"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Canal de Comunica√ß√£o"}),r.jsxs("select",{value:i.channel||"",onChange:v=>b("channel",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"",children:"Todos os canais"}),r.jsx("option",{value:"whatsapp",children:"WhatsApp"}),r.jsx("option",{value:"phone",children:"Telefone"}),r.jsx("option",{value:"email",children:"E-mail"}),r.jsx("option",{value:"instagram",children:"Instagram"}),r.jsx("option",{value:"facebook",children:"Facebook"}),r.jsx("option",{value:"website",children:"Site"}),r.jsx("option",{value:"indication",children:"Indica√ß√£o"}),r.jsx("option",{value:"other",children:"Outro"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Local de Atendimento"}),r.jsxs("select",{value:i.attendanceLocation||"",onChange:v=>b("attendanceLocation",v.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:[r.jsx("option",{value:"",children:"Todos os locais"}),r.jsx("option",{value:"clinic",children:"Cl√≠nica"}),r.jsx("option",{value:"home",children:"Domic√≠lio"}),r.jsx("option",{value:"online",children:"Online"}),r.jsx("option",{value:"hospital",children:"Hospital"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor Estimado"}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"M√≠nimo"}),r.jsx("input",{type:"number",value:i.minValue||"",onChange:v=>b("minValue",v.target.value?parseFloat(v.target.value):void 0),placeholder:"R$ 0",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-xs text-gray-500 mb-1",children:"M√°ximo"}),r.jsx("input",{type:"number",value:i.maxValue||"",onChange:v=>b("maxValue",v.target.value?parseFloat(v.target.value):void 0),placeholder:"R$ 10.000",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]})]})]})]}),r.jsxs("div",{className:"p-4 border-t bg-gray-50 flex gap-3",children:[r.jsx("button",{onClick:x,className:"flex-1 px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 font-medium",children:"Limpar Filtros"}),r.jsx("button",{onClick:w,className:"flex-1 px-4 py-2 text-white bg-primary-600 rounded-lg hover:bg-primary-700 font-medium",children:"Aplicar Filtros"})]})]})}):null}class bi extends u.Component{constructor(){super(...arguments);Qs(this,"state",{hasError:!1,error:null})}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,n){console.error("ErrorBoundary caught an error:",s,n)}render(){var s;return this.state.hasError?this.props.fallback?this.props.fallback:r.jsxs("div",{className:"p-6 bg-red-50 border border-red-200 rounded-lg",children:[r.jsx("h3",{className:"text-lg font-semibold text-red-900 mb-2",children:"Algo deu errado"}),r.jsx("p",{className:"text-sm text-red-700 mb-4",children:((s=this.state.error)==null?void 0:s.message)||"Ocorreu um erro inesperado"}),r.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null}),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700",children:"Tentar novamente"})]}):this.props.children}}const Ut=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Ze(t){const e=Object.prototype.toString.call(t);return e==="[object Window]"||e==="[object global]"}function Es(t){return"nodeType"in t}function se(t){var e,s;return t?Ze(t)?t:Es(t)&&(e=(s=t.ownerDocument)==null?void 0:s.defaultView)!=null?e:window:window}function As(t){const{Document:e}=se(t);return t instanceof e}function xt(t){return Ze(t)?!1:t instanceof se(t).HTMLElement}function Ur(t){return t instanceof se(t).SVGElement}function et(t){return t?Ze(t)?t.document:Es(t)?As(t)?t:xt(t)||Ur(t)?t.ownerDocument:document:document:document}const Ae=Ut?u.useLayoutEffect:u.useEffect;function Yt(t){const e=u.useRef(t);return Ae(()=>{e.current=t}),u.useCallback(function(){for(var s=arguments.length,n=new Array(s),a=0;a<s;a++)n[a]=arguments[a];return e.current==null?void 0:e.current(...n)},[])}function vi(){const t=u.useRef(null),e=u.useCallback((n,a)=>{t.current=setInterval(n,a)},[]),s=u.useCallback(()=>{t.current!==null&&(clearInterval(t.current),t.current=null)},[]);return[e,s]}function mt(t,e){e===void 0&&(e=[t]);const s=u.useRef(t);return Ae(()=>{s.current!==t&&(s.current=t)},e),s}function yt(t,e){const s=u.useRef();return u.useMemo(()=>{const n=t(s.current);return s.current=n,n},[...e])}function It(t){const e=Yt(t),s=u.useRef(null),n=u.useCallback(a=>{a!==s.current&&(e==null||e(a,s.current)),s.current=a},[]);return[s,n]}function Bt(t){const e=u.useRef();return u.useEffect(()=>{e.current=t},[t]),e.current}let ss={};function Ht(t,e){return u.useMemo(()=>{if(e)return e;const s=ss[t]==null?0:ss[t]+1;return ss[t]=s,t+"-"+s},[t,e])}function Yr(t){return function(e){for(var s=arguments.length,n=new Array(s>1?s-1:0),a=1;a<s;a++)n[a-1]=arguments[a];return n.reduce((o,i)=>{const c=Object.entries(i);for(const[l,h]of c){const d=o[l];d!=null&&(o[l]=d+t*h)}return o},{...e})}}const Ke=Yr(1),Wt=Yr(-1);function wi(t){return"clientX"in t&&"clientY"in t}function Rs(t){if(!t)return!1;const{KeyboardEvent:e}=se(t.target);return e&&t instanceof e}function ji(t){if(!t)return!1;const{TouchEvent:e}=se(t.target);return e&&t instanceof e}function qt(t){if(ji(t)){if(t.touches&&t.touches.length){const{clientX:e,clientY:s}=t.touches[0];return{x:e,y:s}}else if(t.changedTouches&&t.changedTouches.length){const{clientX:e,clientY:s}=t.changedTouches[0];return{x:e,y:s}}}return wi(t)?{x:t.clientX,y:t.clientY}:null}const Je=Object.freeze({Translate:{toString(t){if(!t)return;const{x:e,y:s}=t;return"translate3d("+(e?Math.round(e):0)+"px, "+(s?Math.round(s):0)+"px, 0)"}},Scale:{toString(t){if(!t)return;const{scaleX:e,scaleY:s}=t;return"scaleX("+e+") scaleY("+s+")"}},Transform:{toString(t){if(t)return[Je.Translate.toString(t),Je.Scale.toString(t)].join(" ")}},Transition:{toString(t){let{property:e,duration:s,easing:n}=t;return e+" "+s+"ms "+n}}}),dr="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Ni(t){return t.matches(dr)?t:t.querySelector(dr)}const ki={display:"none"};function Ci(t){let{id:e,value:s}=t;return Y.createElement("div",{id:e,style:ki},s)}function Si(t){let{id:e,announcement:s,ariaLiveType:n="assertive"}=t;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return Y.createElement("div",{id:e,style:a,role:"status","aria-live":n,"aria-atomic":!0},s)}function Ei(){const[t,e]=u.useState("");return{announce:u.useCallback(n=>{n!=null&&e(n)},[]),announcement:t}}const Hr=u.createContext(null);function Ai(t){const e=u.useContext(Hr);u.useEffect(()=>{if(!e)throw new Error("useDndMonitor must be used within a children of <DndContext>");return e(t)},[t,e])}function Ri(){const[t]=u.useState(()=>new Set),e=u.useCallback(n=>(t.add(n),()=>t.delete(n)),[t]);return[u.useCallback(n=>{let{type:a,event:o}=n;t.forEach(i=>{var c;return(c=i[a])==null?void 0:c.call(i,o)})},[t]),e]}const Ti={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},_i={onDragStart(t){let{active:e}=t;return"Picked up draggable item "+e.id+"."},onDragOver(t){let{active:e,over:s}=t;return s?"Draggable item "+e.id+" was moved over droppable area "+s.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(t){let{active:e,over:s}=t;return s?"Draggable item "+e.id+" was dropped over droppable area "+s.id:"Draggable item "+e.id+" was dropped."},onDragCancel(t){let{active:e}=t;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function Oi(t){let{announcements:e=_i,container:s,hiddenTextDescribedById:n,screenReaderInstructions:a=Ti}=t;const{announce:o,announcement:i}=Ei(),c=Ht("DndLiveRegion"),[l,h]=u.useState(!1);if(u.useEffect(()=>{h(!0)},[]),Ai(u.useMemo(()=>({onDragStart(g){let{active:f}=g;o(e.onDragStart({active:f}))},onDragMove(g){let{active:f,over:b}=g;e.onDragMove&&o(e.onDragMove({active:f,over:b}))},onDragOver(g){let{active:f,over:b}=g;o(e.onDragOver({active:f,over:b}))},onDragEnd(g){let{active:f,over:b}=g;o(e.onDragEnd({active:f,over:b}))},onDragCancel(g){let{active:f,over:b}=g;o(e.onDragCancel({active:f,over:b}))}}),[o,e])),!l)return null;const d=Y.createElement(Y.Fragment,null,Y.createElement(Ci,{id:n,value:a.draggable}),Y.createElement(Si,{id:c,announcement:i}));return s?Fe.createPortal(d,s):d}var K;(function(t){t.DragStart="dragStart",t.DragMove="dragMove",t.DragEnd="dragEnd",t.DragCancel="dragCancel",t.DragOver="dragOver",t.RegisterDroppable="registerDroppable",t.SetDroppableDisabled="setDroppableDisabled",t.UnregisterDroppable="unregisterDroppable"})(K||(K={}));function Ft(){}function Mi(t,e){return u.useMemo(()=>({sensor:t,options:e??{}}),[t,e])}function Li(){for(var t=arguments.length,e=new Array(t),s=0;s<t;s++)e[s]=arguments[s];return u.useMemo(()=>[...e].filter(n=>n!=null),[...e])}const be=Object.freeze({x:0,y:0});function Di(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Pi(t,e){const s=qt(t);if(!s)return"0 0";const n={x:(s.x-e.left)/e.width*100,y:(s.y-e.top)/e.height*100};return n.x+"% "+n.y+"%"}function Ii(t,e){let{data:{value:s}}=t,{data:{value:n}}=e;return s-n}function Bi(t,e){let{data:{value:s}}=t,{data:{value:n}}=e;return n-s}function ur(t){let{left:e,top:s,height:n,width:a}=t;return[{x:e,y:s},{x:e+a,y:s},{x:e,y:s+n},{x:e+a,y:s+n}]}function Wi(t,e){if(!t||t.length===0)return null;const[s]=t;return s[e]}const qi=t=>{let{collisionRect:e,droppableRects:s,droppableContainers:n}=t;const a=ur(e),o=[];for(const i of n){const{id:c}=i,l=s.get(c);if(l){const h=ur(l),d=a.reduce((f,b,w)=>f+Di(h[w],b),0),g=Number((d/4).toFixed(4));o.push({id:c,data:{droppableContainer:i,value:g}})}}return o.sort(Ii)};function Fi(t,e){const s=Math.max(e.top,t.top),n=Math.max(e.left,t.left),a=Math.min(e.left+e.width,t.left+t.width),o=Math.min(e.top+e.height,t.top+t.height),i=a-n,c=o-s;if(n<a&&s<o){const l=e.width*e.height,h=t.width*t.height,d=i*c,g=d/(l+h-d);return Number(g.toFixed(4))}return 0}const $i=t=>{let{collisionRect:e,droppableRects:s,droppableContainers:n}=t;const a=[];for(const o of n){const{id:i}=o,c=s.get(i);if(c){const l=Fi(c,e);l>0&&a.push({id:i,data:{droppableContainer:o,value:l}})}}return a.sort(Bi)};function Vi(t,e,s){return{...t,scaleX:e&&s?e.width/s.width:1,scaleY:e&&s?e.height/s.height:1}}function Xr(t,e){return t&&e?{x:t.left-e.left,y:t.top-e.top}:be}function zi(t){return function(s){for(var n=arguments.length,a=new Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return a.reduce((i,c)=>({...i,top:i.top+t*c.y,bottom:i.bottom+t*c.y,left:i.left+t*c.x,right:i.right+t*c.x}),{...s})}}const Ui=zi(1);function Qr(t){if(t.startsWith("matrix3d(")){const e=t.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}else if(t.startsWith("matrix(")){const e=t.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}function Yi(t,e,s){const n=Qr(e);if(!n)return t;const{scaleX:a,scaleY:o,x:i,y:c}=n,l=t.left-i-(1-a)*parseFloat(s),h=t.top-c-(1-o)*parseFloat(s.slice(s.indexOf(" ")+1)),d=a?t.width/a:t.width,g=o?t.height/o:t.height;return{width:d,height:g,top:h,right:l+d,bottom:h+g,left:l}}const Hi={ignoreTransform:!1};function bt(t,e){e===void 0&&(e=Hi);let s=t.getBoundingClientRect();if(e.ignoreTransform){const{transform:h,transformOrigin:d}=se(t).getComputedStyle(t);h&&(s=Yi(s,h,d))}const{top:n,left:a,width:o,height:i,bottom:c,right:l}=s;return{top:n,left:a,width:o,height:i,bottom:c,right:l}}function hr(t){return bt(t,{ignoreTransform:!0})}function Xi(t){const e=t.innerWidth,s=t.innerHeight;return{top:0,left:0,right:e,bottom:s,width:e,height:s}}function Qi(t,e){return e===void 0&&(e=se(t).getComputedStyle(t)),e.position==="fixed"}function Ki(t,e){e===void 0&&(e=se(t).getComputedStyle(t));const s=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const o=e[a];return typeof o=="string"?s.test(o):!1})}function Ts(t,e){const s=[];function n(a){if(e!=null&&s.length>=e||!a)return s;if(As(a)&&a.scrollingElement!=null&&!s.includes(a.scrollingElement))return s.push(a.scrollingElement),s;if(!xt(a)||Ur(a)||s.includes(a))return s;const o=se(t).getComputedStyle(a);return a!==t&&Ki(a,o)&&s.push(a),Qi(a,o)?s:n(a.parentNode)}return t?n(t):s}function Kr(t){const[e]=Ts(t,1);return e??null}function rs(t){return!Ut||!t?null:Ze(t)?t:Es(t)?As(t)||t===et(t).scrollingElement?window:xt(t)?t:null:null}function Gr(t){return Ze(t)?t.scrollX:t.scrollLeft}function Jr(t){return Ze(t)?t.scrollY:t.scrollTop}function gs(t){return{x:Gr(t),y:Jr(t)}}var G;(function(t){t[t.Forward=1]="Forward",t[t.Backward=-1]="Backward"})(G||(G={}));function Zr(t){return!Ut||!t?!1:t===document.scrollingElement}function en(t){const e={x:0,y:0},s=Zr(t)?{height:window.innerHeight,width:window.innerWidth}:{height:t.clientHeight,width:t.clientWidth},n={x:t.scrollWidth-s.width,y:t.scrollHeight-s.height},a=t.scrollTop<=e.y,o=t.scrollLeft<=e.x,i=t.scrollTop>=n.y,c=t.scrollLeft>=n.x;return{isTop:a,isLeft:o,isBottom:i,isRight:c,maxScroll:n,minScroll:e}}const Gi={x:.2,y:.2};function Ji(t,e,s,n,a){let{top:o,left:i,right:c,bottom:l}=s;n===void 0&&(n=10),a===void 0&&(a=Gi);const{isTop:h,isBottom:d,isLeft:g,isRight:f}=en(t),b={x:0,y:0},w={x:0,y:0},x={height:e.height*a.y,width:e.width*a.x};return!h&&o<=e.top+x.height?(b.y=G.Backward,w.y=n*Math.abs((e.top+x.height-o)/x.height)):!d&&l>=e.bottom-x.height&&(b.y=G.Forward,w.y=n*Math.abs((e.bottom-x.height-l)/x.height)),!f&&c>=e.right-x.width?(b.x=G.Forward,w.x=n*Math.abs((e.right-x.width-c)/x.width)):!g&&i<=e.left+x.width&&(b.x=G.Backward,w.x=n*Math.abs((e.left+x.width-i)/x.width)),{direction:b,speed:w}}function Zi(t){if(t===document.scrollingElement){const{innerWidth:o,innerHeight:i}=window;return{top:0,left:0,right:o,bottom:i,width:o,height:i}}const{top:e,left:s,right:n,bottom:a}=t.getBoundingClientRect();return{top:e,left:s,right:n,bottom:a,width:t.clientWidth,height:t.clientHeight}}function tn(t){return t.reduce((e,s)=>Ke(e,gs(s)),be)}function ec(t){return t.reduce((e,s)=>e+Gr(s),0)}function tc(t){return t.reduce((e,s)=>e+Jr(s),0)}function sn(t,e){if(e===void 0&&(e=bt),!t)return;const{top:s,left:n,bottom:a,right:o}=e(t);Kr(t)&&(a<=0||o<=0||s>=window.innerHeight||n>=window.innerWidth)&&t.scrollIntoView({block:"center",inline:"center"})}const sc=[["x",["left","right"],ec],["y",["top","bottom"],tc]];class _s{constructor(e,s){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=Ts(s),a=tn(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[o,i,c]of sc)for(const l of i)Object.defineProperty(this,l,{get:()=>{const h=c(n),d=a[o]-h;return this.rect[l]+d},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class ct{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(s=>{var n;return(n=this.target)==null?void 0:n.removeEventListener(...s)})},this.target=e}add(e,s,n){var a;(a=this.target)==null||a.addEventListener(e,s,n),this.listeners.push([e,s,n])}}function rc(t){const{EventTarget:e}=se(t);return t instanceof e?t:et(t)}function ns(t,e){const s=Math.abs(t.x),n=Math.abs(t.y);return typeof e=="number"?Math.sqrt(s**2+n**2)>e:"x"in e&&"y"in e?s>e.x&&n>e.y:"x"in e?s>e.x:"y"in e?n>e.y:!1}var ge;(function(t){t.Click="click",t.DragStart="dragstart",t.Keydown="keydown",t.ContextMenu="contextmenu",t.Resize="resize",t.SelectionChange="selectionchange",t.VisibilityChange="visibilitychange"})(ge||(ge={}));function mr(t){t.preventDefault()}function nc(t){t.stopPropagation()}var $;(function(t){t.Space="Space",t.Down="ArrowDown",t.Right="ArrowRight",t.Left="ArrowLeft",t.Up="ArrowUp",t.Esc="Escape",t.Enter="Enter",t.Tab="Tab"})($||($={}));const rn={start:[$.Space,$.Enter],cancel:[$.Esc],end:[$.Space,$.Enter,$.Tab]},ac=(t,e)=>{let{currentCoordinates:s}=e;switch(t.code){case $.Right:return{...s,x:s.x+25};case $.Left:return{...s,x:s.x-25};case $.Down:return{...s,y:s.y+25};case $.Up:return{...s,y:s.y-25}}};class nn{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:s}}=e;this.props=e,this.listeners=new ct(et(s)),this.windowListeners=new ct(se(s)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(ge.Resize,this.handleCancel),this.windowListeners.add(ge.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(ge.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:s}=this.props,n=e.node.current;n&&sn(n),s(be)}handleKeyDown(e){if(Rs(e)){const{active:s,context:n,options:a}=this.props,{keyboardCodes:o=rn,coordinateGetter:i=ac,scrollBehavior:c="smooth"}=a,{code:l}=e;if(o.end.includes(l)){this.handleEnd(e);return}if(o.cancel.includes(l)){this.handleCancel(e);return}const{collisionRect:h}=n.current,d=h?{x:h.left,y:h.top}:be;this.referenceCoordinates||(this.referenceCoordinates=d);const g=i(e,{active:s,context:n.current,currentCoordinates:d});if(g){const f=Wt(g,d),b={x:0,y:0},{scrollableAncestors:w}=n.current;for(const x of w){const S=e.code,{isTop:v,isRight:C,isLeft:p,isBottom:T,maxScroll:m,minScroll:E}=en(x),A=Zi(x),R={x:Math.min(S===$.Right?A.right-A.width/2:A.right,Math.max(S===$.Right?A.left:A.left+A.width/2,g.x)),y:Math.min(S===$.Down?A.bottom-A.height/2:A.bottom,Math.max(S===$.Down?A.top:A.top+A.height/2,g.y))},I=S===$.Right&&!C||S===$.Left&&!p,B=S===$.Down&&!T||S===$.Up&&!v;if(I&&R.x!==g.x){const D=x.scrollLeft+f.x,U=S===$.Right&&D<=m.x||S===$.Left&&D>=E.x;if(U&&!f.y){x.scrollTo({left:D,behavior:c});return}U?b.x=x.scrollLeft-D:b.x=S===$.Right?x.scrollLeft-m.x:x.scrollLeft-E.x,b.x&&x.scrollBy({left:-b.x,behavior:c});break}else if(B&&R.y!==g.y){const D=x.scrollTop+f.y,U=S===$.Down&&D<=m.y||S===$.Up&&D>=E.y;if(U&&!f.x){x.scrollTo({top:D,behavior:c});return}U?b.y=x.scrollTop-D:b.y=S===$.Down?x.scrollTop-m.y:x.scrollTop-E.y,b.y&&x.scrollBy({top:-b.y,behavior:c});break}}this.handleMove(e,Ke(Wt(g,this.referenceCoordinates),b))}}}handleMove(e,s){const{onMove:n}=this.props;e.preventDefault(),n(s)}handleEnd(e){const{onEnd:s}=this.props;e.preventDefault(),this.detach(),s()}handleCancel(e){const{onCancel:s}=this.props;e.preventDefault(),this.detach(),s()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}nn.activators=[{eventName:"onKeyDown",handler:(t,e,s)=>{let{keyboardCodes:n=rn,onActivation:a}=e,{active:o}=s;const{code:i}=t.nativeEvent;if(n.start.includes(i)){const c=o.activatorNode.current;return c&&t.target!==c?!1:(t.preventDefault(),a==null||a({event:t.nativeEvent}),!0)}return!1}}];function fr(t){return!!(t&&"distance"in t)}function gr(t){return!!(t&&"delay"in t)}class Os{constructor(e,s,n){var a;n===void 0&&(n=rc(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=s;const{event:o}=e,{target:i}=o;this.props=e,this.events=s,this.document=et(i),this.documentListeners=new ct(this.document),this.listeners=new ct(n),this.windowListeners=new ct(se(i)),this.initialCoordinates=(a=qt(o))!=null?a:be,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:s,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(ge.Resize,this.handleCancel),this.windowListeners.add(ge.DragStart,mr),this.windowListeners.add(ge.VisibilityChange,this.handleCancel),this.windowListeners.add(ge.ContextMenu,mr),this.documentListeners.add(ge.Keydown,this.handleKeydown),s){if(n!=null&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(gr(s)){this.timeoutId=setTimeout(this.handleStart,s.delay),this.handlePending(s);return}if(fr(s)){this.handlePending(s);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,s){const{active:n,onPending:a}=this.props;a(n,e,this.initialCoordinates,s)}handleStart(){const{initialCoordinates:e}=this,{onStart:s}=this.props;e&&(this.activated=!0,this.documentListeners.add(ge.Click,nc,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(ge.SelectionChange,this.removeTextSelection),s(e))}handleMove(e){var s;const{activated:n,initialCoordinates:a,props:o}=this,{onMove:i,options:{activationConstraint:c}}=o;if(!a)return;const l=(s=qt(e))!=null?s:be,h=Wt(a,l);if(!n&&c){if(fr(c)){if(c.tolerance!=null&&ns(h,c.tolerance))return this.handleCancel();if(ns(h,c.distance))return this.handleStart()}if(gr(c)&&ns(h,c.tolerance))return this.handleCancel();this.handlePending(c,h);return}e.cancelable&&e.preventDefault(),i(l)}handleEnd(){const{onAbort:e,onEnd:s}=this.props;this.detach(),this.activated||e(this.props.active),s()}handleCancel(){const{onAbort:e,onCancel:s}=this.props;this.detach(),this.activated||e(this.props.active),s()}handleKeydown(e){e.code===$.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const oc={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Ms extends Os{constructor(e){const{event:s}=e,n=et(s.target);super(e,oc,n)}}Ms.activators=[{eventName:"onPointerDown",handler:(t,e)=>{let{nativeEvent:s}=t,{onActivation:n}=e;return!s.isPrimary||s.button!==0?!1:(n==null||n({event:s}),!0)}}];const ic={move:{name:"mousemove"},end:{name:"mouseup"}};var ps;(function(t){t[t.RightClick=2]="RightClick"})(ps||(ps={}));class cc extends Os{constructor(e){super(e,ic,et(e.event.target))}}cc.activators=[{eventName:"onMouseDown",handler:(t,e)=>{let{nativeEvent:s}=t,{onActivation:n}=e;return s.button===ps.RightClick?!1:(n==null||n({event:s}),!0)}}];const as={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class lc extends Os{constructor(e){super(e,as)}static setup(){return window.addEventListener(as.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(as.move.name,e)};function e(){}}}lc.activators=[{eventName:"onTouchStart",handler:(t,e)=>{let{nativeEvent:s}=t,{onActivation:n}=e;const{touches:a}=s;return a.length>1?!1:(n==null||n({event:s}),!0)}}];var lt;(function(t){t[t.Pointer=0]="Pointer",t[t.DraggableRect=1]="DraggableRect"})(lt||(lt={}));var $t;(function(t){t[t.TreeOrder=0]="TreeOrder",t[t.ReversedTreeOrder=1]="ReversedTreeOrder"})($t||($t={}));function dc(t){let{acceleration:e,activator:s=lt.Pointer,canScroll:n,draggingRect:a,enabled:o,interval:i=5,order:c=$t.TreeOrder,pointerCoordinates:l,scrollableAncestors:h,scrollableAncestorRects:d,delta:g,threshold:f}=t;const b=hc({delta:g,disabled:!o}),[w,x]=vi(),S=u.useRef({x:0,y:0}),v=u.useRef({x:0,y:0}),C=u.useMemo(()=>{switch(s){case lt.Pointer:return l?{top:l.y,bottom:l.y,left:l.x,right:l.x}:null;case lt.DraggableRect:return a}},[s,a,l]),p=u.useRef(null),T=u.useCallback(()=>{const E=p.current;if(!E)return;const A=S.current.x*v.current.x,R=S.current.y*v.current.y;E.scrollBy(A,R)},[]),m=u.useMemo(()=>c===$t.TreeOrder?[...h].reverse():h,[c,h]);u.useEffect(()=>{if(!o||!h.length||!C){x();return}for(const E of m){if((n==null?void 0:n(E))===!1)continue;const A=h.indexOf(E),R=d[A];if(!R)continue;const{direction:I,speed:B}=Ji(E,R,C,e,f);for(const D of["x","y"])b[D][I[D]]||(B[D]=0,I[D]=0);if(B.x>0||B.y>0){x(),p.current=E,w(T,i),S.current=B,v.current=I;return}}S.current={x:0,y:0},v.current={x:0,y:0},x()},[e,T,n,x,o,i,JSON.stringify(C),JSON.stringify(b),w,h,m,d,JSON.stringify(f)])}const uc={x:{[G.Backward]:!1,[G.Forward]:!1},y:{[G.Backward]:!1,[G.Forward]:!1}};function hc(t){let{delta:e,disabled:s}=t;const n=Bt(e);return yt(a=>{if(s||!n||!a)return uc;const o={x:Math.sign(e.x-n.x),y:Math.sign(e.y-n.y)};return{x:{[G.Backward]:a.x[G.Backward]||o.x===-1,[G.Forward]:a.x[G.Forward]||o.x===1},y:{[G.Backward]:a.y[G.Backward]||o.y===-1,[G.Forward]:a.y[G.Forward]||o.y===1}}},[s,e,n])}function mc(t,e){const s=e!=null?t.get(e):void 0,n=s?s.node.current:null;return yt(a=>{var o;return e==null?null:(o=n??a)!=null?o:null},[n,e])}function fc(t,e){return u.useMemo(()=>t.reduce((s,n)=>{const{sensor:a}=n,o=a.activators.map(i=>({eventName:i.eventName,handler:e(i.handler,n)}));return[...s,...o]},[]),[t,e])}var ft;(function(t){t[t.Always=0]="Always",t[t.BeforeDragging=1]="BeforeDragging",t[t.WhileDragging=2]="WhileDragging"})(ft||(ft={}));var xs;(function(t){t.Optimized="optimized"})(xs||(xs={}));const pr=new Map;function gc(t,e){let{dragging:s,dependencies:n,config:a}=e;const[o,i]=u.useState(null),{frequency:c,measure:l,strategy:h}=a,d=u.useRef(t),g=S(),f=mt(g),b=u.useCallback(function(v){v===void 0&&(v=[]),!f.current&&i(C=>C===null?v:C.concat(v.filter(p=>!C.includes(p))))},[f]),w=u.useRef(null),x=yt(v=>{if(g&&!s)return pr;if(!v||v===pr||d.current!==t||o!=null){const C=new Map;for(let p of t){if(!p)continue;if(o&&o.length>0&&!o.includes(p.id)&&p.rect.current){C.set(p.id,p.rect.current);continue}const T=p.node.current,m=T?new _s(l(T),T):null;p.rect.current=m,m&&C.set(p.id,m)}return C}return v},[t,o,s,g,l]);return u.useEffect(()=>{d.current=t},[t]),u.useEffect(()=>{g||b()},[s,g]),u.useEffect(()=>{o&&o.length>0&&i(null)},[JSON.stringify(o)]),u.useEffect(()=>{g||typeof c!="number"||w.current!==null||(w.current=setTimeout(()=>{b(),w.current=null},c))},[c,g,b,...n]),{droppableRects:x,measureDroppableContainers:b,measuringScheduled:o!=null};function S(){switch(h){case ft.Always:return!1;case ft.BeforeDragging:return s;default:return!s}}}function Ls(t,e){return yt(s=>t?s||(typeof e=="function"?e(t):t):null,[e,t])}function pc(t,e){return Ls(t,e)}function xc(t){let{callback:e,disabled:s}=t;const n=Yt(e),a=u.useMemo(()=>{if(s||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(n)},[n,s]);return u.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function Xt(t){let{callback:e,disabled:s}=t;const n=Yt(e),a=u.useMemo(()=>{if(s||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(n)},[s]);return u.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function yc(t){return new _s(bt(t),t)}function xr(t,e,s){e===void 0&&(e=yc);const[n,a]=u.useState(null);function o(){a(l=>{if(!t)return null;if(t.isConnected===!1){var h;return(h=l??s)!=null?h:null}const d=e(t);return JSON.stringify(l)===JSON.stringify(d)?l:d})}const i=xc({callback(l){if(t)for(const h of l){const{type:d,target:g}=h;if(d==="childList"&&g instanceof HTMLElement&&g.contains(t)){o();break}}}}),c=Xt({callback:o});return Ae(()=>{o(),t?(c==null||c.observe(t),i==null||i.observe(document.body,{childList:!0,subtree:!0})):(c==null||c.disconnect(),i==null||i.disconnect())},[t]),n}function bc(t){const e=Ls(t);return Xr(t,e)}const yr=[];function vc(t){const e=u.useRef(t),s=yt(n=>t?n&&n!==yr&&t&&e.current&&t.parentNode===e.current.parentNode?n:Ts(t):yr,[t]);return u.useEffect(()=>{e.current=t},[t]),s}function wc(t){const[e,s]=u.useState(null),n=u.useRef(t),a=u.useCallback(o=>{const i=rs(o.target);i&&s(c=>c?(c.set(i,gs(i)),new Map(c)):null)},[]);return u.useEffect(()=>{const o=n.current;if(t!==o){i(o);const c=t.map(l=>{const h=rs(l);return h?(h.addEventListener("scroll",a,{passive:!0}),[h,gs(h)]):null}).filter(l=>l!=null);s(c.length?new Map(c):null),n.current=t}return()=>{i(t),i(o)};function i(c){c.forEach(l=>{const h=rs(l);h==null||h.removeEventListener("scroll",a)})}},[a,t]),u.useMemo(()=>t.length?e?Array.from(e.values()).reduce((o,i)=>Ke(o,i),be):tn(t):be,[t,e])}function br(t,e){e===void 0&&(e=[]);const s=u.useRef(null);return u.useEffect(()=>{s.current=null},e),u.useEffect(()=>{const n=t!==be;n&&!s.current&&(s.current=t),!n&&s.current&&(s.current=null)},[t]),s.current?Wt(t,s.current):be}function jc(t){u.useEffect(()=>{if(!Ut)return;const e=t.map(s=>{let{sensor:n}=s;return n.setup==null?void 0:n.setup()});return()=>{for(const s of e)s==null||s()}},t.map(e=>{let{sensor:s}=e;return s}))}function Nc(t,e){return u.useMemo(()=>t.reduce((s,n)=>{let{eventName:a,handler:o}=n;return s[a]=i=>{o(i,e)},s},{}),[t,e])}function an(t){return u.useMemo(()=>t?Xi(t):null,[t])}const vr=[];function kc(t,e){e===void 0&&(e=bt);const[s]=t,n=an(s?se(s):null),[a,o]=u.useState(vr);function i(){o(()=>t.length?t.map(l=>Zr(l)?n:new _s(e(l),l)):vr)}const c=Xt({callback:i});return Ae(()=>{c==null||c.disconnect(),i(),t.forEach(l=>c==null?void 0:c.observe(l))},[t]),a}function on(t){if(!t)return null;if(t.children.length>1)return t;const e=t.children[0];return xt(e)?e:t}function Cc(t){let{measure:e}=t;const[s,n]=u.useState(null),a=u.useCallback(h=>{for(const{target:d}of h)if(xt(d)){n(g=>{const f=e(d);return g?{...g,width:f.width,height:f.height}:f});break}},[e]),o=Xt({callback:a}),i=u.useCallback(h=>{const d=on(h);o==null||o.disconnect(),d&&(o==null||o.observe(d)),n(d?e(d):null)},[e,o]),[c,l]=It(i);return u.useMemo(()=>({nodeRef:c,rect:s,setRef:l}),[s,c,l])}const Sc=[{sensor:Ms,options:{}},{sensor:nn,options:{}}],Ec={current:{}},At={draggable:{measure:hr},droppable:{measure:hr,strategy:ft.WhileDragging,frequency:xs.Optimized},dragOverlay:{measure:bt}};class dt extends Map{get(e){var s;return e!=null&&(s=super.get(e))!=null?s:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:s}=e;return!s})}getNodeFor(e){var s,n;return(s=(n=this.get(e))==null?void 0:n.node.current)!=null?s:void 0}}const Ac={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new dt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ft},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:At,measureDroppableContainers:Ft,windowRect:null,measuringScheduled:!1},cn={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ft,draggableNodes:new Map,over:null,measureDroppableContainers:Ft},vt=u.createContext(cn),ln=u.createContext(Ac);function Rc(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new dt}}}function Tc(t,e){switch(e.type){case K.DragStart:return{...t,draggable:{...t.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case K.DragMove:return t.draggable.active==null?t:{...t,draggable:{...t.draggable,translate:{x:e.coordinates.x-t.draggable.initialCoordinates.x,y:e.coordinates.y-t.draggable.initialCoordinates.y}}};case K.DragEnd:case K.DragCancel:return{...t,draggable:{...t.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case K.RegisterDroppable:{const{element:s}=e,{id:n}=s,a=new dt(t.droppable.containers);return a.set(n,s),{...t,droppable:{...t.droppable,containers:a}}}case K.SetDroppableDisabled:{const{id:s,key:n,disabled:a}=e,o=t.droppable.containers.get(s);if(!o||n!==o.key)return t;const i=new dt(t.droppable.containers);return i.set(s,{...o,disabled:a}),{...t,droppable:{...t.droppable,containers:i}}}case K.UnregisterDroppable:{const{id:s,key:n}=e,a=t.droppable.containers.get(s);if(!a||n!==a.key)return t;const o=new dt(t.droppable.containers);return o.delete(s),{...t,droppable:{...t.droppable,containers:o}}}default:return t}}function _c(t){let{disabled:e}=t;const{active:s,activatorEvent:n,draggableNodes:a}=u.useContext(vt),o=Bt(n),i=Bt(s==null?void 0:s.id);return u.useEffect(()=>{if(!e&&!n&&o&&i!=null){if(!Rs(o)||document.activeElement===o.target)return;const c=a.get(i);if(!c)return;const{activatorNode:l,node:h}=c;if(!l.current&&!h.current)return;requestAnimationFrame(()=>{for(const d of[l.current,h.current]){if(!d)continue;const g=Ni(d);if(g){g.focus();break}}})}},[n,e,a,i,o]),null}function dn(t,e){let{transform:s,...n}=e;return t!=null&&t.length?t.reduce((a,o)=>o({transform:a,...n}),s):s}function Oc(t){return u.useMemo(()=>({draggable:{...At.draggable,...t==null?void 0:t.draggable},droppable:{...At.droppable,...t==null?void 0:t.droppable},dragOverlay:{...At.dragOverlay,...t==null?void 0:t.dragOverlay}}),[t==null?void 0:t.draggable,t==null?void 0:t.droppable,t==null?void 0:t.dragOverlay])}function Mc(t){let{activeNode:e,measure:s,initialRect:n,config:a=!0}=t;const o=u.useRef(!1),{x:i,y:c}=typeof a=="boolean"?{x:a,y:a}:a;Ae(()=>{if(!i&&!c||!e){o.current=!1;return}if(o.current||!n)return;const h=e==null?void 0:e.node.current;if(!h||h.isConnected===!1)return;const d=s(h),g=Xr(d,n);if(i||(g.x=0),c||(g.y=0),o.current=!0,Math.abs(g.x)>0||Math.abs(g.y)>0){const f=Kr(h);f&&f.scrollBy({top:g.y,left:g.x})}},[e,i,c,n,s])}const Qt=u.createContext({...be,scaleX:1,scaleY:1});var De;(function(t){t[t.Uninitialized=0]="Uninitialized",t[t.Initializing=1]="Initializing",t[t.Initialized=2]="Initialized"})(De||(De={}));const Lc=u.memo(function(e){var s,n,a,o;let{id:i,accessibility:c,autoScroll:l=!0,children:h,sensors:d=Sc,collisionDetection:g=$i,measuring:f,modifiers:b,...w}=e;const x=u.useReducer(Tc,void 0,Rc),[S,v]=x,[C,p]=Ri(),[T,m]=u.useState(De.Uninitialized),E=T===De.Initialized,{draggable:{active:A,nodes:R,translate:I},droppable:{containers:B}}=S,D=A!=null?R.get(A):null,U=u.useRef({initial:null,translated:null}),J=u.useMemo(()=>{var ee;return A!=null?{id:A,data:(ee=D==null?void 0:D.data)!=null?ee:Ec,rect:U}:null},[A,D]),F=u.useRef(null),[Q,$e]=u.useState(null),[ne,ce]=u.useState(null),le=mt(w,Object.values(w)),N=Ht("DndDescribedBy",i),M=u.useMemo(()=>B.getEnabled(),[B]),L=Oc(f),{droppableRects:H,measureDroppableContainers:y,measuringScheduled:_}=gc(M,{dragging:E,dependencies:[I.x,I.y],config:L.droppable}),k=mc(R,A),z=u.useMemo(()=>ne?qt(ne):null,[ne]),W=_n(),te=pc(k,L.draggable.measure);Mc({activeNode:A!=null?R.get(A):null,config:W.layoutShiftCompensation,initialRect:te,measure:L.draggable.measure});const de=xr(k,L.draggable.measure,te),Jt=xr(k?k.parentElement:null),Be=u.useRef({activatorEvent:null,active:null,activeNode:k,collisionRect:null,collisions:null,droppableRects:H,draggableNodes:R,draggingNode:null,draggingNodeRect:null,droppableContainers:B,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),qs=B.getNodeFor((s=Be.current.over)==null?void 0:s.id),We=Cc({measure:L.dragOverlay.measure}),wt=(n=We.nodeRef.current)!=null?n:k,Ve=E?(a=We.rect)!=null?a:de:null,Fs=!!(We.nodeRef.current&&We.rect),$s=bc(Fs?null:de),Zt=an(wt?se(wt):null),Re=vc(E?qs??k:null),jt=kc(Re),Nt=dn(b,{transform:{x:I.x-$s.x,y:I.y-$s.y,scaleX:1,scaleY:1},activatorEvent:ne,active:J,activeNodeRect:de,containerNodeRect:Jt,draggingNodeRect:Ve,over:Be.current.over,overlayNodeRect:We.rect,scrollableAncestors:Re,scrollableAncestorRects:jt,windowRect:Zt}),Vs=z?Ke(z,I):null,zs=wc(Re),kn=br(zs),Cn=br(zs,[de]),ze=Ke(Nt,kn),Ue=Ve?Ui(Ve,Nt):null,st=J&&Ue?g({active:J,collisionRect:Ue,droppableRects:H,droppableContainers:M,pointerCoordinates:Vs}):null,Us=Wi(st,"id"),[Te,Ys]=u.useState(null),Sn=Fs?Nt:Ke(Nt,Cn),En=Vi(Sn,(o=Te==null?void 0:Te.rect)!=null?o:null,de),es=u.useRef(null),Hs=u.useCallback((ee,ae)=>{let{sensor:oe,options:_e}=ae;if(F.current==null)return;const ue=R.get(F.current);if(!ue)return;const ie=ee.nativeEvent,ve=new oe({active:F.current,activeNode:ue,event:ie,options:_e,context:Be,onAbort(Z){if(!R.get(Z))return;const{onDragAbort:we}=le.current,Ee={id:Z};we==null||we(Ee),C({type:"onDragAbort",event:Ee})},onPending(Z,Oe,we,Ee){if(!R.get(Z))return;const{onDragPending:nt}=le.current,Me={id:Z,constraint:Oe,initialCoordinates:we,offset:Ee};nt==null||nt(Me),C({type:"onDragPending",event:Me})},onStart(Z){const Oe=F.current;if(Oe==null)return;const we=R.get(Oe);if(!we)return;const{onDragStart:Ee}=le.current,rt={activatorEvent:ie,active:{id:Oe,data:we.data,rect:U}};Fe.unstable_batchedUpdates(()=>{Ee==null||Ee(rt),m(De.Initializing),v({type:K.DragStart,initialCoordinates:Z,active:Oe}),C({type:"onDragStart",event:rt}),$e(es.current),ce(ie)})},onMove(Z){v({type:K.DragMove,coordinates:Z})},onEnd:Ye(K.DragEnd),onCancel:Ye(K.DragCancel)});es.current=ve;function Ye(Z){return async function(){const{active:we,collisions:Ee,over:rt,scrollAdjustedTranslate:nt}=Be.current;let Me=null;if(we&&nt){const{cancelDrop:at}=le.current;Me={activatorEvent:ie,active:we,collisions:Ee,delta:nt,over:rt},Z===K.DragEnd&&typeof at=="function"&&await Promise.resolve(at(Me))&&(Z=K.DragCancel)}F.current=null,Fe.unstable_batchedUpdates(()=>{v({type:Z}),m(De.Uninitialized),Ys(null),$e(null),ce(null),es.current=null;const at=Z===K.DragEnd?"onDragEnd":"onDragCancel";if(Me){const ts=le.current[at];ts==null||ts(Me),C({type:at,event:Me})}})}}},[R]),An=u.useCallback((ee,ae)=>(oe,_e)=>{const ue=oe.nativeEvent,ie=R.get(_e);if(F.current!==null||!ie||ue.dndKit||ue.defaultPrevented)return;const ve={active:ie};ee(oe,ae.options,ve)===!0&&(ue.dndKit={capturedBy:ae.sensor},F.current=_e,Hs(oe,ae))},[R,Hs]),Xs=fc(d,An);jc(d),Ae(()=>{de&&T===De.Initializing&&m(De.Initialized)},[de,T]),u.useEffect(()=>{const{onDragMove:ee}=le.current,{active:ae,activatorEvent:oe,collisions:_e,over:ue}=Be.current;if(!ae||!oe)return;const ie={active:ae,activatorEvent:oe,collisions:_e,delta:{x:ze.x,y:ze.y},over:ue};Fe.unstable_batchedUpdates(()=>{ee==null||ee(ie),C({type:"onDragMove",event:ie})})},[ze.x,ze.y]),u.useEffect(()=>{const{active:ee,activatorEvent:ae,collisions:oe,droppableContainers:_e,scrollAdjustedTranslate:ue}=Be.current;if(!ee||F.current==null||!ae||!ue)return;const{onDragOver:ie}=le.current,ve=_e.get(Us),Ye=ve&&ve.rect.current?{id:ve.id,rect:ve.rect.current,data:ve.data,disabled:ve.disabled}:null,Z={active:ee,activatorEvent:ae,collisions:oe,delta:{x:ue.x,y:ue.y},over:Ye};Fe.unstable_batchedUpdates(()=>{Ys(Ye),ie==null||ie(Z),C({type:"onDragOver",event:Z})})},[Us]),Ae(()=>{Be.current={activatorEvent:ne,active:J,activeNode:k,collisionRect:Ue,collisions:st,droppableRects:H,draggableNodes:R,draggingNode:wt,draggingNodeRect:Ve,droppableContainers:B,over:Te,scrollableAncestors:Re,scrollAdjustedTranslate:ze},U.current={initial:Ve,translated:Ue}},[J,k,st,Ue,R,wt,Ve,H,B,Te,Re,ze]),dc({...W,delta:I,draggingRect:Ue,pointerCoordinates:Vs,scrollableAncestors:Re,scrollableAncestorRects:jt});const Rn=u.useMemo(()=>({active:J,activeNode:k,activeNodeRect:de,activatorEvent:ne,collisions:st,containerNodeRect:Jt,dragOverlay:We,draggableNodes:R,droppableContainers:B,droppableRects:H,over:Te,measureDroppableContainers:y,scrollableAncestors:Re,scrollableAncestorRects:jt,measuringConfiguration:L,measuringScheduled:_,windowRect:Zt}),[J,k,de,ne,st,Jt,We,R,B,H,Te,y,Re,jt,L,_,Zt]),Tn=u.useMemo(()=>({activatorEvent:ne,activators:Xs,active:J,activeNodeRect:de,ariaDescribedById:{draggable:N},dispatch:v,draggableNodes:R,over:Te,measureDroppableContainers:y}),[ne,Xs,J,de,v,N,R,Te,y]);return Y.createElement(Hr.Provider,{value:p},Y.createElement(vt.Provider,{value:Tn},Y.createElement(ln.Provider,{value:Rn},Y.createElement(Qt.Provider,{value:En},h)),Y.createElement(_c,{disabled:(c==null?void 0:c.restoreFocus)===!1})),Y.createElement(Oi,{...c,hiddenTextDescribedById:N}));function _n(){const ee=(Q==null?void 0:Q.autoScrollEnabled)===!1,ae=typeof l=="object"?l.enabled===!1:l===!1,oe=E&&!ee&&!ae;return typeof l=="object"?{...l,enabled:oe}:{enabled:oe}}}),Dc=u.createContext(null),wr="button",Pc="Draggable";function Ic(t){let{id:e,data:s,disabled:n=!1,attributes:a}=t;const o=Ht(Pc),{activators:i,activatorEvent:c,active:l,activeNodeRect:h,ariaDescribedById:d,draggableNodes:g,over:f}=u.useContext(vt),{role:b=wr,roleDescription:w="draggable",tabIndex:x=0}=a??{},S=(l==null?void 0:l.id)===e,v=u.useContext(S?Qt:Dc),[C,p]=It(),[T,m]=It(),E=Nc(i,e),A=mt(s);Ae(()=>(g.set(e,{id:e,key:o,node:C,activatorNode:T,data:A}),()=>{const I=g.get(e);I&&I.key===o&&g.delete(e)}),[g,e]);const R=u.useMemo(()=>({role:b,tabIndex:x,"aria-disabled":n,"aria-pressed":S&&b===wr?!0:void 0,"aria-roledescription":w,"aria-describedby":d.draggable}),[n,b,x,S,w,d.draggable]);return{active:l,activatorEvent:c,activeNodeRect:h,attributes:R,isDragging:S,listeners:n?void 0:E,node:C,over:f,setNodeRef:p,setActivatorNodeRef:m,transform:v}}function Bc(){return u.useContext(ln)}const Wc="Droppable",qc={timeout:25};function Fc(t){let{data:e,disabled:s=!1,id:n,resizeObserverConfig:a}=t;const o=Ht(Wc),{active:i,dispatch:c,over:l,measureDroppableContainers:h}=u.useContext(vt),d=u.useRef({disabled:s}),g=u.useRef(!1),f=u.useRef(null),b=u.useRef(null),{disabled:w,updateMeasurementsFor:x,timeout:S}={...qc,...a},v=mt(x??n),C=u.useCallback(()=>{if(!g.current){g.current=!0;return}b.current!=null&&clearTimeout(b.current),b.current=setTimeout(()=>{h(Array.isArray(v.current)?v.current:[v.current]),b.current=null},S)},[S]),p=Xt({callback:C,disabled:w||!i}),T=u.useCallback((R,I)=>{p&&(I&&(p.unobserve(I),g.current=!1),R&&p.observe(R))},[p]),[m,E]=It(T),A=mt(e);return u.useEffect(()=>{!p||!m.current||(p.disconnect(),g.current=!1,p.observe(m.current))},[m,p]),u.useEffect(()=>(c({type:K.RegisterDroppable,element:{id:n,key:o,disabled:s,node:m,rect:f,data:A}}),()=>c({type:K.UnregisterDroppable,key:o,id:n})),[n]),u.useEffect(()=>{s!==d.current.disabled&&(c({type:K.SetDroppableDisabled,id:n,key:o,disabled:s}),d.current.disabled=s)},[n,o,s,c]),{active:i,rect:f,isOver:(l==null?void 0:l.id)===n,node:m,over:l,setNodeRef:E}}function $c(t){let{animation:e,children:s}=t;const[n,a]=u.useState(null),[o,i]=u.useState(null),c=Bt(s);return!s&&!n&&c&&a(c),Ae(()=>{if(!o)return;const l=n==null?void 0:n.key,h=n==null?void 0:n.props.id;if(l==null||h==null){a(null);return}Promise.resolve(e(h,o)).then(()=>{a(null)})},[e,n,o]),Y.createElement(Y.Fragment,null,s,n?u.cloneElement(n,{ref:i}):null)}const Vc={x:0,y:0,scaleX:1,scaleY:1};function zc(t){let{children:e}=t;return Y.createElement(vt.Provider,{value:cn},Y.createElement(Qt.Provider,{value:Vc},e))}const Uc={position:"fixed",touchAction:"none"},Yc=t=>Rs(t)?"transform 250ms ease":void 0,Hc=u.forwardRef((t,e)=>{let{as:s,activatorEvent:n,adjustScale:a,children:o,className:i,rect:c,style:l,transform:h,transition:d=Yc}=t;if(!c)return null;const g=a?h:{...h,scaleX:1,scaleY:1},f={...Uc,width:c.width,height:c.height,top:c.top,left:c.left,transform:Je.Transform.toString(g),transformOrigin:a&&n?Pi(n,c):void 0,transition:typeof d=="function"?d(n):d,...l};return Y.createElement(s,{className:i,style:f,ref:e},o)}),Xc=t=>e=>{let{active:s,dragOverlay:n}=e;const a={},{styles:o,className:i}=t;if(o!=null&&o.active)for(const[c,l]of Object.entries(o.active))l!==void 0&&(a[c]=s.node.style.getPropertyValue(c),s.node.style.setProperty(c,l));if(o!=null&&o.dragOverlay)for(const[c,l]of Object.entries(o.dragOverlay))l!==void 0&&n.node.style.setProperty(c,l);return i!=null&&i.active&&s.node.classList.add(i.active),i!=null&&i.dragOverlay&&n.node.classList.add(i.dragOverlay),function(){for(const[l,h]of Object.entries(a))s.node.style.setProperty(l,h);i!=null&&i.active&&s.node.classList.remove(i.active)}},Qc=t=>{let{transform:{initial:e,final:s}}=t;return[{transform:Je.Transform.toString(e)},{transform:Je.Transform.toString(s)}]},Kc={duration:250,easing:"ease",keyframes:Qc,sideEffects:Xc({styles:{active:{opacity:"0"}}})};function Gc(t){let{config:e,draggableNodes:s,droppableContainers:n,measuringConfiguration:a}=t;return Yt((o,i)=>{if(e===null)return;const c=s.get(o);if(!c)return;const l=c.node.current;if(!l)return;const h=on(i);if(!h)return;const{transform:d}=se(i).getComputedStyle(i),g=Qr(d);if(!g)return;const f=typeof e=="function"?e:Jc(e);return sn(l,a.draggable.measure),f({active:{id:o,data:c.data,node:l,rect:a.draggable.measure(l)},draggableNodes:s,dragOverlay:{node:i,rect:a.dragOverlay.measure(h)},droppableContainers:n,measuringConfiguration:a,transform:g})})}function Jc(t){const{duration:e,easing:s,sideEffects:n,keyframes:a}={...Kc,...t};return o=>{let{active:i,dragOverlay:c,transform:l,...h}=o;if(!e)return;const d={x:c.rect.left-i.rect.left,y:c.rect.top-i.rect.top},g={scaleX:l.scaleX!==1?i.rect.width*l.scaleX/c.rect.width:1,scaleY:l.scaleY!==1?i.rect.height*l.scaleY/c.rect.height:1},f={x:l.x-d.x,y:l.y-d.y,...g},b=a({...h,active:i,dragOverlay:c,transform:{initial:l,final:f}}),[w]=b,x=b[b.length-1];if(JSON.stringify(w)===JSON.stringify(x))return;const S=n==null?void 0:n({active:i,dragOverlay:c,...h}),v=c.node.animate(b,{duration:e,easing:s,fill:"forwards"});return new Promise(C=>{v.onfinish=()=>{S==null||S(),C()}})}}let jr=0;function Zc(t){return u.useMemo(()=>{if(t!=null)return jr++,jr},[t])}const el=Y.memo(t=>{let{adjustScale:e=!1,children:s,dropAnimation:n,style:a,transition:o,modifiers:i,wrapperElement:c="div",className:l,zIndex:h=999}=t;const{activatorEvent:d,active:g,activeNodeRect:f,containerNodeRect:b,draggableNodes:w,droppableContainers:x,dragOverlay:S,over:v,measuringConfiguration:C,scrollableAncestors:p,scrollableAncestorRects:T,windowRect:m}=Bc(),E=u.useContext(Qt),A=Zc(g==null?void 0:g.id),R=dn(i,{activatorEvent:d,active:g,activeNodeRect:f,containerNodeRect:b,draggingNodeRect:S.rect,over:v,overlayNodeRect:S.rect,scrollableAncestors:p,scrollableAncestorRects:T,transform:E,windowRect:m}),I=Ls(f),B=Gc({config:n,draggableNodes:w,droppableContainers:x,measuringConfiguration:C}),D=I?S.setRef:void 0;return Y.createElement(zc,null,Y.createElement($c,{animation:B},g&&A?Y.createElement(Hc,{key:A,id:g.id,ref:D,as:c,activatorEvent:d,adjustScale:e,className:l,transition:o,rect:I,style:{zIndex:h,...a},transform:R},s):null))});function tl({id:t,children:e}){const{setNodeRef:s,isOver:n}=Fc({id:t});return r.jsx("div",{ref:s,className:`flex-1 overflow-y-auto p-3 space-y-3 transition-colors ${n?"bg-primary-50":""}`,children:e})}const sl=t=>{switch(t){case"whatsapp":return r.jsx(Lt,{className:"w-3.5 h-3.5"});case"phone":return r.jsx(zt,{className:"w-3.5 h-3.5"});case"email":return r.jsx(Cs,{className:"w-3.5 h-3.5"});default:return r.jsx(Lt,{className:"w-3.5 h-3.5"})}},rl=t=>({whatsapp:"WhatsApp",phone:"Telefone",email:"E-mail",instagram:"Instagram",facebook:"Facebook",website:"Site",in_person:"Presencial",other:"Outro"})[t||"whatsapp"]||"WhatsApp",nl=t=>({conversa_iniciada:"Conversa Iniciada",agendamento_pendente:"Aguardando Agendamento",agendado:"Agendado",em_tratamento:"Em Tratamento",finalizado:"Finalizado",cancelado:"Cancelado"})[t||"conversa_iniciada"]||"Conversa Iniciada",al=t=>({moema:"Moema",perdizes:"Perdizes",online:"Online",a_domicilio:"Domic√≠lio"})[t||"moema"]||"Moema",ol=t=>{if(!t)return"?";const e=t.split(" ");return e.length>=2?`${e[0][0]}${e[1][0]}`.toUpperCase():t.substring(0,2).toUpperCase()};function Nr({lead:t,formatCurrency:e,onClick:s}){const{attributes:n,listeners:a,setNodeRef:o,transform:i,isDragging:c}=Ic({id:t.id}),l={transform:Je.Translate.toString(i),opacity:c?.5:1},h=u.useRef(!1);u.useEffect(()=>{i&&(Math.abs(i.x)>5||Math.abs(i.y)>5)&&(h.current=!0)},[i]),u.useEffect(()=>{if(!c&&h.current){const g=setTimeout(()=>{h.current=!1},100);return()=>clearTimeout(g)}},[c]);const d=()=>{h.current||c||s()};return r.jsxs("div",{ref:o,style:l,...a,...n,onClick:d,className:"bg-white p-3 rounded-lg shadow-sm hover:shadow-md transition-all cursor-grab active:cursor-grabbing border border-gray-200",children:[r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsx("h4",{className:"font-semibold text-gray-900 text-sm flex-1 pr-2 line-clamp-2",children:t.name}),t.assignedTo&&r.jsx("div",{className:"flex-shrink-0 w-7 h-7 rounded-full bg-primary-100 text-primary-700 flex items-center justify-center text-xs font-semibold",title:`Respons√°vel: ${t.assignedTo.name}`,children:ol(t.assignedTo.name)})]}),t.procedure&&r.jsx("div",{className:"mb-2",children:r.jsx("span",{className:"text-xs px-2 py-0.5 rounded font-medium inline-block",style:{backgroundColor:t.procedure.color+"20",color:t.procedure.color},children:t.procedure.name})}),t.estimatedValue&&r.jsx("p",{className:"text-sm font-bold text-primary-600 mb-2",children:e(t.estimatedValue)}),r.jsxs("div",{className:"space-y-1.5 mb-2",children:[t.channel&&r.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600",children:[sl(t.channel),r.jsx("span",{children:rl(t.channel)})]}),t.clientStatus&&r.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600",children:[r.jsx(Xe,{className:"w-3.5 h-3.5"}),r.jsx("span",{children:nl(t.clientStatus)})]}),t.attendanceLocation&&r.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-gray-600",children:[r.jsx(Xn,{className:"w-3.5 h-3.5"}),r.jsx("span",{children:al(t.attendanceLocation)})]})]}),r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-400",children:[t.email&&r.jsx("span",{title:t.email,children:r.jsx(Cs,{className:"w-3.5 h-3.5"})}),t.phone&&r.jsx("span",{title:t.phone,children:r.jsx(zt,{className:"w-3.5 h-3.5"})}),t.whatsapp&&r.jsx("span",{title:t.whatsapp,children:r.jsx(Lt,{className:"w-3.5 h-3.5"})})]}),t.tags&&t.tags.length>0&&r.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[t.tags.slice(0,2).map((g,f)=>r.jsx("span",{className:"text-xs px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded",children:g},f)),t.tags.length>2&&r.jsxs("span",{className:"text-xs px-1.5 py-0.5 bg-gray-100 text-gray-600 rounded",children:["+",t.tags.length-2]})]})]})}function il({leads:t,stages:e,formatCurrency:s,onLeadClick:n}){const a=i=>{const c=e.find(l=>l.id===i);return(c==null?void 0:c.name)||"-"},o=i=>{const c=e.find(l=>l.id===i);return(c==null?void 0:c.color)||"#gray"};return r.jsx("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:r.jsxs("tr",{children:[r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Est√°gio"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Procedimento"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contato"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Valor"}),r.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"})]})}),r.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.length===0?r.jsx("tr",{children:r.jsx("td",{colSpan:6,className:"px-6 py-12 text-center text-gray-500",children:"Nenhum lead encontrado"})}):t.map(i=>r.jsxs("tr",{onClick:()=>n(i),className:"hover:bg-gray-50 cursor-pointer transition-colors",children:[r.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[r.jsx("div",{className:"font-medium text-gray-900",children:i.name}),i.email&&r.jsx("div",{className:"text-sm text-gray-500",children:i.email})]}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:o(i.stageId)+"20",color:o(i.stageId)},children:[r.jsx("span",{className:"w-2 h-2 rounded-full mr-1.5",style:{backgroundColor:o(i.stageId)}}),a(i.stageId)]})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.procedure?r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-md",style:{backgroundColor:i.procedure.color+"20",color:i.procedure.color},children:i.procedure.name}):r.jsx("span",{className:"text-gray-400",children:"-"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"text-sm text-gray-900",children:i.phone||"-"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:i.estimatedValue?r.jsx("div",{className:"text-sm font-semibold text-primary-600",children:s(i.estimatedValue)}):r.jsx("span",{className:"text-gray-400",children:"-"})}),r.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:r.jsx("div",{className:"text-sm text-gray-500",children:i.expectedCloseDate?new Date(i.expectedCloseDate).toLocaleDateString("pt-BR"):"-"})})]},i.id))})]})})})}function cl({leads:t,stages:e,formatCurrency:s,onLeadClick:n}){const a=i=>{const c=e.find(l=>l.id===i);return(c==null?void 0:c.name)||"-"},o=i=>{const c=e.find(l=>l.id===i);return(c==null?void 0:c.color)||"#6b7280"};return r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:t.length===0?r.jsx("div",{className:"col-span-full text-center py-12 text-gray-500",children:"Nenhum lead encontrado"}):t.map(i=>r.jsxs("div",{onClick:()=>n(i),className:"bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-pointer border border-gray-200",children:[r.jsx("div",{className:"flex items-center justify-between mb-3",children:r.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium",style:{backgroundColor:o(i.stageId)+"20",color:o(i.stageId)},children:[r.jsx("span",{className:"w-2 h-2 rounded-full mr-1",style:{backgroundColor:o(i.stageId)}}),a(i.stageId)]})}),r.jsx("h4",{className:"font-semibold text-gray-900 text-base mb-2",children:i.name}),i.procedure&&r.jsx("div",{className:"mb-2",children:r.jsx("span",{className:"text-xs px-2 py-1 rounded-md font-medium",style:{backgroundColor:i.procedure.color+"20",color:i.procedure.color},children:i.procedure.name})}),i.estimatedValue&&r.jsx("p",{className:"text-sm font-semibold text-primary-600 mb-3",children:s(i.estimatedValue)}),r.jsxs("div",{className:"space-y-1 mb-3",children:[i.email&&r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),r.jsx("span",{className:"truncate",children:i.email})]}),i.phone&&r.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-600",children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),r.jsx("span",{children:i.phone})]})]}),i.expectedCloseDate&&r.jsxs("div",{className:"text-xs text-gray-500 border-t border-gray-100 pt-2",children:[r.jsx("svg",{className:"w-3 h-3 inline mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),new Date(i.expectedCloseDate).toLocaleDateString("pt-BR")]}),i.tags&&i.tags.length>0&&r.jsxs("div",{className:"flex flex-wrap gap-1 mt-2",children:[i.tags.slice(0,3).map((c,l)=>r.jsx("span",{className:"text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:c},l)),i.tags.length>3&&r.jsxs("span",{className:"text-xs px-2 py-0.5 bg-gray-100 text-gray-600 rounded",children:["+",i.tags.length-3]})]})]},i.id))})}function ll({leads:t,stages:e,formatCurrency:s,onLeadClick:n}){const a=l=>{const h=e.find(d=>d.id===l);return(h==null?void 0:h.name)||"-"},o=l=>{const h=e.find(d=>d.id===l);return(h==null?void 0:h.color)||"#6b7280"},c=(()=>{const l={};return t.forEach(h=>{const d=h.expectedCloseDate?new Date(h.expectedCloseDate).toLocaleDateString("pt-BR"):"Sem data";l[d]||(l[d]=[]),l[d].push(h)}),Object.entries(l).sort(([h],[d])=>h==="Sem data"?1:d==="Sem data"?-1:new Date(h.split("/").reverse().join("-")).getTime()-new Date(d.split("/").reverse().join("-")).getTime())})();return r.jsx("div",{className:"space-y-6",children:c.length===0?r.jsx("div",{className:"text-center py-12 text-gray-500",children:"Nenhum lead encontrado"}):c.map(([l,h])=>r.jsxs("div",{className:"relative",children:[r.jsxs("div",{className:"sticky top-0 bg-gray-50 border-l-4 border-primary-500 pl-4 py-2 mb-4 flex items-center gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("svg",{className:"w-5 h-5 text-primary-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),r.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:l})]}),r.jsxs("span",{className:"text-sm text-gray-600",children:[h.length," ",h.length===1?"lead":"leads"]})]}),r.jsx("div",{className:"pl-8 space-y-3",children:h.map(d=>r.jsxs("div",{onClick:()=>n(d),className:"relative bg-white p-4 rounded-lg shadow-sm hover:shadow-md transition-shadow cursor-pointer border border-gray-200",children:[r.jsx("div",{className:"absolute -left-10 top-6 w-4 h-4 rounded-full border-4 border-white",style:{backgroundColor:o(d.stageId)}}),r.jsxs("div",{className:"flex items-start justify-between mb-2",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("h4",{className:"font-semibold text-gray-900",children:d.name}),d.email&&r.jsx("p",{className:"text-sm text-gray-500",children:d.email})]}),r.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium ml-2",style:{backgroundColor:o(d.stageId)+"20",color:o(d.stageId)},children:a(d.stageId)})]}),r.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600",children:[d.procedure&&r.jsx("span",{className:"inline-flex px-2 py-1 text-xs font-medium rounded-md",style:{backgroundColor:d.procedure.color+"20",color:d.procedure.color},children:d.procedure.name}),d.estimatedValue&&r.jsx("span",{className:"font-semibold text-primary-600",children:s(d.estimatedValue)}),d.phone&&r.jsxs("span",{className:"flex items-center gap-1",children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),d.phone]})]})]},d.id))})]},l))})}function dl({leads:t,stages:e,formatCurrency:s,onLeadClick:n}){const[a,o]=u.useState(t[0]||null),i=h=>{const d=e.find(g=>g.id===h);return(d==null?void 0:d.name)||"-"},c=h=>{const d=e.find(g=>g.id===h);return(d==null?void 0:d.color)||"#6b7280"},l=h=>{o(h)};return r.jsxs("div",{className:"flex gap-4 h-[calc(100vh-18rem)]",children:[r.jsxs("div",{className:"w-96 flex-shrink-0 bg-white rounded-lg border border-gray-200 overflow-hidden flex flex-col",children:[r.jsx("div",{className:"p-4 border-b border-gray-200",children:r.jsxs("h3",{className:"font-semibold text-gray-900",children:["Leads (",t.length,")"]})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:t.length===0?r.jsx("div",{className:"p-6 text-center text-gray-500",children:"Nenhum lead encontrado"}):r.jsx("div",{className:"divide-y divide-gray-200",children:t.map(h=>r.jsxs("div",{onClick:()=>l(h),className:`p-4 cursor-pointer transition-colors ${(a==null?void 0:a.id)===h.id?"bg-primary-50 border-l-4 border-primary-500":"hover:bg-gray-50"}`,children:[r.jsxs("div",{className:"flex items-start justify-between mb-1",children:[r.jsx("h4",{className:"font-medium text-gray-900 text-sm",children:h.name}),r.jsx("span",{className:"w-2 h-2 rounded-full flex-shrink-0 mt-1.5",style:{backgroundColor:c(h.stageId)}})]}),h.email&&r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:h.email}),h.estimatedValue&&r.jsx("p",{className:"text-xs font-semibold text-primary-600",children:s(h.estimatedValue)})]},h.id))})})]}),r.jsx("div",{className:"flex-1 bg-white rounded-lg border border-gray-200 overflow-hidden",children:a?r.jsxs("div",{className:"h-full overflow-y-auto",children:[r.jsx("div",{className:"p-6 border-b border-gray-200",children:r.jsxs("div",{className:"flex items-start justify-between mb-3",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:a.name}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",style:{backgroundColor:c(a.stageId)+"20",color:c(a.stageId)},children:[r.jsx("span",{className:"w-2 h-2 rounded-full mr-1.5",style:{backgroundColor:c(a.stageId)}}),i(a.stageId)]})})]}),r.jsx("button",{onClick:()=>n(a),className:"px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-lg hover:bg-primary-700",children:"Editar"})]})}),r.jsxs("div",{className:"p-6 space-y-6",children:[a.procedure&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Procedimento"}),r.jsx("span",{className:"inline-flex px-3 py-1.5 text-sm font-medium rounded-md",style:{backgroundColor:a.procedure.color+"20",color:a.procedure.color},children:a.procedure.name})]}),r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:"Informa√ß√µes de Contato"}),r.jsxs("div",{className:"space-y-2",children:[a.email&&r.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[r.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),r.jsx("span",{className:"text-gray-900",children:a.email})]}),a.phone&&r.jsxs("div",{className:"flex items-center gap-3 text-sm",children:[r.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})}),r.jsx("span",{className:"text-gray-900",children:a.phone})]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.estimatedValue&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Valor Estimado"}),r.jsx("p",{className:"text-2xl font-bold text-primary-600",children:s(a.estimatedValue)})]}),a.expectedCloseDate&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Data Esperada"}),r.jsx("p",{className:"text-lg font-medium text-gray-900",children:new Date(a.expectedCloseDate).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})})]})]}),a.notes&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Observa√ß√µes"}),r.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-wrap bg-gray-50 p-3 rounded-lg",children:a.notes})]}),a.tags&&a.tags.length>0&&r.jsxs("div",{children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-2",children:"Tags"}),r.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map((h,d)=>r.jsx("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm",children:h},d))})]})]})]}):r.jsx("div",{className:"h-full flex items-center justify-center text-gray-500",children:"Selecione um lead para ver os detalhes"})})]})}function ul(){const t=Tr(),[e,s]=u.useState(null),[n,a]=u.useState([]),[o,i]=u.useState([]),[c,l]=u.useState(!0),[h,d]=u.useState(!1),[g,f]=u.useState(void 0),[b,w]=u.useState(null),[x,S]=u.useState("kanban"),[v,C]=u.useState(!1),[p,T]=u.useState({}),m=Li(Mi(Ms,{activationConstraint:{distance:8}}));u.useEffect(()=>{E()},[]),u.useEffect(()=>{e&&A()},[e]),u.useEffect(()=>{Object.keys(p).length>0&&R(p)},[n]),u.useEffect(()=>{const N=t.state;if(N!=null&&N.openLeadId&&n.length>0){const M=n.find(L=>L.id===N.openLeadId);M&&(U(M),window.history.replaceState({},document.title))}},[t.state,n]);const E=async()=>{try{const N=await ye.getPipelines();N.length>0&&s(N[0])}catch(N){O.error("Erro ao carregar pipelines"),console.error(N)}finally{l(!1)}},A=async()=>{try{const N=await ye.getLeads();a(N),i(N)}catch(N){O.error("Erro ao carregar leads"),console.error(N)}},R=N=>{let M=[...n];if(N.search){const L=N.search.toLowerCase();M=M.filter(H=>{var y,_;return H.name.toLowerCase().includes(L)||((y=H.email)==null?void 0:y.toLowerCase().includes(L))||((_=H.phone)==null?void 0:_.includes(N.search))})}N.stageId&&(M=M.filter(L=>L.stageId===N.stageId)),N.procedureId&&(M=M.filter(L=>L.procedureId===N.procedureId)),N.assignedToId&&(M=M.filter(L=>L.assignedToId===N.assignedToId)),N.clientStatus&&(M=M.filter(L=>L.clientStatus===N.clientStatus)),N.channel&&(M=M.filter(L=>L.channel===N.channel)),N.attendanceLocation&&(M=M.filter(L=>L.attendanceLocation===N.attendanceLocation)),N.minValue!==void 0&&(M=M.filter(L=>(L.estimatedValue||0)>=N.minValue)),N.maxValue!==void 0&&(M=M.filter(L=>(L.estimatedValue||0)<=N.maxValue)),i(M),T(N)},I=N=>{R(N)},B=()=>{T({}),i(n)},D=()=>{f(void 0),d(!0)},U=N=>{f(N),d(!0)},J=()=>{d(!1),f(void 0)},F=async N=>{g?await ye.updateLead(g.id,N):await ye.createLead(N),await A(),J()},Q=N=>{const{active:M}=N,L=o.find(H=>H.id===M.id);w(L||null)},$e=async N=>{const{active:M,over:L}=N;if(w(null),!L)return;const H=M.id,y=L.id,_=o.find(k=>k.id===H);if(!(!_||_.stageId===y))try{const k=z=>z.map(W=>W.id===H?{...W,stageId:y}:W);a(k),i(k),await ye.moveLeadToStage(H,y),O.success("Lead movido com sucesso!")}catch(k){console.error("Erro ao mover lead:",k),O.error("Erro ao mover lead"),await A()}},ne=N=>o.filter(M=>M.stageId===N),ce=N=>N?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(N):"";if(c)return r.jsx("div",{className:"flex items-center justify-center h-screen",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Carregando..."})]})});if(!e)return r.jsx("div",{className:"p-6",children:r.jsxs("div",{className:"text-center",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Nenhum Pipeline Encontrado"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Crie seu primeiro pipeline para come√ßar a gerenciar leads."}),r.jsx("button",{className:"btn-primary",children:"Criar Pipeline"})]})});const le=()=>{var N;switch(x){case"list":return r.jsx(il,{leads:o,stages:(e==null?void 0:e.stages)||[],formatCurrency:ce,onLeadClick:U});case"grid":return r.jsx(cl,{leads:o,stages:(e==null?void 0:e.stages)||[],formatCurrency:ce,onLeadClick:U});case"timeline":return r.jsx(ll,{leads:o,stages:(e==null?void 0:e.stages)||[],formatCurrency:ce,onLeadClick:U});case"division":return r.jsx(dl,{leads:o,stages:(e==null?void 0:e.stages)||[],formatCurrency:ce,onLeadClick:U});case"kanban":default:return r.jsx("div",{className:"flex-1 overflow-x-auto",children:r.jsx("div",{className:"flex gap-4 min-h-[calc(100vh-20rem)] pb-4",children:(N=e.stages)==null?void 0:N.map(M=>{const L=ne(M.id),H=L.reduce((y,_)=>y+(_.estimatedValue||0),0);return r.jsxs("div",{className:"flex-shrink-0 w-80 bg-gray-100 rounded-lg flex flex-col",children:[r.jsxs("div",{className:"p-4 border-b border-gray-200",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:M.color}}),r.jsx("h3",{className:"font-semibold text-gray-900",children:M.name})]}),r.jsx("span",{className:"text-sm font-medium text-gray-600",children:L.length})]}),r.jsxs("div",{className:"text-xs text-gray-500",children:[ce(H)," ‚Ä¢ ",M.probability,"% prob."]})]}),r.jsx(tl,{id:M.id,children:L.length===0?r.jsx("div",{className:"text-center py-8 text-gray-400 text-sm",children:"Nenhum lead neste est√°gio"}):L.map(y=>r.jsx(Nr,{lead:y,formatCurrency:ce,onClick:()=>U(y)},y.id))})]},M.id)})})})}};return r.jsxs("div",{className:"flex flex-col min-h-[calc(100vh-8rem)]",children:[r.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 mb-4",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{children:[r.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:e.name}),r.jsx("p",{className:"text-sm text-gray-500",children:"Pipeline de vendas"})]}),r.jsxs("div",{className:"flex gap-3",children:[r.jsxs("button",{onClick:()=>C(!0),className:"px-4 py-2 text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 relative",children:["Filtros",Object.keys(p).filter(N=>p[N]).length>0&&r.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-primary-600 text-white text-xs rounded-full flex items-center justify-center",children:Object.keys(p).filter(N=>p[N]).length})]}),r.jsx("button",{onClick:D,className:"btn-primary",children:"+ Novo Lead"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm text-gray-600 mr-2",children:"Visualiza√ß√£o:"}),r.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1 gap-1",children:[r.jsxs("button",{onClick:()=>S("kanban"),className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ${x==="kanban"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(Qn,{size:16}),"Kanban"]}),r.jsxs("button",{onClick:()=>S("list"),className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ${x==="list"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(Kn,{size:16}),"Lista"]}),r.jsxs("button",{onClick:()=>S("grid"),className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ${x==="grid"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(Gn,{size:16}),"Grade"]}),r.jsxs("button",{onClick:()=>S("timeline"),className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ${x==="timeline"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(Ge,{size:16}),"Timeline"]}),r.jsxs("button",{onClick:()=>S("division"),className:`flex items-center gap-2 px-3 py-2 rounded-md text-sm font-medium transition-colors ${x==="division"?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:[r.jsx(Jn,{size:16}),"Divis√£o"]})]})]})]}),x==="kanban"?r.jsxs(Lc,{sensors:m,collisionDetection:qi,onDragStart:Q,onDragEnd:$e,children:[le(),r.jsx(el,{children:b?r.jsx(Nr,{lead:b,formatCurrency:ce,onClick:()=>{}}):null})]}):r.jsx("div",{className:"flex-1 overflow-y-auto",children:le()}),h&&r.jsx(Pr,{isOpen:h,onClose:J,title:g?"Editar Lead":"Novo Lead",size:"lg",children:r.jsx(bi,{children:e&&r.jsx(xi,{lead:g,stages:e.stages||[],onSubmit:F,onClose:J})})}),r.jsx(yi,{isOpen:v,onClose:()=>C(!1),stages:(e==null?void 0:e.stages)||[],filters:p,onApplyFilters:I,onClearFilters:B})]})}class hl{async getConversations(e){const s=new URLSearchParams;e!=null&&e.status&&s.append("status",e.status),e!=null&&e.assignedUserId&&s.append("assignedUserId",e.assignedUserId),e!=null&&e.search&&s.append("search",e.search),e!=null&&e.tags&&s.append("tags",e.tags.join(",")),e!=null&&e.unreadOnly&&s.append("unreadOnly","true");const{data:n}=await j.get(`/chat/conversations?${s.toString()}`);return n}async getConversation(e){const{data:s}=await j.get(`/chat/conversations/${e}`);return s}async createConversation(e){const{data:s}=await j.post("/chat/conversations",e);return s}async updateConversation(e,s){const{data:n}=await j.put(`/chat/conversations/${e}`,s);return n}async markAsRead(e){const{data:s}=await j.post(`/chat/conversations/${e}/mark-read`);return s}async markAsUnread(e){const{data:s}=await j.post(`/chat/conversations/${e}/mark-unread`);return s}async assignConversation(e,s){const{data:n}=await j.post(`/chat/conversations/${e}/assign`,{userId:s});return n}async addTag(e,s){const{data:n}=await j.post(`/chat/conversations/${e}/tags`,{tagName:s});return n}async removeTag(e,s){const{data:n}=await j.delete(`/chat/conversations/${e}/tags`,{data:{tagName:s}});return n}async getMessages(e){const{data:s}=await j.get(`/chat/conversations/${e}/messages`);return s}async sendMessage(e,s){const{data:n}=await j.post(`/chat/conversations/${e}/messages`,s);return n}async deleteMessage(e){await j.delete(`/chat/messages/${e}`)}async getTags(){const{data:e}=await j.get("/chat/tags");return e}async createTag(e){const{data:s}=await j.post("/chat/tags",e);return s}async updateTag(e,s){const{data:n}=await j.put(`/chat/tags/${e}`,s);return n}async deleteTag(e){await j.delete(`/chat/tags/${e}`)}async getQuickReplies(e){const s=new URLSearchParams;e!=null&&e.category&&s.append("category",e.category),e!=null&&e.search&&s.append("search",e.search);const{data:n}=await j.get(`/chat/quick-replies?${s.toString()}`);return n}async createQuickReply(e){const{data:s}=await j.post("/chat/quick-replies",e);return s}async updateQuickReply(e,s){const{data:n}=await j.put(`/chat/quick-replies/${e}`,s);return n}async deleteQuickReply(e){await j.delete(`/chat/quick-replies/${e}`)}async getStats(){const{data:e}=await j.get("/chat/stats");return e}async getWhatsAppConversations(){const{data:e}=await j.get("/chat/n8n/conversations");return e.data||e}async getWhatsAppMessages(e,s){const n=new URLSearchParams;s&&n.append("phoneNumber",s);const{data:a}=await j.get(`/chat/n8n/messages/${e}?${n.toString()}`);return a.data||a}async markWhatsAppAsRead(e,s){const n=new URLSearchParams;n.append("phoneNumber",s),await j.post(`/chat/n8n/messages/${e}/mark-read?${n.toString()}`)}async deleteWhatsAppMessage(e){await j.delete(`/chat/n8n/messages/${e}`)}async sendWhatsAppMessage(e,s,n,a){const o={sessionName:e,phoneNumber:s,content:n};a&&(o.quotedMessageId=a);const{data:i}=await j.post("/chat/n8n/send-message",o),c=i.data||i;return{id:c.id,conversationId:`whatsapp-${c.sessionName}-${c.phoneNumber}`,direction:c.direction||"outgoing",type:c.messageType||"text",content:c.content,status:c.status||"sent",createdAt:c.createdAt||new Date().toISOString()}}}const je=new hl,Se=Object.create(null);Se.open="0";Se.close="1";Se.ping="2";Se.pong="3";Se.message="4";Se.upgrade="5";Se.noop="6";const Rt=Object.create(null);Object.keys(Se).forEach(t=>{Rt[Se[t]]=t});const ys={type:"error",data:"parser error"},un=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",hn=typeof ArrayBuffer=="function",mn=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,Ds=({type:t,data:e},s,n)=>un&&e instanceof Blob?s?n(e):kr(e,n):hn&&(e instanceof ArrayBuffer||mn(e))?s?n(e):kr(new Blob([e]),n):n(Se[t]+(e||"")),kr=(t,e)=>{const s=new FileReader;return s.onload=function(){const n=s.result.split(",")[1];e("b"+(n||""))},s.readAsDataURL(t)};function Cr(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let os;function ml(t,e){if(un&&t.data instanceof Blob)return t.data.arrayBuffer().then(Cr).then(e);if(hn&&(t.data instanceof ArrayBuffer||mn(t.data)))return e(Cr(t.data));Ds(t,!1,s=>{os||(os=new TextEncoder),e(os.encode(s))})}const Sr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",it=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<Sr.length;t++)it[Sr.charCodeAt(t)]=t;const fl=t=>{let e=t.length*.75,s=t.length,n,a=0,o,i,c,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const h=new ArrayBuffer(e),d=new Uint8Array(h);for(n=0;n<s;n+=4)o=it[t.charCodeAt(n)],i=it[t.charCodeAt(n+1)],c=it[t.charCodeAt(n+2)],l=it[t.charCodeAt(n+3)],d[a++]=o<<2|i>>4,d[a++]=(i&15)<<4|c>>2,d[a++]=(c&3)<<6|l&63;return h},gl=typeof ArrayBuffer=="function",Ps=(t,e)=>{if(typeof t!="string")return{type:"message",data:fn(t,e)};const s=t.charAt(0);return s==="b"?{type:"message",data:pl(t.substring(1),e)}:Rt[s]?t.length>1?{type:Rt[s],data:t.substring(1)}:{type:Rt[s]}:ys},pl=(t,e)=>{if(gl){const s=fl(t);return fn(s,e)}else return{base64:!0,data:t}},fn=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},gn="",xl=(t,e)=>{const s=t.length,n=new Array(s);let a=0;t.forEach((o,i)=>{Ds(o,!1,c=>{n[i]=c,++a===s&&e(n.join(gn))})})},yl=(t,e)=>{const s=t.split(gn),n=[];for(let a=0;a<s.length;a++){const o=Ps(s[a],e);if(n.push(o),o.type==="error")break}return n};function bl(){return new TransformStream({transform(t,e){ml(t,s=>{const n=s.length;let a;if(n<126)a=new Uint8Array(1),new DataView(a.buffer).setUint8(0,n);else if(n<65536){a=new Uint8Array(3);const o=new DataView(a.buffer);o.setUint8(0,126),o.setUint16(1,n)}else{a=new Uint8Array(9);const o=new DataView(a.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(a[0]|=128),e.enqueue(a),e.enqueue(s)})}})}let is;function Ct(t){return t.reduce((e,s)=>e+s.length,0)}function St(t,e){if(t[0].length===e)return t.shift();const s=new Uint8Array(e);let n=0;for(let a=0;a<e;a++)s[a]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),s}function vl(t,e){is||(is=new TextDecoder);const s=[];let n=0,a=-1,o=!1;return new TransformStream({transform(i,c){for(s.push(i);;){if(n===0){if(Ct(s)<1)break;const l=St(s,1);o=(l[0]&128)===128,a=l[0]&127,a<126?n=3:a===126?n=1:n=2}else if(n===1){if(Ct(s)<2)break;const l=St(s,2);a=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),n=3}else if(n===2){if(Ct(s)<8)break;const l=St(s,8),h=new DataView(l.buffer,l.byteOffset,l.length),d=h.getUint32(0);if(d>Math.pow(2,21)-1){c.enqueue(ys);break}a=d*Math.pow(2,32)+h.getUint32(4),n=3}else{if(Ct(s)<a)break;const l=St(s,a);c.enqueue(Ps(o?l:is.decode(l),e)),n=0}if(a===0||a>t){c.enqueue(ys);break}}}})}const pn=4;function X(t){if(t)return wl(t)}function wl(t){for(var e in X.prototype)t[e]=X.prototype[e];return t}X.prototype.on=X.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};X.prototype.once=function(t,e){function s(){this.off(t,s),e.apply(this,arguments)}return s.fn=e,this.on(t,s),this};X.prototype.off=X.prototype.removeListener=X.prototype.removeAllListeners=X.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var s=this._callbacks["$"+t];if(!s)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,a=0;a<s.length;a++)if(n=s[a],n===e||n.fn===e){s.splice(a,1);break}return s.length===0&&delete this._callbacks["$"+t],this};X.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),s=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(s){s=s.slice(0);for(var n=0,a=s.length;n<a;++n)s[n].apply(this,e)}return this};X.prototype.emitReserved=X.prototype.emit;X.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};X.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Kt=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,s)=>s(e,0),pe=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),jl="arraybuffer";function xn(t,...e){return e.reduce((s,n)=>(t.hasOwnProperty(n)&&(s[n]=t[n]),s),{})}const Nl=pe.setTimeout,kl=pe.clearTimeout;function Gt(t,e){e.useNativeTimers?(t.setTimeoutFn=Nl.bind(pe),t.clearTimeoutFn=kl.bind(pe)):(t.setTimeoutFn=pe.setTimeout.bind(pe),t.clearTimeoutFn=pe.clearTimeout.bind(pe))}const Cl=1.33;function Sl(t){return typeof t=="string"?El(t):Math.ceil((t.byteLength||t.size)*Cl)}function El(t){let e=0,s=0;for(let n=0,a=t.length;n<a;n++)e=t.charCodeAt(n),e<128?s+=1:e<2048?s+=2:e<55296||e>=57344?s+=3:(n++,s+=4);return s}function yn(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Al(t){let e="";for(let s in t)t.hasOwnProperty(s)&&(e.length&&(e+="&"),e+=encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return e}function Rl(t){let e={},s=t.split("&");for(let n=0,a=s.length;n<a;n++){let o=s[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class Tl extends Error{constructor(e,s,n){super(e),this.description=s,this.context=n,this.type="TransportError"}}class Is extends X{constructor(e){super(),this.writable=!1,Gt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,s,n){return super.emitReserved("error",new Tl(e,s,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const s=Ps(e,this.socket.binaryType);this.onPacket(s)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,s={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(s)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const s=Al(e);return s.length?"?"+s:""}}class _l extends Is{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const s=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||s()})),this.writable||(n++,this.once("drain",function(){--n||s()}))}else s()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const s=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};yl(e,this.socket.binaryType).forEach(s),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,xl(e,s=>{this.doWrite(s,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",s=this.query||{};return this.opts.timestampRequests!==!1&&(s[this.opts.timestampParam]=yn()),!this.supportsBinary&&!s.sid&&(s.b64=1),this.createUri(e,s)}}let bn=!1;try{bn=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const Ol=bn;function Ml(){}class Ll extends _l{constructor(e){if(super(e),typeof location<"u"){const s=location.protocol==="https:";let n=location.port;n||(n=s?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,s){const n=this.request({method:"POST",data:e});n.on("success",s),n.on("error",(a,o)=>{this.onError("xhr post error",a,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(s,n)=>{this.onError("xhr poll error",s,n)}),this.pollXhr=e}}class Ce extends X{constructor(e,s,n){super(),this.createRequest=e,Gt(this,n),this._opts=n,this._method=n.method||"GET",this._uri=s,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var e;const s=xn(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");s.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(s);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let a in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(a)&&n.setRequestHeader(a,this._opts.extraHeaders[a])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var a;n.readyState===3&&((a=this._opts.cookieJar)===null||a===void 0||a.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(a){this.setTimeoutFn(()=>{this._onError(a)},0);return}typeof document<"u"&&(this._index=Ce.requestsCount++,Ce.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=Ml,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Ce.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Ce.requestsCount=0;Ce.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Er);else if(typeof addEventListener=="function"){const t="onpagehide"in pe?"pagehide":"unload";addEventListener(t,Er,!1)}}function Er(){for(let t in Ce.requests)Ce.requests.hasOwnProperty(t)&&Ce.requests[t].abort()}const Dl=function(){const t=vn({xdomain:!1});return t&&t.responseType!==null}();class Pl extends Ll{constructor(e){super(e);const s=e&&e.forceBase64;this.supportsBinary=Dl&&!s}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Ce(vn,this.uri(),e)}}function vn(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||Ol))return new XMLHttpRequest}catch{}if(!e)try{return new pe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const wn=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class Il extends Is{get name(){return"websocket"}doOpen(){const e=this.uri(),s=this.opts.protocols,n=wn?{}:xn(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,s,n)}catch(a){return this.emitReserved("error",a)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const n=e[s],a=s===e.length-1;Ds(n,this.supportsBinary,o=>{try{this.doWrite(n,o)}catch{}a&&Kt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",s=this.query||{};return this.opts.timestampRequests&&(s[this.opts.timestampParam]=yn()),this.supportsBinary||(s.b64=1),this.createUri(e,s)}}const cs=pe.WebSocket||pe.MozWebSocket;class Bl extends Il{createSocket(e,s,n){return wn?new cs(e,s,n):s?new cs(e,s):new cs(e)}doWrite(e,s){this.ws.send(s)}}class Wl extends Is{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const s=vl(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(s).getReader(),a=bl();a.readable.pipeTo(e.writable),this._writer=a.writable.getWriter();const o=()=>{n.read().then(({done:c,value:l})=>{c||(this.onPacket(l),o())}).catch(c=>{})};o();const i={type:"open"};this.query.sid&&(i.data=`{"sid":"${this.query.sid}"}`),this._writer.write(i).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let s=0;s<e.length;s++){const n=e[s],a=s===e.length-1;this._writer.write(n).then(()=>{a&&Kt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const ql={websocket:Bl,webtransport:Wl,polling:Pl},Fl=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,$l=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function bs(t){if(t.length>8e3)throw"URI too long";const e=t,s=t.indexOf("["),n=t.indexOf("]");s!=-1&&n!=-1&&(t=t.substring(0,s)+t.substring(s,n).replace(/:/g,";")+t.substring(n,t.length));let a=Fl.exec(t||""),o={},i=14;for(;i--;)o[$l[i]]=a[i]||"";return s!=-1&&n!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=Vl(o,o.path),o.queryKey=zl(o,o.query),o}function Vl(t,e){const s=/\/{2,9}/g,n=e.replace(s,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function zl(t,e){const s={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,a,o){a&&(s[a]=o)}),s}const vs=typeof addEventListener=="function"&&typeof removeEventListener=="function",Tt=[];vs&&addEventListener("offline",()=>{Tt.forEach(t=>t())},!1);class Pe extends X{constructor(e,s){if(super(),this.binaryType=jl,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(s=e,e=null),e){const n=bs(e);s.hostname=n.host,s.secure=n.protocol==="https"||n.protocol==="wss",s.port=n.port,n.query&&(s.query=n.query)}else s.host&&(s.hostname=bs(s.host).host);Gt(this,s),this.secure=s.secure!=null?s.secure:typeof location<"u"&&location.protocol==="https:",s.hostname&&!s.port&&(s.port=this.secure?"443":"80"),this.hostname=s.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=s.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},s.transports.forEach(n=>{const a=n.prototype.name;this.transports.push(a),this._transportsByName[a]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},s),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Rl(this.opts.query)),vs&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Tt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const s=Object.assign({},this.opts.query);s.EIO=pn,s.transport=e,this.id&&(s.sid=this.id);const n=Object.assign({},this.opts,{query:s,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Pe.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const s=this.createTransport(e);s.open(),this.setTransport(s)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",s=>this._onClose("transport close",s))}onOpen(){this.readyState="open",Pe.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const s=new Error("server error");s.code=e.data,this._onError(s);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let s=1;for(let n=0;n<this.writeBuffer.length;n++){const a=this.writeBuffer[n].data;if(a&&(s+=Sl(a)),n>0&&s>this._maxPayload)return this.writeBuffer.slice(0,n);s+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,Kt(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,s,n){return this._sendPacket("message",e,s,n),this}send(e,s,n){return this._sendPacket("message",e,s,n),this}_sendPacket(e,s,n,a){if(typeof s=="function"&&(a=s,s=void 0),typeof n=="function"&&(a=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:e,data:s,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),a&&this.once("flush",a),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},s=()=>{this.off("upgrade",s),this.off("upgradeError",s),e()},n=()=>{this.once("upgrade",s),this.once("upgradeError",s)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(Pe.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,s){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),vs&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=Tt.indexOf(this._offlineEventListener);n!==-1&&Tt.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,s),this.writeBuffer=[],this._prevBufferLen=0}}}Pe.protocol=pn;class Ul extends Pe{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let s=this.createTransport(e),n=!1;Pe.priorWebsocketSuccess=!1;const a=()=>{n||(s.send([{type:"ping",data:"probe"}]),s.once("packet",g=>{if(!n)if(g.type==="pong"&&g.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",s),!s)return;Pe.priorWebsocketSuccess=s.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(d(),this.setTransport(s),s.send([{type:"upgrade"}]),this.emitReserved("upgrade",s),s=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=s.name,this.emitReserved("upgradeError",f)}}))};function o(){n||(n=!0,d(),s.close(),s=null)}const i=g=>{const f=new Error("probe error: "+g);f.transport=s.name,o(),this.emitReserved("upgradeError",f)};function c(){i("transport closed")}function l(){i("socket closed")}function h(g){s&&g.name!==s.name&&o()}const d=()=>{s.removeListener("open",a),s.removeListener("error",i),s.removeListener("close",c),this.off("close",l),this.off("upgrading",h)};s.once("open",a),s.once("error",i),s.once("close",c),this.once("close",l),this.once("upgrading",h),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||s.open()},200):s.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const s=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&s.push(e[n]);return s}}let Yl=class extends Ul{constructor(e,s={}){const n=typeof e=="object"?e:s;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(a=>ql[a]).filter(a=>!!a)),super(e,n)}};function Hl(t,e="",s){let n=t;s=s||typeof location<"u"&&location,t==null&&(t=s.protocol+"//"+s.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=s.protocol+t:t=s.host+t),/^(https?|wss?):\/\//.test(t)||(typeof s<"u"?t=s.protocol+"//"+t:t="https://"+t),n=bs(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(s&&s.port===n.port?"":":"+n.port),n}const Xl=typeof ArrayBuffer=="function",Ql=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,jn=Object.prototype.toString,Kl=typeof Blob=="function"||typeof Blob<"u"&&jn.call(Blob)==="[object BlobConstructor]",Gl=typeof File=="function"||typeof File<"u"&&jn.call(File)==="[object FileConstructor]";function Bs(t){return Xl&&(t instanceof ArrayBuffer||Ql(t))||Kl&&t instanceof Blob||Gl&&t instanceof File}function _t(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let s=0,n=t.length;s<n;s++)if(_t(t[s]))return!0;return!1}if(Bs(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return _t(t.toJSON(),!0);for(const s in t)if(Object.prototype.hasOwnProperty.call(t,s)&&_t(t[s]))return!0;return!1}function Jl(t){const e=[],s=t.data,n=t;return n.data=ws(s,e),n.attachments=e.length,{packet:n,buffers:e}}function ws(t,e){if(!t)return t;if(Bs(t)){const s={_placeholder:!0,num:e.length};return e.push(t),s}else if(Array.isArray(t)){const s=new Array(t.length);for(let n=0;n<t.length;n++)s[n]=ws(t[n],e);return s}else if(typeof t=="object"&&!(t instanceof Date)){const s={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=ws(t[n],e));return s}return t}function Zl(t,e){return t.data=js(t.data,e),delete t.attachments,t}function js(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let s=0;s<t.length;s++)t[s]=js(t[s],e);else if(typeof t=="object")for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&(t[s]=js(t[s],e));return t}const ed=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],td=5;var P;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(P||(P={}));class sd{constructor(e){this.replacer=e}encode(e){return(e.type===P.EVENT||e.type===P.ACK)&&_t(e)?this.encodeAsBinary({type:e.type===P.EVENT?P.BINARY_EVENT:P.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let s=""+e.type;return(e.type===P.BINARY_EVENT||e.type===P.BINARY_ACK)&&(s+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(s+=e.nsp+","),e.id!=null&&(s+=e.id),e.data!=null&&(s+=JSON.stringify(e.data,this.replacer)),s}encodeAsBinary(e){const s=Jl(e),n=this.encodeAsString(s.packet),a=s.buffers;return a.unshift(n),a}}function Ar(t){return Object.prototype.toString.call(t)==="[object Object]"}class Ws extends X{constructor(e){super(),this.reviver=e}add(e){let s;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");s=this.decodeString(e);const n=s.type===P.BINARY_EVENT;n||s.type===P.BINARY_ACK?(s.type=n?P.EVENT:P.ACK,this.reconstructor=new rd(s),s.attachments===0&&super.emitReserved("decoded",s)):super.emitReserved("decoded",s)}else if(Bs(e)||e.base64)if(this.reconstructor)s=this.reconstructor.takeBinaryData(e),s&&(this.reconstructor=null,super.emitReserved("decoded",s));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let s=0;const n={type:Number(e.charAt(0))};if(P[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===P.BINARY_EVENT||n.type===P.BINARY_ACK){const o=s+1;for(;e.charAt(++s)!=="-"&&s!=e.length;);const i=e.substring(o,s);if(i!=Number(i)||e.charAt(s)!=="-")throw new Error("Illegal attachments");n.attachments=Number(i)}if(e.charAt(s+1)==="/"){const o=s+1;for(;++s&&!(e.charAt(s)===","||s===e.length););n.nsp=e.substring(o,s)}else n.nsp="/";const a=e.charAt(s+1);if(a!==""&&Number(a)==a){const o=s+1;for(;++s;){const i=e.charAt(s);if(i==null||Number(i)!=i){--s;break}if(s===e.length)break}n.id=Number(e.substring(o,s+1))}if(e.charAt(++s)){const o=this.tryParse(e.substr(s));if(Ws.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,s){switch(e){case P.CONNECT:return Ar(s);case P.DISCONNECT:return s===void 0;case P.CONNECT_ERROR:return typeof s=="string"||Ar(s);case P.EVENT:case P.BINARY_EVENT:return Array.isArray(s)&&(typeof s[0]=="number"||typeof s[0]=="string"&&ed.indexOf(s[0])===-1);case P.ACK:case P.BINARY_ACK:return Array.isArray(s)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class rd{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const s=Zl(this.reconPack,this.buffers);return this.finishedReconstruction(),s}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const nd=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Ws,Encoder:sd,get PacketType(){return P},protocol:td},Symbol.toStringTag,{value:"Module"}));function xe(t,e,s){return t.on(e,s),function(){t.off(e,s)}}const ad=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Nn extends X{constructor(e,s,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=s,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[xe(e,"open",this.onopen.bind(this)),xe(e,"packet",this.onpacket.bind(this)),xe(e,"error",this.onerror.bind(this)),xe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...s){var n,a,o;if(ad.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(s.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(s),this;const i={type:P.EVENT,data:s};if(i.options={},i.options.compress=this.flags.compress!==!1,typeof s[s.length-1]=="function"){const d=this.ids++,g=s.pop();this._registerAckCallback(d,g),i.id=d}const c=(a=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||a===void 0?void 0:a.writable,l=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!c||(l?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(e,s){var n;const a=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(a===void 0){this.acks[e]=s;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===e&&this.sendBuffer.splice(c,1);s.call(this,new Error("operation has timed out"))},a),i=(...c)=>{this.io.clearTimeoutFn(o),s.apply(this,c)};i.withError=!0,this.acks[e]=i}emitWithAck(e,...s){return new Promise((n,a)=>{const o=(i,c)=>i?a(i):n(c);o.withError=!0,s.push(o),this.emit(e,...s)})}_addToQueue(e){let s;typeof e[e.length-1]=="function"&&(s=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((a,...o)=>n!==this._queue[0]?void 0:(a!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),s&&s(a)):(this._queue.shift(),s&&s(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const s=this._queue[0];s.pending&&!e||(s.pending=!0,s.tryCount++,this.flags=s.flags,this.emit.apply(this,s.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:P.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,s){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,s),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case P.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case P.EVENT:case P.BINARY_EVENT:this.onevent(e);break;case P.ACK:case P.BINARY_ACK:this.onack(e);break;case P.DISCONNECT:this.ondisconnect();break;case P.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const s=e.data||[];e.id!=null&&s.push(this.ack(e.id)),this.connected?this.emitEvent(s):this.receiveBuffer.push(Object.freeze(s))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const s=this._anyListeners.slice();for(const n of s)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const s=this;let n=!1;return function(...a){n||(n=!0,s.packet({type:P.ACK,id:e,data:a}))}}onack(e){const s=this.acks[e.id];typeof s=="function"&&(delete this.acks[e.id],s.withError&&e.data.unshift(null),s.apply(this,e.data))}onconnect(e,s){this.id=e,this.recovered=s&&this._pid===s,this._pid=s,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:P.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const s=this._anyListeners;for(let n=0;n<s.length;n++)if(e===s[n])return s.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const s=this._anyOutgoingListeners;for(let n=0;n<s.length;n++)if(e===s[n])return s.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const s=this._anyOutgoingListeners.slice();for(const n of s)n.apply(this,e.data)}}}function tt(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}tt.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),s=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+s:t-s}return Math.min(t,this.max)|0};tt.prototype.reset=function(){this.attempts=0};tt.prototype.setMin=function(t){this.ms=t};tt.prototype.setMax=function(t){this.max=t};tt.prototype.setJitter=function(t){this.jitter=t};class Ns extends X{constructor(e,s){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(s=e,e=void 0),s=s||{},s.path=s.path||"/socket.io",this.opts=s,Gt(this,s),this.reconnection(s.reconnection!==!1),this.reconnectionAttempts(s.reconnectionAttempts||1/0),this.reconnectionDelay(s.reconnectionDelay||1e3),this.reconnectionDelayMax(s.reconnectionDelayMax||5e3),this.randomizationFactor((n=s.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new tt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(s.timeout==null?2e4:s.timeout),this._readyState="closed",this.uri=e;const a=s.parser||nd;this.encoder=new a.Encoder,this.decoder=new a.Decoder,this._autoConnect=s.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var s;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(s=this.backoff)===null||s===void 0||s.setMin(e),this)}randomizationFactor(e){var s;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(s=this.backoff)===null||s===void 0||s.setJitter(e),this)}reconnectionDelayMax(e){var s;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(s=this.backoff)===null||s===void 0||s.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Yl(this.uri,this.opts);const s=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const a=xe(s,"open",function(){n.onopen(),e&&e()}),o=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},i=xe(s,"error",o);if(this._timeout!==!1){const c=this._timeout,l=this.setTimeoutFn(()=>{a(),o(new Error("timeout")),s.close()},c);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(a),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(xe(e,"ping",this.onping.bind(this)),xe(e,"data",this.ondata.bind(this)),xe(e,"error",this.onerror.bind(this)),xe(e,"close",this.onclose.bind(this)),xe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(s){this.onclose("parse error",s)}}ondecoded(e){Kt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,s){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Nn(this,e,s),this.nsps[e]=n),n}_destroy(e){const s=Object.keys(this.nsps);for(const n of s)if(this.nsps[n].active)return;this._close()}_packet(e){const s=this.encoder.encode(e);for(let n=0;n<s.length;n++)this.engine.write(s[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,s){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,s),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const s=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(a=>{a?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",a)):e.onreconnect()}))},s);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const ot={};function Ot(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const s=Hl(t,e.path||"/socket.io"),n=s.source,a=s.id,o=s.path,i=ot[a]&&o in ot[a].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||i;let l;return c?l=new Ns(n,e):(ot[a]||(ot[a]=new Ns(n,e)),l=ot[a]),s.query&&!e.query&&(e.query=s.queryKey),l.socket(s.path,e)}Object.assign(Ot,{Manager:Ns,Socket:Nn,io:Ot,connect:Ot});const od=({socket:t,onConnectionSuccess:e,onClose:s})=>{const[n,a]=u.useState("idle"),[o,i]=u.useState(""),[c,l]=u.useState(null),[h,d]=u.useState(null),[g,f]=u.useState([]),[b,w]=u.useState([]);u.useEffect(()=>{x()},[]),u.useEffect(()=>{if(t)return t.on("whatsapp:status",m=>{console.log("WhatsApp status update:",m),m.sessionName===h&&(m.status==="WORKING"?(a("connected"),O.success("WhatsApp conectado com sucesso!"),x(),e&&e(),setTimeout(()=>{s&&s()},2e3)):m.status==="FAILED"?(a("failed"),O.error("Falha ao conectar WhatsApp")):m.status==="SCAN_QR_CODE"&&a("qr_ready"))}),()=>{t.off("whatsapp:status")}},[t,h,e]);const x=async()=>{try{const{data:m}=await j.get("/chat/whatsapp/sessions"),E=m.sessions.filter(R=>R.status==="WORKING"),A=m.sessions.filter(R=>R.status!=="WORKING"&&R.status!=="SCAN_QR_CODE");f(E),w(A)}catch(m){console.error("Error loading sessions:",m)}},S=async()=>{if(!o.trim()){O.error("Digite um nome para a conex√£o");return}if(!/^[a-zA-Z0-9_]+$/.test(o)){O.error("Use apenas letras, n√∫meros e underscores");return}try{a("creating");const m=await fetch("https://workflow.nexusatemporal.com/webhook/waha-create-session-v2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionName:o.toLowerCase()})});if(!m.ok)throw new Error("Erro ao criar sess√£o no N8N");const E=await m.json();if(console.log("N8N Response:",E),E.success&&E.sessionName){d(E.sessionName);try{await j.post("/chat/whatsapp/sessions/register",{sessionName:E.sessionName,friendlyName:o})}catch(U){console.error("Error registering session:",U)}const A=localStorage.getItem("token"),R=`https://api.nexusatemporal.com.br/api/api/chat/whatsapp/qrcode-proxy?session=${E.sessionName}`,I=await fetch(R,{headers:{Authorization:`Bearer ${A}`}});if(!I.ok)throw new Error("Erro ao buscar QR Code");const B=await I.blob(),D=URL.createObjectURL(B);l(D),a("qr_ready"),O.success("QR Code gerado! Escaneie com seu WhatsApp"),v(E.sessionName)}else throw new Error("QR Code n√£o retornado pelo N8N")}catch(m){console.error("Error creating session:",m),O.error(m.message||"Erro ao criar conex√£o"),a("failed")}},v=m=>{const E=async()=>{try{const{data:A}=await j.get(`/chat/whatsapp/sessions/${m}/status`);if(A.session.status==="WORKING"){a("connected"),O.success("WhatsApp conectado com sucesso!"),x(),e&&e(),setTimeout(()=>{s&&s()},2e3);return}else if(A.session.status==="FAILED"){a("failed"),O.error("Falha ao conectar");return}setTimeout(E,3e3)}catch(A){console.error("Error checking status:",A)}};E()},C=()=>{c&&c.startsWith("blob:")&&URL.revokeObjectURL(c),a("idle"),i(""),l(null),d(null)},p=async m=>{try{await j.post(`/chat/whatsapp/sessions/${m.name}/logout`),O.success(`${m.friendlyName||m.name} desconectado com sucesso`),await x()}catch(E){console.error("Error disconnecting:",E),O.error("Erro ao desconectar")}},T=async m=>{try{a("creating"),d(m.name),await j.post(`/chat/whatsapp/sessions/${m.name}/reconnect`);const E=localStorage.getItem("token"),A=`https://api.nexusatemporal.com.br/api/api/chat/whatsapp/qrcode-proxy?session=${m.name}`,R=await fetch(A,{headers:{Authorization:`Bearer ${E}`}});if(!R.ok)throw new Error("Erro ao buscar QR Code");const I=await R.blob(),B=URL.createObjectURL(I);l(B),a("qr_ready"),O.success("QR Code gerado! Escaneie para reconectar"),v(m.name)}catch(E){console.error("Error reconnecting:",E),O.error(E.message||"Erro ao reconectar"),a("idle")}};return r.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[r.jsx(hs,{className:"h-8 w-8 text-green-600"}),r.jsxs("div",{children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Conectar WhatsApp"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Conecte seu n√∫mero do WhatsApp ao sistema"})]})]}),g.length>0&&r.jsxs("div",{className:"mb-6 p-4 bg-green-50 rounded-lg border border-green-200",children:[r.jsxs("h3",{className:"font-semibold text-green-800 mb-2 flex items-center gap-2",children:[r.jsx(ds,{className:"h-5 w-5"}),"Conex√µes Ativas"]}),g.map(m=>r.jsxs("div",{className:"flex items-center justify-between py-2",children:[r.jsx("span",{className:"text-green-700 font-medium",children:m.friendlyName||m.name}),r.jsx("button",{onClick:()=>p(m),className:"text-sm text-red-600 hover:text-red-700 underline",children:"Desconectar"})]},m.name))]}),b.length>0&&r.jsxs("div",{className:"mb-6 p-4 bg-orange-50 rounded-lg border border-orange-200",children:[r.jsxs("h3",{className:"font-semibold text-orange-800 mb-2 flex items-center gap-2",children:[r.jsx(Js,{className:"h-5 w-5"}),"Conex√µes Inativas"]}),b.map(m=>r.jsxs("div",{className:"flex items-center justify-between py-2",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-orange-700 font-medium",children:m.friendlyName||m.name}),r.jsxs("p",{className:"text-xs text-orange-600",children:["Status: ",m.status]})]}),r.jsx("button",{onClick:()=>T(m),className:"text-sm text-blue-600 hover:text-blue-700 font-semibold underline",children:"Reconectar"})]},m.name))]}),n==="idle"&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Nome da Conex√£o"}),r.jsx("input",{type:"text",value:o,onChange:m=>i(m.target.value),onKeyPress:m=>{m.key==="Enter"&&S()},placeholder:"Ex: whatsapp_comercial",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500",maxLength:50,autoFocus:!0}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Use apenas letras, n√∫meros e underscores (_). Pressione Enter para conectar."})]}),r.jsxs("button",{onClick:S,className:"w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg flex items-center justify-center gap-2",children:[r.jsx(hs,{className:"h-5 w-5"}),"Conectar WhatsApp"]})]}),(n==="creating"||n==="starting")&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Zn,{className:"h-12 w-12 text-green-600 mx-auto mb-4 animate-spin"}),r.jsx("p",{className:"text-gray-600",children:n==="creating"?"Criando conex√£o...":"Gerando QR Code..."})]}),n==="qr_ready"&&c&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:[r.jsx(ea,{className:"h-8 w-8 text-green-600 mx-auto mb-2"}),r.jsx("h3",{className:"font-semibold text-green-800 mb-1",children:"QR Code Gerado!"}),r.jsx("p",{className:"text-sm text-green-700",children:"Escaneie com seu WhatsApp para conectar"})]}),r.jsx("div",{className:"bg-white border-4 border-green-500 rounded-lg p-4 flex justify-center",children:r.jsx("img",{src:c,alt:"QR Code WhatsApp",className:"max-w-xs w-full"})}),r.jsxs("div",{className:"text-center space-y-2",children:[r.jsx("p",{className:"text-sm text-gray-600",children:r.jsx("strong",{children:"Como conectar:"})}),r.jsxs("ol",{className:"text-sm text-gray-600 text-left space-y-1 max-w-md mx-auto",children:[r.jsx("li",{children:"1. Abra o WhatsApp no seu celular"}),r.jsxs("li",{children:["2. Toque em ",r.jsx("strong",{children:"Configura√ß√µes"})," ",">"," ",r.jsx("strong",{children:"Aparelhos conectados"})]}),r.jsxs("li",{children:["3. Toque em ",r.jsx("strong",{children:"Conectar um aparelho"})]}),r.jsx("li",{children:"4. Aponte a c√¢mera para este QR Code"})]})]}),r.jsx("button",{onClick:C,className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg",children:"Cancelar"})]}),n==="connected"&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(ds,{className:"h-16 w-16 text-green-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-xl font-bold text-green-800 mb-2",children:"Conectado com Sucesso!"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"Seu WhatsApp est√° conectado e pronto para usar"}),r.jsx("button",{onClick:C,className:"bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-6 rounded-lg",children:"Nova Conex√£o"})]}),n==="failed"&&r.jsxs("div",{className:"text-center py-12",children:[r.jsx(Js,{className:"h-16 w-16 text-red-600 mx-auto mb-4"}),r.jsx("h3",{className:"text-xl font-bold text-red-800 mb-2",children:"Falha na Conex√£o"}),r.jsx("p",{className:"text-gray-600 mb-6",children:"N√£o foi poss√≠vel conectar seu WhatsApp"}),r.jsxs("button",{onClick:C,className:"bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-6 rounded-lg flex items-center justify-center gap-2 mx-auto",children:[r.jsx(ta,{className:"h-5 w-5"}),"Tentar Novamente"]})]})]})},id=()=>{const[t,e]=u.useState([]),[s,n]=u.useState(null),[a,o]=u.useState([]),[i,c]=u.useState(""),[l,h]=u.useState(""),[d,g]=u.useState(""),[f,b]=u.useState(""),[w,x]=u.useState(!1),[S,v]=u.useState([]),[C,p]=u.useState(!1),[T,m]=u.useState(null),[E,A]=u.useState(!1),R=u.useRef(null),I=u.useRef(null);u.useEffect(()=>{const y=window.location.origin.includes("localhost")?"http://localhost:3001":"https://api.nexusatemporal.com.br";console.log("üîå Conectando WebSocket em:",y);const _=Ot(y,{auth:{token:localStorage.getItem("token")}});return _.on("connect",()=>{console.log("WebSocket connected");const k=localStorage.getItem("userId");k&&_.emit("auth",{userId:k,token:localStorage.getItem("token")})}),_.on("message:new",k=>{console.log("New message received:",k),s&&k.conversationId===s.id&&(o(z=>[...z,k]),B()),D()}),_.on("conversation:newMessage",k=>{console.log("New conversation message:",k),D()}),_.on("chat:new-message",k=>{if(console.log("üì± Nova mensagem WhatsApp recebida via WebSocket:",k),D(),k.direction==="outgoing"){console.log("‚è≠Ô∏è Mensagem outgoing ignorada (j√° adicionada localmente)");return}const z=I.current;if(z)if(console.log("üìã Conversa selecionada:",{id:z.id,phoneNumber:z.phoneNumber,whatsappInstanceId:z.whatsappInstanceId}),console.log("üì® Mensagem recebida de:",k.phoneNumber),z.phoneNumber===k.phoneNumber&&z.whatsappInstanceId===k.sessionName){console.log("‚úÖ Mensagem pertence √† conversa atual - adicionando √† lista");const W={id:k.id,conversationId:z.id,content:k.content,direction:k.direction,type:k.messageType||"text",status:"delivered",createdAt:k.createdAt};o(te=>[...te,W]),B()}else console.log("‚è≠Ô∏è Mensagem de outra conversa - exibindo toast"),O.success(`Nova mensagem de ${k.contactName||k.phoneNumber}`);else console.log("‚è≠Ô∏è Nenhuma conversa selecionada - exibindo toast"),O.success(`Nova mensagem de ${k.contactName||k.phoneNumber}`)}),_.on("chat:message-deleted",k=>{console.log("üóëÔ∏è Mensagem deletada no WhatsApp:",k),D();const z=I.current;z&&z.phoneNumber===k.phoneNumber&&z.whatsappInstanceId===k.sessionName&&(console.log("‚úÖ Removendo mensagem da conversa atual:",k.messageId),o(W=>W.filter(te=>te.id!==k.messageId)),O.success("Mensagem deletada no WhatsApp"))}),m(_),()=>{_.off("chat:new-message"),_.off("chat:message-deleted"),_.disconnect()}},[]),u.useEffect(()=>{I.current=s},[s]),u.useEffect(()=>{if(T&&s)return T.emit("conversation:join",{conversationId:s.id}),()=>{T.emit("conversation:leave",{conversationId:s.id})}},[T,s]),u.useEffect(()=>{D()},[l,d,f]),u.useEffect(()=>{s&&(U(s.id),F(s.id))},[s]),u.useEffect(()=>{J()},[]),u.useEffect(()=>{B()},[a]);const B=()=>{var y;(y=R.current)==null||y.scrollIntoView({behavior:"smooth"})},D=async()=>{try{const y=await je.getConversations({search:l,status:d});let _=[];try{_=(await je.getWhatsAppConversations()).map(W=>({id:`whatsapp-${W.sessionName}-${W.phoneNumber}`,contactName:W.contactName||W.phoneNumber,phoneNumber:W.phoneNumber,whatsappInstanceId:W.sessionName,chatType:W.chatType||"individual",status:"active",isUnread:(W.unreadCount||0)>0,unreadCount:W.unreadCount||0,lastMessageAt:W.lastMessageAt,lastMessagePreview:W.lastMessage,createdAt:W.lastMessageAt||new Date().toISOString(),updatedAt:W.lastMessageAt||new Date().toISOString()}))}catch(z){console.log("WhatsApp conversations not available:",z)}const k=[...y,..._].sort((z,W)=>{const te=z.lastMessageAt?new Date(z.lastMessageAt).getTime():0;return(W.lastMessageAt?new Date(W.lastMessageAt).getTime():0)-te});e(k)}catch(y){console.error("Error loading conversations:",y),O.error("Erro ao carregar conversas")}},U=async y=>{try{if(p(!0),y.startsWith("whatsapp-")){if(!s)return;const _=s.whatsappInstanceId,k=s.phoneNumber;console.log("üîç Buscando mensagens:",{sessionName:_,phoneNumber:k});const W=(await je.getWhatsAppMessages(_,k)).map(te=>({id:te.id,conversationId:y,direction:te.direction,type:te.messageType||"text",content:te.content,status:te.status||"delivered",createdAt:te.createdAt}));o(W)}else{const _=await je.getMessages(y);o(_)}}catch(_){console.error("Error loading messages:",_),O.error("Erro ao carregar mensagens")}finally{p(!1)}},J=async()=>{try{const y=await je.getQuickReplies();v(y)}catch(y){console.error("Error loading quick replies:",y)}},F=async y=>{try{if(y.startsWith("whatsapp-")){if(!s)return;const _=s.whatsappInstanceId,k=s.phoneNumber;console.log("‚úÖ Marcando como lido:",{sessionName:_,phoneNumber:k}),await je.markWhatsAppAsRead(_,k)}else await je.markAsRead(y);D()}catch(_){console.error("Error marking as read:",_)}},Q=async()=>{if(console.log("üöÄ FUN√á√ÉO sendMessage CHAMADA!",{messageInput:i,hasConversation:!!s}),!i.trim()||!s){console.log("‚ùå BLOQUEADO - Mensagem vazia ou sem conversa");return}try{let y;if(console.log("üîç DEBUG - Conversa selecionada:",{id:s.id,phoneNumber:s.phoneNumber,whatsappInstanceId:s.whatsappInstanceId,startsWithWhatsapp:s.id.startsWith("whatsapp-")}),(s.whatsappInstanceId||s.id.startsWith("whatsapp-")||s.phoneNumber&&s.phoneNumber.startsWith("55"))&&s.phoneNumber){console.log("üì§ Enviando mensagem WhatsApp:",{session:s.whatsappInstanceId,phone:s.phoneNumber,content:i});const k=s.whatsappInstanceId||"session_01k77wpm5edhch4b97qbgenk7p";y=await je.sendWhatsAppMessage(k,s.phoneNumber,i)}else console.log("üìß Enviando mensagem normal (n√£o WhatsApp)"),y=await je.sendMessage(s.id,{type:"text",content:i});o(k=>[...k,y]),c(""),B(),T&&T.emit("typing:stop",{conversationId:s.id,userId:localStorage.getItem("userId")}),O.success("Mensagem enviada")}catch(y){console.error("Error sending message:",y),O.error("Erro ao enviar mensagem")}},$e=()=>{T&&s&&T.emit("typing:start",{conversationId:s.id,userId:localStorage.getItem("userId"),userName:"Voc√™"})},ne=y=>{y.key==="Enter"&&!y.shiftKey&&(y.preventDefault(),Q())},ce=y=>{c(y.content),x(!1)},le=async y=>{if(confirm("Deseja realmente excluir esta mensagem?"))try{await je.deleteWhatsAppMessage(y),o(_=>_.filter(k=>k.id!==y)),O.success("Mensagem exclu√≠da com sucesso"),D()}catch(_){console.error("Error deleting message:",_),O.error("Erro ao excluir mensagem")}},N=y=>zr(new Date(y),"HH:mm",{locale:fs}),M=y=>y?Bo(new Date(y),{addSuffix:!0,locale:fs}):"",L=y=>{switch(y){case"sent":return r.jsx(us,{className:"h-3 w-3 text-gray-400"});case"delivered":return r.jsx(Zs,{className:"h-3 w-3 text-gray-400"});case"read":return r.jsx(Zs,{className:"h-3 w-3 text-blue-500"});case"pending":return r.jsx(Ge,{className:"h-3 w-3 text-gray-400"});default:return null}},H=t.filter(y=>!(l&&!y.contactName.toLowerCase().includes(l.toLowerCase())||d&&y.status!==d||f&&y.chatType!==f));return r.jsxs(r.Fragment,{children:[E&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:r.jsxs("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[r.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white",children:[r.jsx("h2",{className:"text-xl font-bold",children:"Conectar WhatsApp"}),r.jsx("button",{onClick:()=>A(!1),className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(ut,{className:"h-5 w-5"})})]}),r.jsx("div",{className:"p-6",children:r.jsx(od,{socket:T,onConnectionSuccess:()=>{A(!1),D()},onClose:()=>A(!1)})})]})}),r.jsxs("div",{className:"h-screen flex bg-gray-50",children:[r.jsxs("div",{className:"w-96 bg-white border-r border-gray-200 flex flex-col",children:[r.jsxs("div",{className:"p-4 border-b border-gray-200",children:[r.jsx("h1",{className:"text-xl font-bold text-gray-800 mb-3",children:"Chat"}),r.jsxs("div",{className:"relative",children:[r.jsx(Dr,{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Buscar conversas...",value:l,onChange:y=>h(y.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"})]}),r.jsxs("div",{className:"flex gap-2 mt-3",children:[r.jsx("button",{onClick:()=>g(""),className:`px-3 py-1.5 text-sm rounded-lg ${d===""?"bg-indigo-100 text-indigo-700":"bg-gray-100 text-gray-600"}`,children:"Todas"}),r.jsx("button",{onClick:()=>g("active"),className:`px-3 py-1.5 text-sm rounded-lg ${d==="active"?"bg-indigo-100 text-indigo-700":"bg-gray-100 text-gray-600"}`,children:"Ativas"}),r.jsx("button",{onClick:()=>g("waiting"),className:`px-3 py-1.5 text-sm rounded-lg ${d==="waiting"?"bg-indigo-100 text-indigo-700":"bg-gray-100 text-gray-600"}`,children:"Aguardando"})]}),r.jsxs("div",{className:"flex gap-2 mt-2",children:[r.jsx("button",{onClick:()=>b(""),className:`px-3 py-1.5 text-sm rounded-lg ${f===""?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:"Todos"}),r.jsx("button",{onClick:()=>b("individual"),className:`px-3 py-1.5 text-sm rounded-lg ${f==="individual"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:"Individuais"}),r.jsx("button",{onClick:()=>b("group"),className:`px-3 py-1.5 text-sm rounded-lg ${f==="group"?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:"Grupos"})]}),r.jsxs("button",{onClick:()=>A(!0),className:"mt-3 w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-lg flex items-center justify-center gap-2",children:[r.jsx(hs,{className:"h-4 w-4"}),"Conectar WhatsApp"]})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto",children:[H.map(y=>r.jsx("div",{onClick:()=>n(y),className:`p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 ${(s==null?void 0:s.id)===y.id?"bg-indigo-50":""}`,children:r.jsxs("div",{className:"flex items-start gap-3",children:[r.jsx("div",{className:"flex-shrink-0 w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center",children:r.jsx(Xe,{className:"h-6 w-6 text-indigo-600"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-900 truncate",children:y.contactName}),r.jsx("span",{className:"text-xs text-gray-500",children:M(y.lastMessageAt)})]}),r.jsx("p",{className:"text-sm text-gray-600 truncate",children:y.lastMessagePreview}),y.tags&&y.tags.length>0&&r.jsx("div",{className:"flex gap-1 mt-1",children:y.tags.slice(0,2).map(_=>r.jsx("span",{className:"px-2 py-0.5 text-xs bg-blue-100 text-blue-700 rounded",children:_},_))})]}),y.isUnread&&y.unreadCount>0&&r.jsx("div",{className:"flex-shrink-0 w-6 h-6 bg-indigo-600 text-white rounded-full flex items-center justify-center text-xs font-bold",children:y.unreadCount})]})},y.id)),H.length===0&&r.jsx("div",{className:"text-center py-12 text-gray-500",children:r.jsx("p",{children:"Nenhuma conversa encontrada"})})]})]}),s?r.jsxs("div",{className:"flex-1 flex flex-col bg-white",children:[r.jsxs("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 bg-indigo-100 rounded-full flex items-center justify-center",children:r.jsx(Xe,{className:"h-5 w-5 text-indigo-600"})}),r.jsxs("div",{children:[r.jsx("h2",{className:"font-semibold text-gray-900",children:s.contactName}),r.jsx("p",{className:"text-sm text-gray-500",children:s.phoneNumber})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(zt,{className:"h-5 w-5 text-gray-600"})}),r.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(sa,{className:"h-5 w-5 text-gray-600"})}),r.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(ra,{className:"h-5 w-5 text-gray-600"})})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50",children:C?r.jsx("div",{className:"text-center py-12 text-gray-500",children:"Carregando mensagens..."}):r.jsxs(r.Fragment,{children:[a.map(y=>r.jsx("div",{className:`flex group ${y.direction==="outgoing"?"justify-end":"justify-start"}`,children:r.jsxs("div",{className:"flex items-end gap-2",children:[r.jsxs("div",{className:`max-w-md px-4 py-2 rounded-lg ${y.direction==="outgoing"?"bg-indigo-600 text-white":"bg-white text-gray-900 border border-gray-200"}`,children:[y.content&&r.jsx("p",{className:"text-sm",children:y.content}),r.jsxs("div",{className:"flex items-center justify-end gap-1 mt-1",children:[r.jsx("span",{className:"text-xs opacity-75",children:N(y.createdAt)}),y.direction==="outgoing"&&L(y.status)]})]}),r.jsx("button",{onClick:()=>le(y.id),className:"opacity-0 group-hover:opacity-100 transition-opacity p-1 hover:bg-red-100 rounded text-red-600",title:"Excluir mensagem",children:r.jsx(na,{className:"h-4 w-4"})})]})},y.id)),r.jsx("div",{ref:R})]})}),w&&r.jsxs("div",{className:"border-t border-gray-200 bg-white p-3 max-h-48 overflow-y-auto",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Respostas R√°pidas"}),r.jsx("button",{onClick:()=>x(!1),className:"text-gray-400 hover:text-gray-600",children:r.jsx(ut,{className:"h-4 w-4"})})]}),r.jsx("div",{className:"grid grid-cols-2 gap-2",children:S.slice(0,6).map(y=>r.jsx("button",{onClick:()=>ce(y),className:"text-left p-2 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg truncate",children:y.title},y.id))})]}),r.jsx("div",{className:"p-4 border-t border-gray-200 bg-white",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>x(!w),className:"p-2 hover:bg-gray-100 rounded-lg",title:"Respostas R√°pidas",children:r.jsx(aa,{className:"h-5 w-5 text-gray-600"})}),r.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(oa,{className:"h-5 w-5 text-gray-600"})}),r.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(ia,{className:"h-5 w-5 text-gray-600"})}),r.jsx("input",{type:"text",placeholder:"Digite uma mensagem...",value:i,onChange:y=>{c(y.target.value),$e()},onKeyPress:ne,className:"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"}),r.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(ca,{className:"h-5 w-5 text-gray-600"})}),i.trim()?r.jsx("button",{onClick:Q,className:"p-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg",children:r.jsx(la,{className:"h-5 w-5"})}):r.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-lg",children:r.jsx(da,{className:"h-5 w-5 text-gray-600"})})]})})]}):r.jsx("div",{className:"flex-1 flex items-center justify-center bg-gray-50",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"w-24 h-24 bg-gray-200 rounded-full mx-auto mb-4 flex items-center justify-center",children:r.jsx(Xe,{className:"h-12 w-12 text-gray-400"})}),r.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Selecione uma conversa"}),r.jsx("p",{className:"text-gray-500",children:"Escolha uma conversa para come√ßar a conversar"})]})})]})]})};function me({children:t}){const{isAuthenticated:e}=gt();return e?r.jsx(r.Fragment,{children:t}):r.jsx(_r,{to:"/login",replace:!0})}const cd="/assets/favicon-BpAW-oFG.png",Rr=[{icon:ha,label:"Dashboard",path:"/dashboard"},{icon:ls,label:"Leads",path:"/leads"},{icon:Mr,label:"Chat",path:"/chat"},{icon:ks,label:"Agenda",path:"/agenda"},{icon:Lr,label:"Prontu√°rios",path:"/prontuarios"},{icon:Or,label:"Financeiro",path:"/financeiro"},{icon:ma,label:"Estoque",path:"/estoque"},{icon:fa,label:"Colabora√ß√£o",path:"/colaboracao"},{icon:ga,label:"BI & Analytics",path:"/bi"},{icon:pa,label:"Marketing",path:"/marketing"},{icon:xa,label:"Configura√ß√µes",path:"/settings"}];function fe({children:t}){var l,h;const[e,s]=u.useState(!0),n=Tr(),a=Vt(),{user:o,logout:i}=gt(),c=async()=>{await i(),a("/login")};return r.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[r.jsxs("aside",{className:`${e?"w-64":"w-20"} bg-white dark:bg-gray-800 border-r border-gray-200 dark:border-gray-700 transition-all duration-300 flex flex-col`,children:[r.jsxs("div",{className:"h-16 flex items-center justify-between px-4 border-b border-gray-200 dark:border-gray-700",children:[e?r.jsx("img",{src:Ss,alt:"Nexus Atemporal",className:"h-10"}):r.jsx("img",{src:cd,alt:"Nexus Atemporal",className:"h-8"}),r.jsx("button",{onClick:()=>s(!e),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e?r.jsx(ut,{size:20}):r.jsx(ua,{size:20})})]}),r.jsx("nav",{className:"flex-1 overflow-y-auto py-4",children:Rr.map(d=>{const g=d.icon,f=n.pathname===d.path;return r.jsxs(Mt,{to:d.path,className:`flex items-center px-4 py-3 mx-2 rounded-lg transition-colors ${f?"bg-primary-100 dark:bg-primary-900/20 text-primary-600":"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[r.jsx(g,{size:20,className:"flex-shrink-0"}),e&&r.jsx("span",{className:"ml-3",children:d.label})]},d.path)})}),r.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 p-4",children:e?r.jsxs("div",{children:[r.jsxs("div",{className:"flex items-center mb-3",children:[r.jsx("div",{className:"w-10 h-10 rounded-full bg-primary-600 flex items-center justify-center text-white font-bold",children:(l=o==null?void 0:o.name)==null?void 0:l.charAt(0).toUpperCase()}),r.jsxs("div",{className:"ml-3 flex-1",children:[r.jsx("p",{className:"text-sm font-medium",children:o==null?void 0:o.name}),r.jsx("p",{className:"text-xs text-gray-500",children:o==null?void 0:o.role})]})]}),r.jsxs("button",{onClick:c,className:"w-full flex items-center px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:[r.jsx(er,{size:18}),r.jsx("span",{className:"ml-2",children:"Sair"})]})]}):r.jsx("button",{onClick:c,className:"w-full flex items-center justify-center p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg",children:r.jsx(er,{size:20})})})]}),r.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden",children:[r.jsxs("header",{className:"h-16 bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between px-6",children:[r.jsx("h2",{className:"text-xl font-semibold",children:((h=Rr.find(d=>d.path===n.pathname))==null?void 0:h.label)||"Dashboard"}),r.jsx("div",{className:"flex items-center space-x-4",children:r.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:o==null?void 0:o.email})})]}),r.jsx("main",{className:"flex-1 overflow-y-auto p-6",id:"main-content",children:t})]})]})}const ld=new Pn({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}});function dd(){return r.jsxs(In,{client:ld,children:[r.jsx(Bn,{children:r.jsxs(Wn,{children:[r.jsx(re,{path:"/login",element:r.jsx(va,{})}),r.jsx(re,{path:"/register",element:r.jsx(wa,{})}),r.jsx(re,{path:"/",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsx(_r,{to:"/dashboard",replace:!0})})})}),r.jsx(re,{path:"/dashboard",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsx(ja,{})})})}),r.jsx(re,{path:"/leads",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsx(ul,{})})})}),r.jsx(re,{path:"/chat",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsx(id,{})})})}),r.jsx(re,{path:"/agenda",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Agenda"}),r.jsx("p",{className:"text-gray-600",children:"Em desenvolvimento..."})]})})})}),r.jsx(re,{path:"/prontuarios",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Prontu√°rios"}),r.jsx("p",{className:"text-gray-600",children:"Em desenvolvimento..."})]})})})}),r.jsx(re,{path:"/financeiro",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Financeiro"}),r.jsx("p",{className:"text-gray-600",children:"Em desenvolvimento..."})]})})})}),r.jsx(re,{path:"/estoque",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Estoque"}),r.jsx("p",{className:"text-gray-600",children:"Em desenvolvimento..."})]})})})}),r.jsx(re,{path:"/colaboracao",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Colabora√ß√£o"}),r.jsx("p",{className:"text-gray-600",children:"Em desenvolvimento..."})]})})})}),r.jsx(re,{path:"/bi",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"BI & Analytics"}),r.jsx("p",{className:"text-gray-600",children:"Em desenvolvimento..."})]})})})}),r.jsx(re,{path:"/marketing",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Marketing"}),r.jsx("p",{className:"text-gray-600",children:"Em desenvolvimento..."})]})})})}),r.jsx(re,{path:"/settings",element:r.jsx(me,{children:r.jsx(fe,{children:r.jsxs("div",{className:"text-center py-12",children:[r.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Configura√ß√µes"}),r.jsx("p",{className:"text-gray-600",children:"Em desenvolvimento..."})]})})})})]})}),r.jsx(ya,{position:"top-right"})]})}ms.createRoot(document.getElementById("root")).render(r.jsx(Y.StrictMode,{children:r.jsx(dd,{})}));
