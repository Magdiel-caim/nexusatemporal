import{j as e}from"./data-vendor-CPXAi296.js";import{r as d}from"./react-vendor-B1IcTyqJ.js";import{J as b,R as j,z as W,w as C,X as S,Y as E,T as f,x as Q,E as R,B as G,y as J,F as X,H,I as w}from"./index-C912A6CL.js";import{z as x,D as A,g as D,P as u,C as Z,b3 as ee,F as te}from"./ui-vendor-CGldjw86.js";import{E as ae}from"./exceljs.min-BlcZB2QI.js";import{P as se,a as re}from"./PieChart-pQduoUJX.js";const T=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899"];function xe(){const[P,N]=d.useState(!0),[i,_]=d.useState([]),[m,M]=d.useState([]),[o,B]=d.useState([]),[c,U]=d.useState(6),[h,L]=d.useState(10);d.useEffect(()=>{z()},[c,h]);const z=async()=>{try{N(!0);const[t,a,s]=await Promise.all([b.getMovementsMonthly(c),b.getMostUsedProducts(h),b.getStockValueByCategory()]),l=I(t.data);_(l),M(a.data||[]),B(s.data||[])}catch(t){console.error("Erro ao carregar relatórios:",t),x.error("Erro ao carregar relatórios")}finally{N(!1)}},I=t=>{const a={};return t.forEach(s=>{a[s.month]||(a[s.month]={month:s.month,ENTRADA:0,SAIDA:0}),a[s.month][s.type]=parseInt(s.total_quantity)}),Object.values(a).reverse()},g=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),V=async()=>{try{const t=new ae.Workbook,a=t.addWorksheet("Movimentações Mensais");a.columns=[{header:"Mês",key:"month",width:15},{header:"Entradas",key:"entrada",width:15},{header:"Saídas",key:"saida",width:15}],a.getRow(1).font={bold:!0},a.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF3B82F6"}},i.forEach(r=>a.addRow({month:r.month,entrada:r.ENTRADA,saida:r.SAIDA}));const s=t.addWorksheet("Produtos Mais Usados");s.columns=[{header:"Produto",key:"name",width:30},{header:"SKU",key:"sku",width:15},{header:"Quantidade Usada",key:"total",width:18}],s.getRow(1).font={bold:!0},s.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF8B5CF6"}},m.forEach(r=>s.addRow({name:r.name,sku:r.sku,total:r.total_output}));const l=t.addWorksheet("Valor por Categoria");l.columns=[{header:"Categoria",key:"category",width:20},{header:"Qtd Produtos",key:"count",width:15},{header:"Total Unidades",key:"units",width:15},{header:"Valor Total",key:"value",width:18}],l.getRow(1).font={bold:!0},l.getRow(1).fill={type:"pattern",pattern:"solid",fgColor:{argb:"FF10B981"}},o.forEach(r=>l.addRow({category:r.category,count:r.product_count,units:r.total_units,value:r.total_value})),l.getColumn("value").numFmt="R$ #,##0.00";const Y=await t.xlsx.writeBuffer(),O=new Blob([Y],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),F=URL.createObjectURL(O),y=document.createElement("a");y.href=F,y.download=`relatorio_estoque_${new Date().toISOString().split("T")[0]}.xlsx`,y.click(),URL.revokeObjectURL(F),x.success("Relatório exportado para Excel!")}catch(t){console.error("Erro ao exportar Excel:",t),x.error("Erro ao exportar Excel")}},$=()=>{try{const t=new H;t.setFontSize(18),t.setTextColor(59,130,246),t.text("Relatório de Estoque",14,20),t.setFontSize(10),t.setTextColor(100),t.text(`Gerado em: ${new Date().toLocaleString("pt-BR")}`,14,28);let a=40;t.setFontSize(14),t.setTextColor(0),t.text("Movimentações Mensais",14,a),w(t,{startY:a+5,head:[["Mês","Entradas","Saídas"]],body:i.map(s=>[s.month,s.ENTRADA,s.SAIDA]),headStyles:{fillColor:[59,130,246]},styles:{fontSize:9}}),a=t.lastAutoTable.finalY+15,t.setFontSize(14),t.text("Produtos Mais Usados",14,a),w(t,{startY:a+5,head:[["Produto","Quantidade"]],body:m.slice(0,5).map(s=>[s.name,s.total_output]),headStyles:{fillColor:[139,92,246]},styles:{fontSize:9}}),a=t.lastAutoTable.finalY+15,t.setFontSize(14),t.text("Valor por Categoria",14,a),w(t,{startY:a+5,head:[["Categoria","Produtos","Valor Total"]],body:o.map(s=>[s.category,s.product_count,`R$ ${parseFloat(s.total_value).toFixed(2)}`]),headStyles:{fillColor:[16,185,129]},styles:{fontSize:9}}),t.save(`relatorio_estoque_${new Date().toISOString().split("T")[0]}.pdf`),x.success("Relatório exportado para PDF!")}catch(t){console.error("Erro ao exportar PDF:",t),x.error("Erro ao exportar PDF")}};if(P)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})});const k=i.reduce((t,a)=>t+(a.ENTRADA||0),0),v=i.reduce((t,a)=>t+(a.SAIDA||0),0),p=k-v,q=o.reduce((t,a)=>t+parseFloat(a.total_value||0),0),K=o.reduce((t,a)=>t+parseInt(a.product_count||0),0),n=m[0];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(A,{className:"h-8 w-8 opacity-80"}),e.jsx("span",{className:"text-sm font-medium opacity-90",children:"Valor Total"})]}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:g(q)}),e.jsxs("p",{className:"text-sm opacity-80",children:[K," produtos em estoque"]})]}),e.jsxs("div",{className:`bg-gradient-to-br ${p>=0?"from-green-500 to-green-600":"from-red-500 to-red-600"} rounded-xl shadow-lg p-6 text-white`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(D,{className:"h-8 w-8 opacity-80"}),e.jsxs("span",{className:"text-sm font-medium opacity-90",children:["Saldo (",c,"m)"]})]}),e.jsxs("div",{className:"text-3xl font-bold mb-1",children:[p>0?"+":"",p]}),e.jsxs("p",{className:"text-sm opacity-80",children:["Entradas: ",k," | Saídas: ",v]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl shadow-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(u,{className:"h-8 w-8 opacity-80"}),e.jsx("span",{className:"text-sm font-medium opacity-90",children:"Mais Usado"})]}),e.jsx("div",{className:"text-lg font-bold mb-1 truncate",children:(n==null?void 0:n.name)||"N/A"}),e.jsxs("p",{className:"text-sm opacity-80",children:[(n==null?void 0:n.total_output)||0," unidades consumidas"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl shadow-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx(u,{className:"h-8 w-8 opacity-80"}),e.jsx("span",{className:"text-sm font-medium opacity-90",children:"Categorias"})]}),e.jsx("div",{className:"text-3xl font-bold mb-1",children:o.length}),e.jsx("p",{className:"text-sm opacity-80",children:"Distribuídas em estoque"})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Relatórios e Análises"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Visualize dados agregados e tendências do estoque"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{value:c,onChange:t=>U(Number(t.target.value)),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white bg-white dark:bg-gray-700",children:[e.jsx("option",{value:3,children:"3 meses"}),e.jsx("option",{value:6,children:"6 meses"}),e.jsx("option",{value:12,children:"12 meses"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{className:"h-5 w-5 text-gray-500"}),e.jsxs("select",{value:h,onChange:t=>L(Number(t.target.value)),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 dark:text-white bg-white dark:bg-gray-700",children:[e.jsx("option",{value:5,children:"Top 5"}),e.jsx("option",{value:10,children:"Top 10"}),e.jsx("option",{value:20,children:"Top 20"})]})]}),e.jsxs("button",{onClick:V,className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-sm",title:"Exportar para Excel",children:[e.jsx(ee,{className:"h-5 w-5 mr-2"}),"Excel"]}),e.jsxs("button",{onClick:$,className:"inline-flex items-center px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors shadow-sm",title:"Exportar para PDF",children:[e.jsx(te,{className:"h-5 w-5 mr-2"}),"PDF"]})]})]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(D,{className:"h-6 w-6 text-blue-600 dark:text-blue-400 mr-2"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Movimentações Mensais (Últimos ",c," Meses)"]})]}),e.jsx(j,{width:"100%",height:300,children:e.jsxs(W,{data:i,children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(S,{dataKey:"month",stroke:"#9CA3AF"}),e.jsx(E,{stroke:"#9CA3AF"}),e.jsx(f,{contentStyle:{backgroundColor:"#1F2937",border:"1px solid #374151",borderRadius:"8px"},labelStyle:{color:"#F3F4F6"}}),e.jsx(Q,{}),e.jsx(R,{type:"monotone",dataKey:"ENTRADA",stroke:"#10B981",strokeWidth:2,name:"Entradas"}),e.jsx(R,{type:"monotone",dataKey:"SAIDA",stroke:"#EF4444",strokeWidth:2,name:"Saídas"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(u,{className:"h-6 w-6 text-purple-600 dark:text-purple-400 mr-2"}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:["Top ",h," Produtos Mais Usados"]})]}),e.jsx(j,{width:"100%",height:300,children:e.jsxs(G,{data:m,layout:"vertical",children:[e.jsx(C,{strokeDasharray:"3 3",stroke:"#374151"}),e.jsx(S,{type:"number",stroke:"#9CA3AF"}),e.jsx(E,{type:"category",dataKey:"name",width:150,stroke:"#9CA3AF"}),e.jsx(f,{contentStyle:{backgroundColor:"#1F2937",border:"1px solid #374151",borderRadius:"8px"},labelStyle:{color:"#F3F4F6"}}),e.jsx(J,{dataKey:"total_output",fill:"#8B5CF6",name:"Quantidade Usada"})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(A,{className:"h-6 w-6 text-green-600 dark:text-green-400 mr-2"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Valor do Estoque por Categoria"})]}),e.jsx(j,{width:"100%",height:300,children:e.jsxs(se,{children:[e.jsx(re,{data:o,dataKey:"total_value",nameKey:"category",cx:"50%",cy:"50%",outerRadius:100,label:t=>`${t.category}: ${g(t.total_value)}`,children:o.map((t,a)=>e.jsx(X,{fill:T[a%T.length]},`cell-${a}`))}),e.jsx(f,{formatter:t=>g(t),contentStyle:{backgroundColor:"#1F2937",border:"1px solid #374151",borderRadius:"8px"},labelStyle:{color:"#F3F4F6"}})]})})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Detalhamento por Categoria"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Categoria"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Produtos"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Unidades"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Valor Total"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:o.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 text-sm font-medium text-gray-900 dark:text-white",children:t.category}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-gray-500 dark:text-gray-400",children:t.product_count}),e.jsx("td",{className:"px-6 py-4 text-sm text-right text-gray-500 dark:text-gray-400",children:Math.round(t.total_units)}),e.jsx("td",{className:"px-6 py-4 text-sm text-right font-medium text-green-600 dark:text-green-400",children:g(t.total_value)})]},t.category))})]})})]})]})}export{xe as default};
