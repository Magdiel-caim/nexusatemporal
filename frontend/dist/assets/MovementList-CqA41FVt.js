import{j as e}from"./data-vendor-DkslvP0H.js";import{r as a}from"./react-vendor-C5Agepg6.js";import{s as P,u,w as R}from"./index-DNdWYF4P.js";import{z as d,aK as U,n as L,h as M,ae as V,af as I}from"./ui-vendor-CNf7S7pz.js";function J({refreshKey:k}){const[x,D]=a.useState([]),[A,p]=a.useState(!0),[c,h]=a.useState(""),[n,g]=a.useState(""),[s,y]=a.useState(""),[o,m]=a.useState(""),[b,S]=a.useState(!1);a.useEffect(()=>{j()},[k,c,n]);const j=async()=>{try{p(!0);const t=await P.getMovements({limit:100,type:c||void 0,reason:n||void 0,startDate:s||void 0,endDate:o||void 0});D(t.data||[])}catch(t){console.error("Erro ao carregar movimentações:",t),d.error("Erro ao carregar movimentações")}finally{p(!1)}},C=()=>{s&&o?j():(s||o)&&d.error("Preencha ambas as datas")},O=()=>{h(""),g(""),y(""),m("")},F=()=>{try{const t=x.map(r=>{var f,N,v,E;return{"Data/Hora":new Date(r.createdAt).toLocaleString("pt-BR"),Produto:((f=r.product)==null?void 0:f.name)||"Produto não encontrado",SKU:((N=r.product)==null?void 0:N.sku)||"",Tipo:r.type,Motivo:r.reason,Quantidade:r.quantity,Unidade:((v=r.product)==null?void 0:v.unit)||"","Estoque Anterior":r.previousStock,"Estoque Novo":r.newStock,"Preço Unitário (R$)":r.unitPrice?r.unitPrice.toFixed(2):"","Valor Total (R$)":r.totalPrice?r.totalPrice.toFixed(2):"",Lote:r.batchNumber||"",NF:r.invoiceNumber||"",Observações:r.notes||"",Usuário:((E=r.user)==null?void 0:E.name)||""}}),i=u.book_new(),l=u.json_to_sheet(t),T=[{wch:18},{wch:30},{wch:15},{wch:12},{wch:20},{wch:12},{wch:10},{wch:15},{wch:15},{wch:18},{wch:18},{wch:15},{wch:15},{wch:30},{wch:20}];l["!cols"]=T,u.book_append_sheet(i,l,"Movimentações");const w=`movimentacoes_${new Date().toISOString().split("T")[0]}.xlsx`;R(i,w),d.success(`Arquivo ${w} exportado com sucesso!`)}catch(t){console.error("Erro ao exportar Excel:",t),d.error("Erro ao exportar arquivo Excel")}};return A?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:F,disabled:x.length===0,className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",title:"Exportar lista de movimentações para Excel",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Exportar Excel"]})}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("button",{onClick:()=>S(!b),className:"flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:[e.jsx(L,{className:"h-5 w-5"}),e.jsx("span",{className:"font-medium",children:"Filtros"})]}),(c||n||s||o)&&e.jsx("button",{onClick:O,className:"text-sm text-red-600 hover:text-red-700",children:"Limpar filtros"})]}),b&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Tipo"}),e.jsxs("select",{value:c,onChange:t=>h(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"ENTRADA",children:"Entrada"}),e.jsx("option",{value:"SAIDA",children:"Saída"}),e.jsx("option",{value:"AJUSTE",children:"Ajuste"}),e.jsx("option",{value:"DEVOLUCAO",children:"Devolução"}),e.jsx("option",{value:"PERDA",children:"Perda"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Motivo"}),e.jsxs("select",{value:n,onChange:t=>g(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"COMPRA",children:"Compra"}),e.jsx("option",{value:"PROCEDIMENTO",children:"Procedimento"}),e.jsx("option",{value:"VENDA",children:"Venda"}),e.jsx("option",{value:"AJUSTE_INVENTARIO",children:"Ajuste de Inventário"}),e.jsx("option",{value:"DEVOLUCAO_FORNECEDOR",children:"Devolução Fornecedor"}),e.jsx("option",{value:"DEVOLUCAO_CLIENTE",children:"Devolução Cliente"}),e.jsx("option",{value:"PERDA",children:"Perda"}),e.jsx("option",{value:"VENCIMENTO",children:"Vencimento"}),e.jsx("option",{value:"DANO",children:"Dano"}),e.jsx("option",{value:"OUTRO",children:"Outro"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Inicial"}),e.jsx("input",{type:"date",value:s,onChange:t=>y(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data Final"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"date",value:o,onChange:t=>m(t.target.value),className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"}),e.jsx("button",{onClick:C,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:e.jsx(M,{className:"h-5 w-5"})})]})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Data"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Produto"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Tipo"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Motivo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Quantidade"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-400 uppercase",children:"Estoque"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:x.map(t=>{var i,l;return e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:new Date(t.createdAt).toLocaleString("pt-BR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:((i=t.product)==null?void 0:i.name)||"Produto não encontrado"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-1 text-xs font-medium rounded-full ${t.type==="ENTRADA"||t.type==="DEVOLUCAO"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[t.type==="ENTRADA"||t.type==="DEVOLUCAO"?e.jsx(V,{className:"h-3 w-3 mr-1"}):e.jsx(I,{className:"h-3 w-3 mr-1"}),t.type]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:t.reason}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right font-medium text-gray-900",children:[t.quantity," ",(l=t.product)==null?void 0:l.unit]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right text-gray-500",children:[t.previousStock," → ",t.newStock]})]},t.id)})})]})})})]})}export{J as default};
