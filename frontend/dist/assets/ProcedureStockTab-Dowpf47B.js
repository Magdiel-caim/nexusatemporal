import{j as e}from"./data-vendor-DBjWdmlc.js";import{r as s}from"./react-vendor-C7NvnInC.js";import{z as a,X as z,e as P,j as R,r as B,P as C,s as D,u as G}from"./ui-vendor-B3MauVpt.js";import{y as m}from"./index-CssS8wpj.js";function Q({procedureId:c,onClose:y}){const[u,g]=s.useState([]),[S,N]=s.useState([]),[n,k]=s.useState(!0),[p,h]=s.useState(!1),[f,j]=s.useState(""),[v,t]=s.useState(1),[o,i]=s.useState(!0),[b,E]=s.useState(""),[d,T]=s.useState(null);s.useEffect(()=>{w()},[c]);const w=async()=>{try{k(!0);const[r,l]=await Promise.all([m.getProducts({isActive:!0,limit:1e3}),m.getProcedureProducts(c)]);N(r.data||[]),g(l.data||[]),await F()}catch(r){console.error("Erro ao carregar dados:",r),a.error("Erro ao carregar dados")}finally{k(!1)}},F=async()=>{try{const r=await m.validateStockForProcedure(c);T(r)}catch(r){console.error("Erro ao validar estoque:",r)}},I=async()=>{if(!f||v<=0){a.error("Selecione um produto e informe a quantidade");return}try{await m.addProductToProcedure({procedureId:c,productId:f,quantityUsed:v,isOptional:o,notes:b||void 0}),a.success("Produto adicionado ao procedimento"),h(!1),j(""),t(1),E(""),w()}catch(r){console.error("Erro ao adicionar produto:",r),a.error("Erro ao adicionar produto")}},L=async r=>{if(confirm("Tem certeza que deseja remover este produto do procedimento?"))try{await m.removeProcedureProduct(r),a.success("Produto removido do procedimento"),w()}catch(l){console.error("Erro ao remover produto:",l),a.error("Erro ao remover produto")}},O=async()=>{var r,l;if(!(d!=null&&d.valid)){a.error("Estoque insuficiente para alguns produtos");return}if(confirm("Confirma a baixa automática de todos os produtos deste procedimento?"))try{const x=await m.consumeStockForProcedure(c);x.success?(a.success("Estoque consumido com sucesso!"),w()):(a.error("Houve erros ao consumir o estoque"),console.error("Errors:",x.errors))}catch(x){console.error("Erro ao consumir estoque:",x),a.error(((l=(r=x.response)==null?void 0:r.data)==null?void 0:l.error)||"Erro ao consumir estoque")}};return n?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Gerenciar Produtos do Procedimento"}),e.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(z,{className:"h-6 w-6"})})]}),d&&e.jsx("div",{className:`px-6 py-3 ${d.valid?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:e.jsx("div",{className:"flex items-center",children:d.valid?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-5 w-5 text-green-600 dark:text-green-400 mr-2"}),e.jsx("span",{className:"text-sm text-green-800 dark:text-green-300 font-medium",children:"Estoque suficiente para todos os produtos"})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"h-5 w-5 text-red-600 dark:text-red-400 mr-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-red-800 dark:text-red-300 font-medium block",children:"Estoque insuficiente:"}),d.insufficientStock.map(r=>e.jsxs("span",{className:"text-xs text-red-700 dark:text-red-400 block",children:[r.productName,": necessário ",r.required,", disponível ",r.available]},r.productId))]})]})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>h(!p),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),"Adicionar Produto"]})}),p&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Produto"}),e.jsxs("select",{value:f,onChange:r=>j(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"Selecione um produto"}),S.map(r=>e.jsxs("option",{value:r.id,children:[r.name," - Estoque: ",r.currentStock," ",r.unit]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",min:"0.01",step:"0.01",value:v,onChange:r=>t(parseFloat(r.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:o,onChange:r=>i(r.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Produto opcional"})]})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Observações"}),e.jsx("textarea",{value:b,onChange:r=>E(r.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"Cancelar"}),e.jsx("button",{onClick:I,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Adicionar"})]})]}),u.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhum produto vinculado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Adicione produtos ao procedimento para controlar o consumo de estoque"})]}):e.jsx("div",{className:"space-y-3",children:u.map(r=>{var l,x,q,A;return e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:((l=r.product)==null?void 0:l.name)||"Produto não encontrado"}),r.isOptional&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-full",children:"Opcional"})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Quantidade: ",r.quantityUsed," ",(x=r.product)==null?void 0:x.unit," • ","Estoque disponível: ",(q=r.product)==null?void 0:q.currentStock," ",(A=r.product)==null?void 0:A.unit]}),r.notes&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1 italic",children:r.notes})]}),e.jsx("button",{onClick:()=>L(r.id),className:"ml-4 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",children:e.jsx(D,{className:"h-5 w-5"})})]},r.id)})})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total de produtos: ",u.length]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:y,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"Fechar"}),e.jsx("button",{onClick:O,disabled:!(d!=null&&d.valid)||u.length===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Consumir Estoque"})]})]})]})})}function $(){const[c,y]=s.useState([]),[u,g]=s.useState([]),[S,N]=s.useState(!0),[n,k]=s.useState(""),[p,h]=s.useState(null);s.useEffect(()=>{f()},[]),s.useEffect(()=>{if(n.trim()==="")g(c);else{const t=c.filter(o=>{var i;return o.name.toLowerCase().includes(n.toLowerCase())||((i=o.description)==null?void 0:i.toLowerCase().includes(n.toLowerCase()))});g(t)}},[n,c]);const f=async()=>{var t,o;try{N(!0);const b=(await m.getProcedures()).data||[];y(b),g(b),b.length===0&&console.info("Nenhum procedimento cadastrado. Os procedimentos serão exibidos aqui quando forem criados no módulo de procedimentos.")}catch(i){console.error("Erro ao carregar procedimentos:",i),a.error(((o=(t=i.response)==null?void 0:t.data)==null?void 0:o.error)||"Erro ao carregar procedimentos"),y([]),g([])}finally{N(!1)}},j=t=>{h(t)},v=()=>{h(null)};return S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 border border-blue-100 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"h-12 w-12 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(C,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Gestão de Produtos por Procedimento"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:"Vincule produtos aos procedimentos e controle o consumo automático de estoque"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Validação automática de estoque"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Baixa automática ao finalizar"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(P,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Histórico de consumo"})]})]})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:n,onChange:t=>k(t.target.value),placeholder:"Buscar procedimentos por nome ou descrição...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white bg-white dark:bg-gray-700"})]})}),u.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-12 border border-gray-100 dark:border-gray-700 text-center",children:[e.jsx(C,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:n?"Nenhum procedimento encontrado":"Nenhum procedimento cadastrado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:n?"Tente ajustar os termos de busca":"Cadastre procedimentos para vincular produtos"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>j(t.id),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white text-lg mb-1",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:t.description})]}),e.jsx("div",{className:"ml-2",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.status==="ACTIVE"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.status==="ACTIVE"?"Ativo":"Inativo"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Criado em: ",new Date(t.createdAt).toLocaleDateString("pt-BR")]}),e.jsx("button",{onClick:o=>{o.stopPropagation(),j(t.id)},className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium",children:"Gerenciar →"})]})]},t.id))}),p&&e.jsx(Q,{procedureId:p,onClose:v})]})}export{$ as default};
