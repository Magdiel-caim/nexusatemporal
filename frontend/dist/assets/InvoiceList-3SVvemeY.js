import{j as e}from"./data-vendor-DRb15VUq.js";import{r as d}from"./react-vendor-Clsx5AbG.js";import{f as i}from"./index-0UigDgzX.js";import{ai as l,n as E,l as R,S as T,F as g,ag as I,G as D,a9 as B,X as b,e as L,k as _,d as P}from"./ui-vendor-DytlukZu.js";function V({onEditInvoice:x,onCreateInvoice:m}){const[n,y]=d.useState([]),[p,u]=d.useState(!0),[h,j]=d.useState(!1),[s,o]=d.useState({search:"",type:"",status:"",dateFrom:"",dateTo:""});d.useEffect(()=>{c()},[]);const c=async()=>{try{u(!0);const a=await i.getInvoices({search:s.search||void 0,type:s.type||void 0,status:s.status||void 0,dateFrom:s.dateFrom||void 0,dateTo:s.dateTo||void 0});y(a)}catch(a){l.error("Erro ao carregar recibos/NF: "+a.message)}finally{u(!1)}},f=async a=>{const t=prompt("Informe o motivo do cancelamento:");if(t)try{await i.cancelInvoice(a,t),l.success("Recibo/NF cancelado com sucesso!"),c()}catch(r){l.error("Erro ao cancelar: "+r.message)}},N=async a=>{var r;if(!a.pdfUrl){l.error("Gere o PDF antes de enviar");return}const t=prompt("Informe o email para envio:",((r=a.lead)==null?void 0:r.email)||a.sentTo||"");if(t)try{await i.markInvoiceAsSent(a.id,{sentTo:t,sentMethod:"email"}),l.success("Recibo/NF marcado como enviado!"),c()}catch(C){l.error("Erro ao marcar como enviado: "+C.message)}},v=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),k=a=>new Date(a).toLocaleDateString("pt-BR"),w=a=>({recibo:"Recibo",nota_fiscal:"Nota Fiscal",nota_servico:"Nota de Serviço"})[a]||a,F=a=>{const t={rascunho:{bg:"bg-gray-100 dark:bg-gray-700",text:"text-gray-800 dark:text-gray-200",label:"Rascunho"},emitida:{bg:"bg-blue-100 dark:bg-blue-900",text:"text-blue-800 dark:text-blue-200",label:"Emitida"},enviada:{bg:"bg-green-100 dark:bg-green-900",text:"text-green-800 dark:text-green-200",label:"Enviada"},cancelada:{bg:"bg-red-100 dark:bg-red-900",text:"text-red-800 dark:text-red-200",label:"Cancelada"}},r=t[a]||t.rascunho;return e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r.bg} ${r.text}`,children:r.label})},S=a=>{switch(a){case"emitida":return e.jsx(P,{className:"w-5 h-5 text-blue-600"});case"enviada":return e.jsx(_,{className:"w-5 h-5 text-green-600"});case"cancelada":return e.jsx(b,{className:"w-5 h-5 text-red-600"});default:return e.jsx(L,{className:"w-5 h-5 text-gray-600"})}};return p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"Recibos e Notas Fiscais"}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n.length," registro(s)"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("button",{onClick:()=>j(!h),className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),"Filtros"]}),m&&e.jsxs("button",{onClick:m,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Novo Recibo/NF"]})]})]}),h&&e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:s.search,onChange:a=>o(t=>({...t,search:a.target.value})),placeholder:"Número, descrição...",className:"pl-10 w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tipo"}),e.jsxs("select",{value:s.type,onChange:a=>o(t=>({...t,type:a.target.value})),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"recibo",children:"Recibo"}),e.jsx("option",{value:"nota_fiscal",children:"Nota Fiscal"}),e.jsx("option",{value:"nota_servico",children:"Nota de Serviço"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Status"}),e.jsxs("select",{value:s.status,onChange:a=>o(t=>({...t,status:a.target.value})),className:"w-full rounded-md border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white shadow-sm focus:border-blue-500 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Todos"}),e.jsx("option",{value:"rascunho",children:"Rascunho"}),e.jsx("option",{value:"emitida",children:"Emitida"}),e.jsx("option",{value:"enviada",children:"Enviada"}),e.jsx("option",{value:"cancelada",children:"Cancelada"})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:c,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Aplicar Filtros"})})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:n.length===0?e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx(g,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"Nenhum recibo/NF encontrado"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Comece criando um novo recibo ou nota fiscal."})]}):n.map(a=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 hover:shadow-lg transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"flex items-center justify-center w-10 h-10 rounded-lg bg-purple-100 dark:bg-purple-900",children:e.jsx(g,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-900 dark:text-white",children:a.invoiceNumber}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:w(a.type)})]})]}),S(a.status)]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Valor:"}),e.jsx("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:v(Number(a.amount))})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Emissão:"}),e.jsx("span",{className:"text-sm text-gray-900 dark:text-white",children:k(a.issueDate)})]}),a.description&&e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2",children:a.description}),e.jsx("div",{className:"pt-2",children:F(a.status)})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[a.pdfUrl&&e.jsx("a",{href:a.pdfUrl,target:"_blank",rel:"noopener noreferrer",className:"text-gray-600 hover:text-gray-900 dark:text-gray-400",title:"Visualizar PDF",children:e.jsx(I,{className:"w-4 h-4"})}),a.status!=="cancelada"&&e.jsx("button",{onClick:()=>N(a),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400",title:"Enviar",disabled:!a.pdfUrl,children:e.jsx(D,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a.status==="rascunho"&&x&&e.jsx("button",{onClick:()=>x(a),className:"text-blue-600 hover:text-blue-900 dark:text-blue-400",title:"Editar",children:e.jsx(B,{className:"w-4 h-4"})}),a.status!=="cancelada"&&e.jsx("button",{onClick:()=>f(a.id),className:"text-red-600 hover:text-red-900 dark:text-red-400",title:"Cancelar",children:e.jsx(b,{className:"w-4 h-4"})})]})]})]},a.id))})]})}export{V as default};
