import{j as e}from"./data-vendor-DN4GCDiI.js";import{r as a}from"./react-vendor-C5Agepg6.js";import{z as s,X as O,d as w,a5 as D,l as R,an as S,m as G,S as V}from"./ui-vendor-B5EPSjh4.js";import{s as m}from"./index-D6w6c1yX.js";function B({procedureId:d,onClose:f}){const[i,g]=a.useState([]),[P,j]=a.useState([]),[c,v]=a.useState(!0),[h,u]=a.useState(!1),[b,y]=a.useState(""),[p,t]=a.useState(1),[x,N]=a.useState(!0),[C,E]=a.useState(""),[o,T]=a.useState(null);a.useEffect(()=>{k()},[d]);const k=async()=>{try{v(!0);const[r,n]=await Promise.all([m.getProducts({isActive:!0,limit:1e3}),m.getProcedureProducts(d)]);j(r.data||[]),g(n.data||[]),await I()}catch(r){console.error("Erro ao carregar dados:",r),s.error("Erro ao carregar dados")}finally{v(!1)}},I=async()=>{try{const r=await m.validateStockForProcedure(d);T(r)}catch(r){console.error("Erro ao validar estoque:",r)}},L=async()=>{if(!b||p<=0){s.error("Selecione um produto e informe a quantidade");return}try{await m.addProductToProcedure({procedureId:d,productId:b,quantityUsed:p,isOptional:x,notes:C||void 0}),s.success("Produto adicionado ao procedimento"),u(!1),y(""),t(1),E(""),k()}catch(r){console.error("Erro ao adicionar produto:",r),s.error("Erro ao adicionar produto")}},z=async r=>{if(confirm("Tem certeza que deseja remover este produto do procedimento?"))try{await m.removeProcedureProduct(r),s.success("Produto removido do procedimento"),k()}catch(n){console.error("Erro ao remover produto:",n),s.error("Erro ao remover produto")}},F=async()=>{var r,n;if(!(o!=null&&o.valid)){s.error("Estoque insuficiente para alguns produtos");return}if(confirm("Confirma a baixa automática de todos os produtos deste procedimento?"))try{const l=await m.consumeStockForProcedure(d);l.success?(s.success("Estoque consumido com sucesso!"),k()):(s.error("Houve erros ao consumir o estoque"),console.error("Errors:",l.errors))}catch(l){console.error("Erro ao consumir estoque:",l),s.error(((n=(r=l.response)==null?void 0:r.data)==null?void 0:n.error)||"Erro ao consumir estoque")}};return c?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Gerenciar Produtos do Procedimento"}),e.jsx("button",{onClick:f,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx(O,{className:"h-6 w-6"})})]}),o&&e.jsx("div",{className:`px-6 py-3 ${o.valid?"bg-green-50 dark:bg-green-900/20":"bg-red-50 dark:bg-red-900/20"}`,children:e.jsx("div",{className:"flex items-center",children:o.valid?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-5 w-5 text-green-600 dark:text-green-400 mr-2"}),e.jsx("span",{className:"text-sm text-green-800 dark:text-green-300 font-medium",children:"Estoque suficiente para todos os produtos"})]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-5 w-5 text-red-600 dark:text-red-400 mr-2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-red-800 dark:text-red-300 font-medium block",children:"Estoque insuficiente:"}),o.insufficientStock.map(r=>e.jsxs("span",{className:"text-xs text-red-700 dark:text-red-400 block",children:[r.productName,": necessário ",r.required,", disponível ",r.available]},r.productId))]})]})})}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("button",{onClick:()=>u(!h),className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),"Adicionar Produto"]})}),h&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Produto"}),e.jsxs("select",{value:b,onChange:r=>y(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"Selecione um produto"}),P.map(r=>e.jsxs("option",{value:r.id,children:[r.name," - Estoque: ",r.currentStock," ",r.unit]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quantidade"}),e.jsx("input",{type:"number",min:"0.01",step:"0.01",value:p,onChange:r=>t(parseFloat(r.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]}),e.jsx("div",{className:"md:col-span-2",children:e.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:x,onChange:r=>N(r.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Produto opcional"})]})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Observações"}),e.jsx("textarea",{value:C,onChange:r=>E(r.target.value),rows:2,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 bg-white"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:()=>u(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"Cancelar"}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Adicionar"})]})]}),i.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhum produto vinculado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Adicione produtos ao procedimento para controlar o consumo de estoque"})]}):e.jsx("div",{className:"space-y-3",children:i.map(r=>{var n,l,q,A;return e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4 border border-gray-200 dark:border-gray-600 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-white",children:((n=r.product)==null?void 0:n.name)||"Produto não encontrado"}),r.isOptional&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-full",children:"Opcional"})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Quantidade: ",r.quantityUsed," ",(l=r.product)==null?void 0:l.unit," • ","Estoque disponível: ",(q=r.product)==null?void 0:q.currentStock," ",(A=r.product)==null?void 0:A.unit]}),r.notes&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-1 italic",children:r.notes})]}),e.jsx("button",{onClick:()=>z(r.id),className:"ml-4 text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300",children:e.jsx(G,{className:"h-5 w-5"})})]},r.id)})})]}),e.jsxs("div",{className:"px-6 py-4 border-t border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Total de produtos: ",i.length]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:f,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:"Fechar"}),e.jsx("button",{onClick:F,disabled:!(o!=null&&o.valid)||i.length===0,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Consumir Estoque"})]})]})]})})}function $(){const[d,f]=a.useState([]),[i,g]=a.useState([]),[P,j]=a.useState(!0),[c,v]=a.useState(""),[h,u]=a.useState(null);a.useEffect(()=>{b()},[]),a.useEffect(()=>{if(c.trim()==="")g(d);else{const t=d.filter(x=>{var N;return x.name.toLowerCase().includes(c.toLowerCase())||((N=x.description)==null?void 0:N.toLowerCase().includes(c.toLowerCase()))});g(t)}},[c,d]);const b=async()=>{try{j(!0);const t=[{id:"1",name:"Consulta Geral",description:"Consulta médica geral",status:"ACTIVE",createdAt:new Date().toISOString()},{id:"2",name:"Limpeza Dental",description:"Procedimento de limpeza e profilaxia",status:"ACTIVE",createdAt:new Date().toISOString()}];f(t),g(t)}catch(t){console.error("Erro ao carregar procedimentos:",t),s.error("Erro ao carregar procedimentos")}finally{j(!1)}},y=t=>{u(t)},p=()=>{u(null)};return P?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 border border-blue-100 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"h-12 w-12 bg-blue-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(S,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Gestão de Produtos por Procedimento"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300 mb-3",children:"Vincule produtos aos procedimentos e controle o consumo automático de estoque"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(w,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Validação automática de estoque"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(w,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Baixa automática ao finalizar"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(w,{className:"h-4 w-4 text-green-600 dark:text-green-400"}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300",children:"Histórico de consumo"})]})]})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-4 border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:c,onChange:t=>v(t.target.value),placeholder:"Buscar procedimentos por nome ou descrição...",className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-900 dark:text-white bg-white dark:bg-gray-700"})]})}),i.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-12 border border-gray-100 dark:border-gray-700 text-center",children:[e.jsx(S,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:c?"Nenhum procedimento encontrado":"Nenhum procedimento cadastrado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:c?"Tente ajustar os termos de busca":"Cadastre procedimentos para vincular produtos"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(t=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>y(t.id),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white text-lg mb-1",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:t.description})]}),e.jsx("div",{className:"ml-2",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.status==="ACTIVE"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400"}`,children:t.status==="ACTIVE"?"Ativo":"Inativo"})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200 dark:border-gray-700",children:[e.jsxs("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Criado em: ",new Date(t.createdAt).toLocaleDateString("pt-BR")]}),e.jsx("button",{onClick:x=>{x.stopPropagation(),y(t.id)},className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium",children:"Gerenciar →"})]})]},t.id))}),h&&e.jsx(B,{procedureId:h,onClose:p})]})}export{$ as default};
