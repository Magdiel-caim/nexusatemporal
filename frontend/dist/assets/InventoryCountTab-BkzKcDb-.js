import{j as e}from"./data-vendor-DBjWdmlc.js";import{r as l}from"./react-vendor-C7NvnInC.js";import{z as n,e as J,r as f,aj as Q,bd as N,s as V}from"./ui-vendor-B3MauVpt.js";import{y as x,a4 as i,a5 as v}from"./index-BX8cgyka.js";function Z(){const[c,m]=l.useState([]),[t,u]=l.useState(null),[O,k]=l.useState(!0),[G,h]=l.useState(!1),[T,z]=l.useState([]),[b,w]=l.useState(""),[C,S]=l.useState(""),[E,p]=l.useState(!1),[y,I]=l.useState(""),[j,P]=l.useState(0),[R,A]=l.useState("");l.useEffect(()=>{_(),q()},[]);const _=async()=>{var r,s;try{k(!0);const a=await x.getInventoryCounts({limit:100});m(a.data||[])}catch(a){console.error("Erro ao carregar contagens:",a),n.error(((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao carregar contagens")}finally{k(!1)}},q=async()=>{var r,s;try{const a=await x.getProducts({isActive:!0,limit:1e3});z(a.data||[])}catch(a){console.error("Erro ao carregar produtos:",a),n.error(((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao carregar produtos")}},F=async()=>{var r,s;if(!b.trim()){n.error("Descrição é obrigatória");return}try{const a=await x.createInventoryCount({description:b,location:C||void 0});m([a,...c]),w(""),S(""),h(!1),n.success("Contagem criada com sucesso!")}catch(a){console.error("Erro ao criar contagem:",a),n.error(((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao criar contagem")}},D=r=>{u(r),p(!1)},M=async()=>{var r,s;if(!t||!y||j===void 0){n.error("Selecione um produto e informe a quantidade contada");return}try{const a=await x.addInventoryCountItem(t.id,{productId:y,countedStock:j,notes:R||void 0}),o={...t,items:[...t.items,a]};u(o),m(c.map(d=>d.id===t.id?o:d)),I(""),P(0),A(""),p(!1),n.success("Item adicionado à contagem")}catch(a){console.error("Erro ao adicionar item:",a),n.error(((s=(r=a.response)==null?void 0:r.data)==null?void 0:s.error)||"Erro ao adicionar item")}},$=async r=>{var s,a;if(t)try{await x.deleteInventoryCountItem(r);const o={...t,items:t.items.filter(d=>d.id!==r)};u(o),m(c.map(d=>d.id===t.id?o:d)),n.success("Item removido")}catch(o){console.error("Erro ao remover item:",o),n.error(((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.error)||"Erro ao remover item")}},B=async r=>{var s,a;if(t)try{const o=await x.adjustInventoryItem(r),d={...t,items:t.items.map(g=>g.id===r?o.item:g)};u(d),m(c.map(g=>g.id===t.id?d:g)),n.success(o.message||"Item ajustado no estoque")}catch(o){console.error("Erro ao ajustar item:",o),n.error(((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.error)||"Erro ao ajustar item")}},H=async()=>{var s,a;if(!t)return;const r=t.items.filter(o=>!o.adjusted).length;if(r>0){n.error(`Ajuste todos os ${r} itens antes de finalizar`);return}try{const o=await x.completeInventoryCount(t.id);u(o),m(c.map(d=>d.id===t.id?o:d)),n.success("Contagem finalizada!")}catch(o){console.error("Erro ao finalizar contagem:",o),n.error(((a=(s=o.response)==null?void 0:s.data)==null?void 0:a.error)||"Erro ao finalizar contagem")}},L=r=>{switch(r){case i.IN_PROGRESS:return"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400";case i.COMPLETED:return"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400";case i.CANCELLED:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-400";default:return"bg-gray-100 text-gray-800"}},U=r=>{switch(r){case v.SURPLUS:return"bg-green-50 border-green-200 dark:bg-green-900/20 dark:border-green-700";case v.SHORTAGE:return"bg-red-50 border-red-200 dark:bg-red-900/20 dark:border-red-700";case v.MATCH:return"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-700";default:return"bg-gray-50 border-gray-200"}};return O?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:()=>u(null),className:"text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-white",children:"← Voltar"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:t.description}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${L(t.status)}`,children:t.status===i.IN_PROGRESS?"Em Andamento":t.status===i.COMPLETED?"Concluída":"Cancelada"})]}),t.status===i.IN_PROGRESS&&e.jsxs("button",{onClick:H,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(J,{className:"h-5 w-5 inline mr-2"}),"Finalizar Contagem"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-600 dark:text-gray-400",children:[t.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Local:"})," ",t.location]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Criado em:"})," ",new Date(t.createdAt).toLocaleString("pt-BR")]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Itens:"})," ",t.items.length]})]})]}),t.status===i.IN_PROGRESS&&e.jsx("div",{children:e.jsxs("button",{onClick:()=>p(!E),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(f,{className:"h-5 w-5 inline mr-2"}),"Adicionar Produto"]})}),E&&t.status===i.IN_PROGRESS&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-xl p-6",children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white mb-4",children:"Adicionar Produto à Contagem"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Produto"}),e.jsxs("select",{value:y,onChange:r=>I(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",children:[e.jsx("option",{value:"",children:"Selecione..."}),T.map(r=>e.jsxs("option",{value:r.id,children:[r.name," - Estoque: ",r.currentStock," ",r.unit]},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Quantidade Contada"}),e.jsx("input",{type:"number",min:"0",step:"1",value:j,onChange:r=>P(parseFloat(r.target.value)||0),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Observações"}),e.jsx("input",{type:"text",value:R,onChange:r=>A(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 text-gray-900 bg-white",placeholder:"Opcional"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:()=>p(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900",children:"Cancelar"}),e.jsxs("button",{onClick:M,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[e.jsx(Q,{className:"h-5 w-5 inline mr-2"}),"Salvar"]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Produtos Contados"}),t.items.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(N,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:'Nenhum produto adicionado ainda. Clique em "Adicionar Produto" para começar.'})]}):e.jsx("div",{className:"space-y-3",children:t.items.map(r=>e.jsx("div",{className:`border-2 rounded-lg p-4 ${U(r.discrepancyType)}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-white mb-2",children:[r.product.name,r.adjusted&&e.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-600 text-white rounded-full",children:"✓ Ajustado"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Sistema:"}),e.jsxs("span",{className:"font-medium ml-1",children:[r.systemStock," ",r.product.unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Contado:"}),e.jsxs("span",{className:"font-medium ml-1",children:[r.countedStock," ",r.product.unit]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Diferença:"}),e.jsxs("span",{className:`font-bold ml-1 ${r.difference>0?"text-green-600":r.difference<0?"text-red-600":"text-blue-600"}`,children:[r.difference>0?"+":"",r.difference," ",r.product.unit]})]})]}),r.notes&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2 italic",children:r.notes})]}),e.jsx("div",{className:"flex space-x-2 ml-4",children:!r.adjusted&&t.status===i.IN_PROGRESS&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>B(r.id),className:"px-3 py-1 bg-green-600 text-white text-sm rounded-lg hover:bg-green-700",children:"Ajustar"}),e.jsx("button",{onClick:()=>$(r.id),className:"px-3 py-1 bg-red-600 text-white text-sm rounded-lg hover:bg-red-700",children:e.jsx(V,{className:"h-4 w-4"})})]})})]})},r.id))})]})})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 dark:from-gray-800 dark:to-gray-700 rounded-xl p-6 border border-purple-100 dark:border-gray-600",children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx("div",{className:"h-12 w-12 bg-purple-600 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(N,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:"Contagem de Inventário"}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:"Realize contagens físicas do estoque e ajuste divergências automaticamente"})]}),e.jsxs("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors",children:[e.jsx(f,{className:"h-5 w-5 inline mr-2"}),"Nova Contagem"]})]})}),G&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Nova Contagem de Inventário"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Descrição *"}),e.jsx("input",{type:"text",value:b,onChange:r=>w(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-gray-900 bg-white",placeholder:"Ex: Contagem Mensal - Janeiro 2025"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Local"}),e.jsx("input",{type:"text",value:C,onChange:r=>S(r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 text-gray-900 bg-white",placeholder:"Ex: Depósito Principal"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-4",children:[e.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:text-gray-900",children:"Cancelar"}),e.jsx("button",{onClick:F,className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:"Criar Contagem"})]})]}),c.length===0?e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-12 border border-gray-100 dark:border-gray-700 text-center",children:[e.jsx(N,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhuma contagem cadastrada"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"Crie sua primeira contagem de inventário para começar"}),e.jsxs("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700",children:[e.jsx(f,{className:"h-5 w-5 inline mr-2"}),"Nova Contagem"]})]}):e.jsx("div",{className:"grid grid-cols-1 gap-4",children:c.map(r=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-sm p-6 border border-gray-100 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer",onClick:()=>D(r),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-2",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:r.description}),e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${L(r.status)}`,children:r.status===i.IN_PROGRESS?"Em Andamento":r.status===i.COMPLETED?"Concluída":"Cancelada"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-gray-600 dark:text-gray-400",children:[r.location&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Local:"})," ",r.location]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Itens:"})," ",r.items.length]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Criado em:"})," ",new Date(r.createdAt).toLocaleDateString("pt-BR")]})]})]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),D(r)},className:"ml-4 text-blue-600 dark:text-blue-400 hover:text-blue-700 font-medium",children:"Gerenciar →"})]})},r.id))})]})}export{Z as default};
