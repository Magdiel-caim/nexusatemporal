<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de AutomaÃ§Ãµes e IntegraÃ§Ãµes - Nexus Atemporal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 3px solid #8b5cf6;
            padding-bottom: 20px;
        }
        
        .header h1 {
            color: #8b5cf6;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #666;
            font-size: 1.1em;
        }
        
        .section {
            margin-bottom: 40px;
            page-break-inside: avoid;
        }
        
        .section h2 {
            color: #8b5cf6;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e5e7eb;
        }
        
        .section h3 {
            color: #6d28d9;
            font-size: 1.4em;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        .section h4 {
            color: #374151;
            font-size: 1.2em;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        
        .architecture-diagram {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            overflow-x: auto;
        }
        
        .integration-card {
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 30px;
            background: #f9fafb;
            page-break-inside: avoid;
        }
        
        .integration-card .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #8b5cf6;
            padding-bottom: 15px;
        }
        
        .integration-card .card-icon {
            font-size: 2.5em;
            margin-right: 15px;
        }
        
        .integration-card .card-title {
            font-size: 1.6em;
            color: #1f2937;
            font-weight: bold;
        }
        
        .integration-card .card-subtitle {
            color: #6b7280;
            font-style: italic;
            margin-bottom: 15px;
        }
        
        .workflow-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 20px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .workflow-box h4 {
            color: #92400e;
            margin-bottom: 10px;
        }
        
        .workflow-steps {
            list-style: none;
            counter-reset: step-counter;
        }
        
        .workflow-steps li {
            counter-increment: step-counter;
            margin: 10px 0;
            padding-left: 40px;
            position: relative;
        }
        
        .workflow-steps li:before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            background: #8b5cf6;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .api-endpoint {
            background: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
        }
        
        .api-method {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .method-get { background: #10b981; color: white; }
        .method-post { background: #3b82f6; color: white; }
        .method-put { background: #f59e0b; color: white; }
        .method-delete { background: #ef4444; color: white; }
        .method-patch { background: #8b5cf6; color: white; }
        
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85em;
            page-break-inside: avoid;
        }
        
        .code-block .comment {
            color: #94a3b8;
        }
        
        .code-block .keyword {
            color: #c084fc;
        }
        
        .code-block .string {
            color: #86efac;
        }
        
        .highlight-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .warning-box {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            padding: 20px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .success-box {
            background: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 20px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9em;
            page-break-inside: avoid;
        }
        
        table th {
            background: #8b5cf6;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }
        
        table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        
        table tr:nth-child(even) {
            background: #f9fafb;
        }
        
        table tr:hover {
            background: #f3f4f6;
        }
        
        .tech-stack {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .tech-item {
            background: white;
            border: 2px solid #8b5cf6;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .tech-item h4 {
            color: #8b5cf6;
            margin-bottom: 10px;
        }
        
        .button-container {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #f9fafb;
            border-radius: 8px;
        }
        
        .button {
            background: #8b5cf6;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s;
            margin: 0 10px;
        }
        
        .button:hover {
            background: #7c3aed;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        .toc {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 40px;
        }
        
        .toc h3 {
            color: #8b5cf6;
            margin-bottom: 15px;
        }
        
        .toc ul {
            list-style: none;
            line-height: 2;
        }
        
        .toc a {
            color: #4b5563;
            text-decoration: none;
        }
        
        .toc a:hover {
            color: #8b5cf6;
            text-decoration: underline;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                padding: 20px;
            }
            
            .button-container {
                display: none;
            }
            
            .section {
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– Sistema de AutomaÃ§Ãµes e IntegraÃ§Ãµes</h1>
            <p>Nexus Atemporal - CRM para ClÃ­nicas de EstÃ©tica</p>
            <p style="color: #999; font-size: 0.9em; margin-top: 10px;">VersÃ£o 1.0 - Outubro 2025</p>
        </div>

        <div class="button-container">
            <button class="button" onclick="window.print()">ğŸ“„ Baixar como PDF</button>
        </div>

        <div class="toc">
            <h3>ğŸ“‹ Ãndice</h3>
            <ul>
                <li><a href="#overview">1. VisÃ£o Geral</a></li>
                <li><a href="#architecture">2. Arquitetura de IntegraÃ§Ã£o</a></li>
                <li><a href="#n8n">3. IntegraÃ§Ã£o n8n (AutomaÃ§Ãµes)</a></li>
                <li><a href="#typebot">4. IntegraÃ§Ã£o Typebot (Chatbot)</a></li>
                <li><a href="#ai">5. IntegraÃ§Ã£o OpenAI (IA)</a></li>
                <li><a href="#whatsapp">6. IntegraÃ§Ã£o WhatsApp (Waha)</a></li>
                <li><a href="#apis">7. APIs de AutomaÃ§Ã£o</a></li>
                <li><a href="#workflows">8. Workflows Prontos</a></li>
                <li><a href="#events">9. Sistema de Eventos</a></li>
                <li><a href="#implementation">10. Guia de ImplementaÃ§Ã£o</a></li>
            </ul>
        </div>

        <div class="section" id="overview">
            <h2>ğŸ¯ 1. VisÃ£o Geral</h2>
            
            <div class="highlight-box">
                <h4>Objetivo</h4>
                <p>Criar um ecossistema de automaÃ§Ãµes e integraÃ§Ãµes que permita Ã s clÃ­nicas automatizar processos repetitivos, melhorar o atendimento ao cliente e aumentar a eficiÃªncia operacional atravÃ©s de IA e workflows inteligentes.</p>
            </div>

            <h3>1.1 Pilares do Sistema</h3>
            
            <div class="tech-stack">
                <div class="tech-item">
                    <h4>ğŸ”„ n8n</h4>
                    <p>AutomaÃ§Ãµes visuais e workflows</p>
                </div>
                <div class="tech-item">
                    <h4>ğŸ’¬ Typebot</h4>
                    <p>Chatbots conversacionais</p>
                </div>
                <div class="tech-item">
                    <h4>ğŸ§  OpenAI</h4>
                    <p>InteligÃªncia Artificial</p>
                </div>
                <div class="tech-item">
                    <h4>ğŸ“± WhatsApp</h4>
                    <p>ComunicaÃ§Ã£o em massa</p>
                </div>
            </div>

            <h3>1.2 BenefÃ­cios para as ClÃ­nicas</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>BenefÃ­cio</th>
                        <th>Impacto</th>
                        <th>Exemplo PrÃ¡tico</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ReduÃ§Ã£o de No-Show</strong></td>
                        <td>-40% de faltas</td>
                        <td>Lembretes automÃ¡ticos 24h antes</td>
                    </tr>
                    <tr>
                        <td><strong>Aumento de ConversÃ£o</strong></td>
                        <td>+35% vendas</td>
                        <td>Chatbot qualifica leads 24/7</td>
                    </tr>
                    <tr>
                        <td><strong>Economia de Tempo</strong></td>
                        <td>4h/dia economizadas</td>
                        <td>Tarefas repetitivas automatizadas</td>
                    </tr>
                    <tr>
                        <td><strong>RetenÃ§Ã£o de Clientes</strong></td>
                        <td>+25% recompra</td>
                        <td>Campanhas de reativaÃ§Ã£o automÃ¡ticas</td>
                    </tr>
                    <tr>
                        <td><strong>Atendimento 24/7</strong></td>
                        <td>Sem horÃ¡rio comercial</td>
                        <td>Bot responde fora do expediente</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" id="architecture">
            <h2>ğŸ—ï¸ 2. Arquitetura de IntegraÃ§Ã£o</h2>
            
            <h3>2.1 Diagrama de Arquitetura</h3>
            
            <div class="architecture-diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NEXUS ATEMPORAL CRM                           â”‚
â”‚                     (Backend - Node.js/TypeScript)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   API Gateway   â”‚  â† Webhooks bidirecionais
    â”‚   + RabbitMQ    â”‚  â† Fila de eventos assÃ­ncronos
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                               â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    n8n     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€ Eventos â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚    Typebot     â”‚
â”‚ (Workflows)â”‚                             â”‚   (Chatbot)    â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                                              â”‚
    â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   OpenAI API GPT-4  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚  (InteligÃªncia IA)  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Waha (WhatsApp)   â”‚
              â”‚   + Chatwoot (UI)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚   Cliente Final     â”‚
              â”‚   (WhatsApp User)   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
            </div>

            <h3>2.2 Fluxo de Dados</h3>
            
            <div class="workflow-box">
                <h4>Exemplo: Novo Lead via WhatsApp</h4>
                <ol class="workflow-steps">
                    <li>Cliente envia mensagem no WhatsApp</li>
                    <li>Waha recebe e encaminha para Typebot</li>
                    <li>Typebot conversa e qualifica o lead</li>
                    <li>Typebot envia webhook para Nexus CRM</li>
                    <li>CRM cria lead e dispara evento "lead.created"</li>
                    <li>RabbitMQ notifica n8n sobre novo lead</li>
                    <li>n8n executa workflow de boas-vindas</li>
                    <li>OpenAI analisa perfil e sugere procedimentos</li>
                    <li>Resultado salvo no CRM</li>
                    <li>NotificaÃ§Ã£o enviada para equipe de vendas</li>
                </ol>
            </div>

            <h3>2.3 ComunicaÃ§Ã£o AssÃ­ncrona</h3>
            
            <div class="highlight-box">
                <h4>Por que RabbitMQ?</h4>
                <ul>
                    <li><strong>Desacoplamento:</strong> Sistemas nÃ£o dependem uns dos outros diretamente</li>
                    <li><strong>ResiliÃªncia:</strong> Se n8n cair, eventos ficam na fila</li>
                    <li><strong>Escalabilidade:</strong> Processa milhares de eventos por segundo</li>
                    <li><strong>Retry automÃ¡tico:</strong> Tenta novamente em caso de falha</li>
                </ul>
            </div>
        </div>

        <div class="section" id="n8n">
            <h2>ğŸ”„ 3. IntegraÃ§Ã£o n8n (AutomaÃ§Ãµes)</h2>
            
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon">ğŸ”„</div>
                    <div class="card-title">n8n - AutomaÃ§Ã£o Visual</div>
                </div>
                <div class="card-subtitle">Plataforma open-source para criar workflows complexos sem cÃ³digo</div>
                
                <h4>3.1 InstalaÃ§Ã£o n8n</h4>
                <div class="code-block">
<span class="comment"># docker-compose.yml (adicionar ao seu stack)</span>

n8n:
  image: n8nio/n8n:latest
  restart: always
  ports:
    - "5678:5678"
  environment:
    - N8N_BASIC_AUTH_ACTIVE=true
    - N8N_BASIC_AUTH_USER=admin
    - N8N_BASIC_AUTH_PASSWORD=${N8N_PASSWORD}
    - WEBHOOK_URL=https://n8n.nexusatemporal.com.br
    - N8N_HOST=n8n.nexusatemporal.com.br
    - N8N_PORT=5678
    - N8N_PROTOCOL=https
    - NODE_ENV=production
  volumes:
    - n8n_data:/home/node/.n8n
  networks:
    - nexusatnet
                </div>

                <h4>3.2 ConfiguraÃ§Ã£o de Webhooks</h4>
                <div class="api-endpoint">
<span class="method-post api-method">POST</span> https://n8n.nexusatemporal.com.br/webhook/{workflow-id}
                </div>

                <h4>3.3 APIs para n8n</h4>
                
                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/n8n/webhooks/receive
<span class="comment">// Recebe dados de workflows n8n</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/n8n/workflows/trigger
<span class="comment">// Dispara workflow manualmente do CRM</span>
{
  "workflowId": "uuid",
  "data": {
    "leadId": "123",
    "action": "send_welcome"
  }
}
                </div>

                <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/n8n/workflows
<span class="comment">// Lista workflows disponÃ­veis por tenant</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/n8n/workflows/activate
<span class="comment">// Ativa/desativa workflow</span>
                </div>

                <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/n8n/workflows/{id}/logs
<span class="comment">// Logs de execuÃ§Ã£o do workflow</span>
                </div>

                <h4>3.4 Exemplo de ImplementaÃ§Ã£o</h4>
                <div class="code-block">
<span class="comment">// backend/src/modules/integrations/n8n/n8n.service.ts</span>

<span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">'axios'</span>;
<span class="keyword">import</span> { RabbitMQService } <span class="keyword">from</span> <span class="string">'@/shared/services/rabbitmq.service'</span>;

<span class="keyword">export class</span> N8nService {
  <span class="keyword">private</span> baseURL = process.env.N8N_URL;
  <span class="keyword">private</span> auth = {
    username: process.env.N8N_USER,
    password: process.env.N8N_PASSWORD
  };

  <span class="comment">// Disparar workflow do CRM para n8n</span>
  <span class="keyword">async</span> triggerWorkflow(workflowId: string, data: any) {
    <span class="keyword">try</span> {
      <span class="keyword">const</span> response = <span class="keyword">await</span> axios.post(
        `${this.baseURL}/webhook/${workflowId}`,
        data,
        { auth: this.auth }
      );
      
      <span class="keyword">return</span> response.data;
    } <span class="keyword">catch</span> (error) {
      console.error(<span class="string">'Erro ao disparar workflow:'</span>, error);
      <span class="keyword">throw</span> error;
    }
  }

  <span class="comment">// Receber webhook do n8n</span>
  <span class="keyword">async</span> receiveWebhook(workflowId: string, data: any) {
    <span class="comment">// Processa dados recebidos do n8n</span>
    <span class="keyword">const</span> eventType = data.event || <span class="string">'workflow.completed'</span>;
    
    <span class="comment">// Publica evento no RabbitMQ para outros serviÃ§os</span>
    <span class="keyword">await</span> RabbitMQService.publish(<span class="string">'n8n.events'</span>, {
      workflowId,
      eventType,
      data,
      timestamp: <span class="keyword">new</span> Date()
    });

    <span class="keyword">return</span> { success: <span class="keyword">true</span> };
  }
}
                </div>
            </div>
        </div>

        <div class="section" id="typebot">
            <h2>ğŸ’¬ 4. IntegraÃ§Ã£o Typebot (Chatbot)</h2>
            
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon">ğŸ’¬</div>
                    <div class="card-title">Typebot - Chatbot Conversacional</div>
                </div>
                <div class="card-subtitle">Construtor visual de chatbots com IA integrada</div>
                
                <h4>4.1 InstalaÃ§Ã£o Typebot</h4>
                <div class="code-block">
<span class="comment"># docker-compose.yml</span>

typebot-builder:
  image: baptistearno/typebot-builder:latest
  restart: always
  ports:
    - "3001:3000"
  environment:
    - DATABASE_URL=postgresql://user:pass@postgres/typebot
    - NEXTAUTH_URL=https://typebot.nexusatemporal.com.br
    - ENCRYPTION_SECRET=${TYPEBOT_ENCRYPTION_SECRET}
  networks:
    - nexusatnet

typebot-viewer:
  image: baptistearno/typebot-viewer:latest
  restart: always
  ports:
    - "3002:3000"
  environment:
    - DATABASE_URL=postgresql://user:pass@postgres/typebot
    - NEXTAUTH_URL=https://bot.nexusatemporal.com.br
  networks:
    - nexusatnet
                </div>

                <h4>4.2 APIs para Typebot</h4>
                
                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/typebot/conversation/start
<span class="comment">// Inicia conversa com bot</span>
{
  "botId": "uuid",
  "userId": "cliente-123",
  "channel": "whatsapp",
  "initialMessage": "OlÃ¡"
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/typebot/message
<span class="comment">// Envia mensagem para bot</span>
{
  "conversationId": "uuid",
  "message": "Quero agendar consulta",
  "metadata": {
    "source": "whatsapp",
    "phoneNumber": "+5511999999999"
  }
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/typebot/webhook
<span class="comment">// Recebe eventos do Typebot</span>
{
  "event": "conversation.completed",
  "conversationId": "uuid",
  "collectedData": {
    "name": "JoÃ£o Silva",
    "phone": "+5511999999999",
    "procedure": "Botox",
    "preferredDate": "2025-10-20"
  }
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/typebot/handoff
<span class="comment">// Transfere conversa para humano</span>
                </div>

                <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/typebot/flows
<span class="comment">// Lista fluxos de bot disponÃ­veis</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/typebot/flows/{id}/activate
<span class="comment">// Ativa fluxo de bot especÃ­fico</span>
                </div>

                <h4>4.3 IntegraÃ§Ã£o com WhatsApp</h4>
                <div class="code-block">
<span class="comment">// backend/src/modules/integrations/typebot/typebot.service.ts</span>

<span class="keyword">export class</span> TypebotService {
  <span class="keyword">async</span> handleWhatsAppMessage(
    phoneNumber: string,
    message: string,
    tenantId: string
  ) {
    <span class="comment">// Busca ou cria conversa</span>
    <span class="keyword">let</span> conversation = <span class="keyword">await</span> this.findConversation(phoneNumber);
    
    <span class="keyword">if</span> (!conversation) {
      <span class="comment">// Inicia nova conversa com bot</span>
      conversation = <span class="keyword">await</span> this.startConversation({
        botId: <span class="keyword">await</span> this.getActiveBotId(tenantId),
        userId: phoneNumber,
        channel: <span class="string">'whatsapp'</span>
      });
    }

    <span class="comment">// Envia mensagem para bot</span>
    <span class="keyword">const</span> response = <span class="keyword">await</span> this.sendMessage(
      conversation.id,
      message
    );

    <span class="comment">// Verifica se bot quer transferir para humano</span>
    <span class="keyword">if</span> (response.needsHandoff) {
      <span class="keyword">await</span> this.transferToChatwoot(conversation);
    }

    <span class="keyword">return</span> response;
  }

  <span class="keyword">async</span> processWebhook(data: any) {
    <span class="keyword">const</span> { event, collectedData } = data;

    <span class="keyword">if</span> (event === <span class="string">'conversation.completed'</span>) {
      <span class="comment">// Criar lead no CRM com dados coletados</span>
      <span class="keyword">await</span> this.createLeadFromBot(collectedData);
    }

    <span class="keyword">if</span> (event === <span class="string">'scheduling.requested'</span>) {
      <span class="comment">// Criar agendamento automaticamente</span>
      <span class="keyword">await</span> this.createAppointment(collectedData);
    }
  }
}
                </div>
            </div>
        </div>

        <div class="section" id="ai">
            <h2>ğŸ§  5. IntegraÃ§Ã£o OpenAI (IA)</h2>
            
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon">ğŸ§ </div>
                    <div class="card-title">OpenAI - InteligÃªncia Artificial</div>
                </div>
                <div class="card-subtitle">GPT-4 para anÃ¡lises, sugestÃµes e automaÃ§Ãµes inteligentes</div>
                
                <h4>5.1 APIs de IA</h4>
                
                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/analyze-lead
<span class="comment">// Analisa qualidade do lead e probabilidade de conversÃ£o</span>
{
  "leadId": "uuid",
  "data": {
    "name": "JoÃ£o Silva",
    "age": 35,
    "procedure": "Botox",
    "budget": "R$ 2.000",
    "urgency": "Alta"
  }
}

<span class="comment">Response:</span>
{
  "score": 85,
  "quality": "high",
  "conversionProbability": 0.82,
  "suggestedActions": [
    "Agendar consulta em atÃ© 24h",
    "Oferecer desconto de 10% para primeira sessÃ£o"
  ],
  "insights": "Cliente com perfil ideal..."
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/suggest-procedure
<span class="comment">// Sugere procedimentos baseado em perfil</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/generate-prescription
<span class="comment">// Gera prescriÃ§Ã£o base com IA</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/transcribe-audio
<span class="comment">// Transcreve Ã¡udios de atendimento</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/sentiment-analysis
<span class="comment">// Analisa sentimento do cliente em conversas</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/summary
<span class="comment">// Resume prontuÃ¡rios e conversas</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/predict-churn
<span class="comment">// PrevÃª risco de perda de cliente</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/predict-no-show
<span class="comment">// PrevÃª probabilidade de falta</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/optimize-schedule
<span class="comment">// Otimiza agenda dos profissionais</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/ai/chat
<span class="comment">// Assistente IA para equipe</span>
{
  "message": "Como aumentar conversÃ£o de leads?",
  "context": {
    "role": "ADMIN",
    "tenantId": "uuid"
  }
}
                </div>

                <h4>5.2 Exemplo de ImplementaÃ§Ã£o</h4>
                <div class="code-block">
<span class="comment">// backend/src/modules/ai/ai.service.ts</span>

<span class="keyword">import</span> { OpenAI } <span class="keyword">from</span> <span class="string">'openai'</span>;

<span class="keyword">export class</span> AIService {
  <span class="keyword">private</span> openai = <span class="keyword">new</span> OpenAI({
    apiKey: process.env.OPENAI_API_KEY
  });

  <span class="keyword">async</span> analyzeLead(leadData: any) {
    <span class="keyword">const</span> prompt = `
      Analise este lead de clÃ­nica de estÃ©tica:
      ${JSON.stringify(leadData, null, 2)}
      
      ForneÃ§a:
      1. Score de qualidade (0-100)
      2. Probabilidade de conversÃ£o
      3. 3 aÃ§Ãµes recomendadas
      4. Insights sobre o perfil
      
      Responda em JSON.
    `;

    <span class="keyword">const</span> response = <span class="keyword">await</span> this.openai.chat.completions.create({
      model: <span class="string">'gpt-4'</span>,
      messages: [{ role: <span class="string">'user'</span>, content: prompt }],
      response_format: { type: <span class="string">'json_object'</span> }
    });

    <span class="keyword">return</span> JSON.parse(response.choices[0].message.content);
  }

  <span class="keyword">async</span> predictNoShow(appointmentData: any) {
    <span class="comment">// Usa histÃ³rico de agendamentos para prever falta</span>
    <span class="keyword">const</span> historicalData = <span class="keyword">await</span> this.getHistoricalData();
    
    <span class="keyword">const</span> prompt = `
      Baseado nestes dados histÃ³ricos de no-show:
      ${JSON.stringify(historicalData)}
      
      Preveja a probabilidade deste agendamento resultar em falta:
      ${JSON.stringify(appointmentData)}
      
      Considere: horÃ¡rio, dia da semana, histÃ³rico do cliente,
      tipo de procedimento, tempo de antecedÃªncia.
    `;

    <span class="comment">// ...</span>
  }
}
                </div>
            </div>
        </div>

        <div class="section" id="whatsapp">
            <h2>ğŸ“± 6. IntegraÃ§Ã£o WhatsApp (Waha)</h2>
            
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon">ğŸ“±</div>
                    <div class="card-title">Waha - WhatsApp HTTP API</div>
                </div>
                <div class="card-subtitle">API para conectar WhatsApp com automaÃ§Ãµes</div>
                
                <h4>6.1 InstalaÃ§Ã£o Waha</h4>
                <div class="code-block">
<span class="comment"># docker-compose.yml</span>

waha:
  image: devlikeapro/waha:latest
  restart: always
  ports:
    - "3000:3000"
  environment:
    - WHATSAPP_HOOK_URL=https://api.nexusatemporal.com.br/api/whatsapp/webhook
    - WHATSAPP_HOOK_EVENTS=*
  volumes:
    - waha_data:/app/.sessions
  networks:
    - nexusatnet
                </div>

                <h4>6.2 APIs WhatsApp</h4>
                
                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/whatsapp/send
<span class="comment">// Envia mensagem via WhatsApp</span>
{
  "sessionId": "default",
  "chatId": "5511999999999@c.us",
  "text": "OlÃ¡! Confirmamos seu agendamento para amanhÃ£ Ã s 10h."
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/whatsapp/send-media
<span class="comment">// Envia imagem, documento ou Ã¡udio</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/whatsapp/webhook
<span class="comment">// Recebe mensagens do WhatsApp</span>
                </div>

                <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/whatsapp/sessions
<span class="comment">// Lista sessÃµes conectadas</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/whatsapp/sessions/start
<span class="comment">// Conecta novo nÃºmero</span>
                </div>

                <h4>6.3 Exemplo de ImplementaÃ§Ã£o</h4>
                <div class="code-block">
<span class="comment">// backend/src/modules/integrations/whatsapp/whatsapp.service.ts</span>

<span class="keyword">export class</span> WhatsAppService {
  <span class="keyword">async</span> handleIncomingMessage(data: any) {
    <span class="keyword">const</span> { from, body, type } = data;

    <span class="comment">// Busca cliente pelo nÃºmero</span>
    <span class="keyword">let</span> client = <span class="keyword">await</span> this.findClientByPhone(from);

    <span class="keyword">if</span> (!client) {
      <span class="comment">// Novo contato - redireciona para Typebot</span>
      <span class="keyword">await</span> TypebotService.handleWhatsAppMessage(from, body);
      <span class="keyword">return</span>;
    }

    <span class="comment">// Cliente existente - verifica contexto</span>
    <span class="keyword">const</span> context = <span class="keyword">await</span> this.getConversationContext(from);

    <span class="keyword">if</span> (context.hasPendingAppointment) {
      <span class="comment">// Pergunta sobre confirmaÃ§Ã£o</span>
      <span class="keyword">await</span> this.handleAppointmentConfirmation(from, body);
    } <span class="keyword">else</span> {
      <span class="comment">// Conversa geral - passa para Chatwoot ou Typebot</span>
      <span class="keyword">await</span> ChatwootService.createInbox(from, body);
    }
  }

  <span class="keyword">async</span> sendAppointmentReminder(appointmentId: string) {
    <span class="keyword">const</span> appointment = <span class="keyword">await</span> this.getAppointment(appointmentId);
    
    <span class="keyword">const</span> message = `
      OlÃ¡ ${appointment.clientName}! ğŸ‘‹
      
      Lembrando seu agendamento:
      ğŸ“… ${appointment.date}
      ğŸ• ${appointment.time}
      ğŸ©º ${appointment.procedure}
      
      Confirme com SIM ou cancele com NÃƒO.
    `;

    <span class="keyword">await</span> this.sendMessage(appointment.phone, message);
  }
}
                </div>
            </div>
        </div>

        <div class="section" id="apis">
            <h2>ğŸ”Œ 7. APIs de AutomaÃ§Ã£o</h2>
            
            <h3>7.1 API de Triggers/Eventos</h3>
            
            <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/triggers/create
<span class="comment">// Cria novo trigger</span>
{
  "name": "Enviar boas-vindas",
  "event": "lead.created",
  "conditions": {
    "source": "whatsapp",
    "status": "new"
  },
  "actions": [
    {
      "type": "webhook",
      "url": "https://n8n.nexusatemporal.com.br/webhook/welcome",
      "method": "POST"
    }
  ]
}
            </div>

            <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/triggers
<span class="comment">// Lista triggers ativos</span>
            </div>

            <div class="api-endpoint">
<span class="method-put api-method">PUT</span> /api/triggers/{id}/toggle
<span class="comment">// Ativa/desativa trigger</span>
            </div>

            <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/triggers/events
<span class="comment">// Lista eventos disponÃ­veis</span>
            </div>

            <h3>7.2 API de Workflows</h3>
            
            <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/workflows/execute
<span class="comment">// Executa workflow manualmente</span>
{
  "workflowId": "uuid",
  "input": {
    "leadId": "123",
    "action": "qualify"
  }
}
            </div>

            <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/workflows/templates
<span class="comment">// Lista templates prontos</span>
            </div>

            <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/workflows/schedule
<span class="comment">// Agenda execuÃ§Ã£o futura</span>
            </div>

            <h3>7.3 API de IntegraÃ§Ãµes</h3>
            
            <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/integrations
<span class="comment">// Lista integraÃ§Ãµes disponÃ­veis</span>
            </div>

            <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/integrations/{name}/connect
<span class="comment">// Conecta integraÃ§Ã£o</span>
{
  "credentials": {
    "apiKey": "...",
    "secret": "..."
  },
  "config": {
    "webhookUrl": "..."
  }
}
            </div>

            <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/integrations/{name}/status
<span class="comment">// Verifica status da conexÃ£o</span>
            </div>

            <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/integrations/{name}/sync
<span class="comment">// Sincroniza dados</span>
            </div>
        </div>

        <div class="section" id="workflows">
            <h2>âš™ï¸ 8. Workflows Prontos (Templates)</h2>
            
            <h3>8.1 GestÃ£o de Leads</h3>
            
            <div class="workflow-box">
                <h4>ğŸ“± Workflow: Novo Lead via WhatsApp</h4>
                <ol class="workflow-steps">
                    <li><strong>Trigger:</strong> Mensagem recebida no WhatsApp</li>
                    <li><strong>Bot qualifica:</strong> Typebot faz perguntas</li>
                    <li><strong>Cria lead:</strong> Dados salvos no CRM</li>
                    <li><strong>IA analisa:</strong> Score de qualidade gerado</li>
                    <li><strong>Notifica equipe:</strong> Vendedor recebe alerta</li>
                    <li><strong>Agendar follow-up:</strong> Tarefa criada automaticamente</li>
                </ol>
            </div>

            <div class="workflow-box">
                <h4>ğŸ¯ Workflow: QualificaÃ§Ã£o AutomÃ¡tica</h4>
                <ol class="workflow-steps">
                    <li><strong>Trigger:</strong> Lead criado</li>
                    <li><strong>IA analisa perfil:</strong> Budget, urgÃªncia, histÃ³rico</li>
                    <li><strong>Atribui score:</strong> 0-100 pontos</li>
                    <li><strong>Classifica:</strong> Hot/Warm/Cold</li>
                    <li><strong>Distribui:</strong> Atribui para vendedor disponÃ­vel</li>
                    <li><strong>Personaliza abordagem:</strong> Sugere script de vendas</li>
                </ol>
            </div>

            <h3>8.2 GestÃ£o de Agenda</h3>
            
            <div class="workflow-box">
                <h4>â° Workflow: Lembretes de Consulta</h4>
                <ol class="workflow-steps">
                    <li><strong>Trigger:</strong> 24h antes do agendamento</li>
                    <li><strong>Envia WhatsApp:</strong> Lembrete com detalhes</li>
                    <li><strong>Aguarda confirmaÃ§Ã£o:</strong> Cliente responde</li>
                    <li><strong>Se NÃƒO confirmar:</strong> Notifica recepÃ§Ã£o</li>
                    <li><strong>Se cancelar:</strong> Libera horÃ¡rio e notifica fila de espera</li>
                </ol>
            </div>

            <div class="workflow-box">
                <h4>ğŸš« Workflow: PrevenÃ§Ã£o de No-Show</h4>
                <ol class="workflow-steps">
                    <li><strong>IA prevÃª risco:</strong> Analisa histÃ³rico do cliente</li>
                    <li><strong>Se alto risco:</strong> Liga para confirmar</li>
                    <li><strong>Envia 2Âº lembrete:</strong> 2h antes do horÃ¡rio</li>
                    <li><strong>Oferece reagendamento:</strong> Se necessÃ¡rio</li>
                </ol>
            </div>

            <h3>8.3 Financeiro e Pagamentos</h3>
            
            <div class="workflow-box">
                <h4>ğŸ’° Workflow: CobranÃ§a AutomÃ¡tica</h4>
                <ol class="workflow-steps">
                    <li><strong>Trigger:</strong> Pagamento vencido</li>
                    <li><strong>D+1:</strong> Envia lembrete amigÃ¡vel via WhatsApp</li>
                    <li><strong>D+3:</strong> Envia e-mail com boleto</li>
                    <li><strong>D+7:</strong> LigaÃ§Ã£o da equipe financeira</li>
                    <li><strong>D+15:</strong> Envia para cobranÃ§a externa</li>
                </ol>
            </div>

            <div class="workflow-box">
                <h4>âœ… Workflow: Pagamento Confirmado</h4>
                <ol class="workflow-steps">
                    <li><strong>Trigger:</strong> Webhook do gateway</li>
                    <li><strong>Atualiza CRM:</strong> Status pago</li>
                    <li><strong>Envia comprovante:</strong> Via WhatsApp/E-mail</li>
                    <li><strong>Libera acesso:</strong> Se for assinatura</li>
                    <li><strong>Notifica profissional:</strong> Cliente confirmado</li>
                </ol>
            </div>

            <h3>8.4 RetenÃ§Ã£o de Clientes</h3>
            
            <div class="workflow-box">
                <h4>ğŸ‚ Workflow: AniversÃ¡rio do Cliente</h4>
                <ol class="workflow-steps">
                    <li><strong>Trigger:</strong> AniversÃ¡rio hoje</li>
                    <li><strong>Envia parabÃ©ns:</strong> Mensagem personalizada</li>
                    <li><strong>Oferece desconto:</strong> 15% OFF no mÃªs</li>
                    <li><strong>Sugere procedimento:</strong> Baseado no histÃ³rico</li>
                </ol>
            </div>

            <div class="workflow-box">
                <h4>ğŸ’¤ Workflow: ReativaÃ§Ã£o de Inativos</h4>
                <ol class="workflow-steps">
                    <li><strong>Trigger:</strong> Cliente sem retorno hÃ¡ 90 dias</li>
                    <li><strong>IA identifica motivo:</strong> Analisa histÃ³rico</li>
                    <li><strong>Campanha personalizada:</strong> E-mail + WhatsApp</li>
                    <li><strong>Oferece incentivo:</strong> PromoÃ§Ã£o exclusiva</li>
                    <li><strong>Se responder:</strong> Atribui para vendedor</li>
                </ol>
            </div>

            <h3>8.5 PÃ³s-Atendimento</h3>
            
            <div class="workflow-box">
                <h4>â­ Workflow: Pesquisa de SatisfaÃ§Ã£o</h4>
                <ol class="workflow-steps">
                    <li><strong>Trigger:</strong> 2h apÃ³s procedimento</li>
                    <li><strong>Envia pesquisa:</strong> Bot com 3 perguntas</li>
                    <li><strong>Se nota baixa:</strong> Alerta gerente imediatamente</li>
                    <li><strong>Se nota alta:</strong> Pede avaliaÃ§Ã£o no Google</li>
                    <li><strong>Oferece retorno:</strong> Consulta de revisÃ£o grÃ¡tis</li>
                </ol>
            </div>
        </div>

        <div class="section" id="events">
            <h2>ğŸ“¡ 9. Sistema de Eventos</h2>
            
            <h3>9.1 Eventos DisponÃ­veis</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>Categoria</th>
                        <th>Evento</th>
                        <th>Quando Dispara</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td rowspan="5"><strong>Leads</strong></td>
                        <td>lead.created</td>
                        <td>Novo lead cadastrado</td>
                    </tr>
                    <tr>
                        <td>lead.qualified</td>
                        <td>Lead qualificado (score calculado)</td>
                    </tr>
                    <tr>
                        <td>lead.converted</td>
                        <td>Lead virou cliente</td>
                    </tr>
                    <tr>
                        <td>lead.lost</td>
                        <td>Lead perdido/descartado</td>
                    </tr>
                    <tr>
                        <td>lead.assigned</td>
                        <td>Lead atribuÃ­do para vendedor</td>
                    </tr>
                    <tr>
                        <td rowspan="4"><strong>Agenda</strong></td>
                        <td>appointment.scheduled</td>
                        <td>Agendamento criado</td>
                    </tr>
                    <tr>
                        <td>appointment.confirmed</td>
                        <td>Cliente confirmou presenÃ§a</td>
                    </tr>
                    <tr>
                        <td>appointment.cancelled</td>
                        <td>Agendamento cancelado</td>
                    </tr>
                    <tr>
                        <td>appointment.completed</td>
                        <td>Consulta finalizada</td>
                    </tr>
                    <tr>
                        <td rowspan="4"><strong>Financeiro</strong></td>
                        <td>payment.received</td>
                        <td>Pagamento confirmado</td>
                    </tr>
                    <tr>
                        <td>payment.overdue</td>
                        <td>Pagamento vencido</td>
                    </tr>
                    <tr>
                        <td>payment.refunded</td>
                        <td>Estorno realizado</td>
                    </tr>
                    <tr>
                        <td>payment.pending</td>
                        <td>Aguardando pagamento</td>
                    </tr>
                    <tr>
                        <td rowspan="2"><strong>Estoque</strong></td>
                        <td>stock.low</td>
                        <td>Produto com estoque baixo</td>
                    </tr>
                    <tr>
                        <td>stock.out</td>
                        <td>Produto sem estoque</td>
                    </tr>
                    <tr>
                        <td rowspan="3"><strong>Cliente</strong></td>
                        <td>client.inactive</td>
                        <td>90 dias sem retorno</td>
                    </tr>
                    <tr>
                        <td>client.birthday</td>
                        <td>AniversÃ¡rio do cliente</td>
                    </tr>
                    <tr>
                        <td>client.vip</td>
                        <td>Cliente atingiu status VIP</td>
                    </tr>
                    <tr>
                        <td rowspan="2"><strong>ProntuÃ¡rio</strong></td>
                        <td>record.created</td>
                        <td>ProntuÃ¡rio criado</td>
                    </tr>
                    <tr>
                        <td>record.signed</td>
                        <td>ProntuÃ¡rio assinado digitalmente</td>
                    </tr>
                </tbody>
            </table>

            <h3>9.2 ImplementaÃ§Ã£o de Eventos</h3>
            
            <div class="code-block">
<span class="comment">// backend/src/shared/services/event-emitter.service.ts</span>

<span class="keyword">import</span> { RabbitMQService } <span class="keyword">from</span> <span class="string">'./rabbitmq.service'</span>;

<span class="keyword">export class</span> EventEmitterService {
  <span class="keyword">static async</span> emit(eventName: string, data: any) {
    <span class="comment">// Publica no RabbitMQ</span>
    <span class="keyword">await</span> RabbitMQService.publish(<span class="string">'events'</span>, {
      event: eventName,
      data,
      timestamp: <span class="keyword">new</span> Date(),
      tenantId: data.tenantId
    });

    <span class="comment">// Busca triggers ativos para este evento</span>
    <span class="keyword">const</span> triggers = <span class="keyword">await</span> this.getActiveTriggers(eventName);

    <span class="comment">// Executa cada trigger</span>
    <span class="keyword">for</span> (<span class="keyword">const</span> trigger <span class="keyword">of</span> triggers) {
      <span class="keyword">await</span> this.executeTrigger(trigger, data);
    }
  }

  <span class="keyword">static async</span> executeTrigger(trigger: any, data: any) {
    <span class="comment">// Verifica condiÃ§Ãµes</span>
    <span class="keyword">if</span> (!this.checkConditions(trigger.conditions, data)) {
      <span class="keyword">return</span>;
    }

    <span class="comment">// Executa aÃ§Ãµes</span>
    <span class="keyword">for</span> (<span class="keyword">const</span> action <span class="keyword">of</span> trigger.actions) {
      <span class="keyword">if</span> (action.type === <span class="string">'webhook'</span>) {
        <span class="keyword">await</span> this.callWebhook(action.url, data);
      }
      
      <span class="keyword">if</span> (action.type === <span class="string">'n8n'</span>) {
        <span class="keyword">await</span> N8nService.triggerWorkflow(action.workflowId, data);
      }
      
      <span class="keyword">if</span> (action.type === <span class="string">'notification'</span>) {
        <span class="keyword">await</span> NotificationService.send(action.userId, data);
      }
    }
  }
}

<span class="comment">// Uso nos controllers:</span>
<span class="keyword">await</span> EventEmitterService.emit(<span class="string">'lead.created'</span>, {
  leadId: lead.id,
  tenantId: lead.tenantId,
  source: <span class="string">'whatsapp'</span>,
  data: lead
});
            </div>
        </div>

        <div class="section" id="implementation">
            <h2>ğŸš€ 10. Guia de ImplementaÃ§Ã£o</h2>
            
            <h3>10.1 Fase 1: Infraestrutura (Semana 1-2)</h3>
            
            <div class="success-box">
                <h4>âœ… Checklist:</h4>
                <ul>
                    <li>â˜ Configurar RabbitMQ no Docker Swarm</li>
                    <li>â˜ Instalar n8n e configurar webhooks</li>
                    <li>â˜ Instalar Typebot (builder + viewer)</li>
                    <li>â˜ Configurar Waha para WhatsApp</li>
                    <li>â˜ Criar credenciais OpenAI</li>
                    <li>â˜ Configurar Traefik para subdomÃ­nios</li>
                </ul>
            </div>

            <h3>10.2 Fase 2: APIs Base (Semana 3-4)</h3>
            
            <div class="success-box">
                <h4>âœ… Checklist:</h4>
                <ul>
                    <li>â˜ Criar tabelas de triggers/events</li>
                    <li>â˜ Implementar EventEmitterService</li>
                    <li>â˜ Criar API de Triggers</li>
                    <li>â˜ Criar API de Workflows</li>
                    <li>â˜ Criar API de IntegraÃ§Ãµes</li>
                    <li>â˜ Implementar webhooks bidirecionais</li>
                </ul>
            </div>

            <h3>10.3 Fase 3: IntegraÃ§Ãµes (Semana 5-6)</h3>
            
            <div class="success-box">
                <h4>âœ… Checklist:</h4>
                <ul>
                    <li>â˜ Integrar n8n com CRM</li>
                    <li>â˜ Integrar Typebot com WhatsApp</li>
                    <li>â˜ Integrar OpenAI com anÃ¡lises</li>
                    <li>â˜ Conectar Waha com Chatwoot</li>
                    <li>â˜ Testar fluxo completo de eventos</li>
                    <li>â˜ Criar logs de integraÃ§Ã£o</li>
                </ul>
            </div>

            <h3>10.4 Fase 4: Workflows Prontos (Semana 7-8)</h3>
            
            <div class="success-box">
                <h4>âœ… Checklist:</h4>
                <ul>
                    <li>â˜ Criar template: Novo Lead</li>
                    <li>â˜ Criar template: Lembretes de Consulta</li>
                    <li>â˜ Criar template: CobranÃ§a AutomÃ¡tica</li>
                    <li>â˜ Criar template: Pesquisa de SatisfaÃ§Ã£o</li>
                    <li>â˜ Criar template: ReativaÃ§Ã£o de Inativos</li>
                    <li>â˜ Criar template: AniversÃ¡rio</li>
                    <li>â˜ Documentar cada workflow</li>
                    <li>â˜ Criar vÃ­deos tutoriais</li>
                </ul>
            </div>

            <h3>10.5 Fase 5: IA e AnÃ¡lises (Semana 9-10)</h3>
            
            <div class="success-box">
                <h4>âœ… Checklist:</h4>
                <ul>
                    <li>â˜ Implementar anÃ¡lise de leads com IA</li>
                    <li>â˜ Implementar prediÃ§Ã£o de no-show</li>
                    <li>â˜ Implementar prediÃ§Ã£o de churn</li>
                    <li>â˜ Implementar assistente IA para equipe</li>
                    <li>â˜ Implementar anÃ¡lise de sentimento</li>
                    <li>â˜ Implementar sugestÃµes de procedimentos</li>
                    <li>â˜ Criar dashboard de insights IA</li>
                </ul>
            </div>

            <h3>10.6 Fase 6: Interface e UX (Semana 11-12)</h3>
            
            <div class="success-box">
                <h4>âœ… Checklist:</h4>
                <ul>
                    <li>â˜ Criar pÃ¡gina de AutomaÃ§Ãµes no frontend</li>
                    <li>â˜ Criar builder visual de triggers</li>
                    <li>â˜ Criar biblioteca de workflows</li>
                    <li>â˜ Criar pÃ¡gina de IntegraÃ§Ãµes</li>
                    <li>â˜ Criar dashboard de monitoramento</li>
                    <li>â˜ Criar logs visuais de execuÃ§Ã£o</li>
                    <li>â˜ Implementar notificaÃ§Ãµes em tempo real</li>
                </ul>
            </div>

            <h3>10.7 Estrutura de Pastas Sugerida</h3>
            
            <div class="code-block">
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”œâ”€â”€ integrations/
â”‚   â”‚   â”‚   â”œâ”€â”€ n8n/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ n8n.controller.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ n8n.service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ n8n.routes.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ n8n.types.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ typebot/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ typebot.controller.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ typebot.service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ typebot.routes.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ typebot.types.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ whatsapp/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ whatsapp.controller.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ whatsapp.service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ whatsapp.routes.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ waha.client.ts
â”‚   â”‚   â”‚   â””â”€â”€ openai/
â”‚   â”‚   â”‚       â”œâ”€â”€ ai.controller.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ ai.service.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ ai.routes.ts
â”‚   â”‚   â”‚       â””â”€â”€ prompts/
â”‚   â”‚   â”œâ”€â”€ automation/
â”‚   â”‚   â”‚   â”œâ”€â”€ triggers/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ triggers.controller.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ triggers.service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ triggers.entity.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ triggers.routes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ workflows/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ workflows.controller.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ workflows.service.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ workflows.entity.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ templates/
â”‚   â”‚   â”‚   â””â”€â”€ events/
â”‚   â”‚   â”‚       â”œâ”€â”€ event-emitter.service.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ event-listener.service.ts
â”‚   â”‚   â”‚       â””â”€â”€ event-types.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ shared/
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ rabbitmq.service.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ redis.service.ts
â”‚   â”‚   â”‚   â””â”€â”€ webhook.service.ts
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...

frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ Automations/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ WorkflowBuilder.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TriggerManager.tsx
â”‚   â”‚   â”‚   â””â”€â”€ WorkflowLibrary.tsx
â”‚   â”‚   â”œâ”€â”€ Integrations/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ IntegrationCard.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ConnectionStatus.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Automation/
â”‚   â”‚   â”‚   â”œâ”€â”€ WorkflowNode.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TriggerCondition.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ActionCard.tsx
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ ...
            </div>

            <h3>10.8 VariÃ¡veis de Ambiente</h3>
            
            <div class="code-block">
<span class="comment"># .env</span>

<span class="comment"># n8n</span>
N8N_URL=https://n8n.nexusatemporal.com.br
N8N_USER=admin
N8N_PASSWORD=sua_senha_forte
N8N_ENCRYPTION_KEY=gerar_chave_aleatoria

<span class="comment"># Typebot</span>
TYPEBOT_BUILDER_URL=https://typebot.nexusatemporal.com.br
TYPEBOT_VIEWER_URL=https://bot.nexusatemporal.com.br
TYPEBOT_DATABASE_URL=postgresql://user:pass@postgres/typebot
TYPEBOT_ENCRYPTION_SECRET=gerar_chave_aleatoria

<span class="comment"># Waha (WhatsApp)</span>
WAHA_URL=http://waha:3000
WAHA_API_KEY=sua_api_key
WHATSAPP_HOOK_URL=https://api.nexusatemporal.com.br/api/whatsapp/webhook

<span class="comment"># OpenAI</span>
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4
OPENAI_MAX_TOKENS=2000

<span class="comment"># RabbitMQ</span>
RABBITMQ_URL=amqp://user:pass@rabbitmq:5672
RABBITMQ_EXCHANGE=nexus_events
RABBITMQ_QUEUE=automation_queue

<span class="comment"># Chatwoot</span>
CHATWOOT_URL=https://chatwoot.nexusatemporal.com.br
CHATWOOT_API_KEY=sua_api_key
            </div>

            <h3>10.9 Testes</h3>
            
            <div class="code-block">
<span class="comment">// backend/tests/integration/automation.test.ts</span>

<span class="keyword">describe</span>(<span class="string">'Sistema de AutomaÃ§Ã£o'</span>, () => {
  <span class="keyword">test</span>(<span class="string">'Deve disparar workflow quando lead Ã© criado'</span>, <span class="keyword">async</span> () => {
    <span class="comment">// Criar lead</span>
    <span class="keyword">const</span> lead = <span class="keyword">await</span> createLead({
      name: <span class="string">'Teste'</span>,
      phone: <span class="string">'+5511999999999'</span>
    });

    <span class="comment">// Aguardar processamento</span>
    <span class="keyword">await</span> sleep(2000);

    <span class="comment">// Verificar se evento foi publicado</span>
    <span class="keyword">const</span> events = <span class="keyword">await</span> getPublishedEvents();
    expect(events).toContainEqual(
      expect.objectContaining({
        event: <span class="string">'lead.created'</span>,
        data: expect.objectContaining({ leadId: lead.id })
      })
    );

    <span class="comment">// Verificar se trigger foi executado</span>
    <span class="keyword">const</span> executions = <span class="keyword">await</span> getTriggerExecutions();
    expect(executions.length).toBeGreaterThan(0);
  });

  <span class="keyword">test</span>(<span class="string">'Deve enviar lembrete de consulta'</span>, <span class="keyword">async</span> () => {
    <span class="comment">// Criar agendamento para amanhÃ£</span>
    <span class="keyword">const</span> tomorrow = addDays(<span class="keyword">new</span> Date(), 1);
    <span class="keyword">const</span> appointment = <span class="keyword">await</span> createAppointment({
      date: tomorrow,
      clientPhone: <span class="string">'+5511999999999'</span>
    });

    <span class="comment">// Simular cron job de lembretes</span>
    <span class="keyword">await</span> ReminderService.sendReminders();

    <span class="comment">// Verificar se WhatsApp foi enviado</span>
    <span class="keyword">const</span> messages = <span class="keyword">await</span> getWhatsAppMessages();
    expect(messages).toContainEqual(
      expect.objectContaining({
        to: appointment.clientPhone,
        text: expect.stringContaining(<span class="string">'Lembrando'</span>)
      })
    );
  });

  <span class="keyword">test</span>(<span class="string">'Deve qualificar lead com IA'</span>, <span class="keyword">async</span> () => {
    <span class="keyword">const</span> leadData = {
      name: <span class="string">'JoÃ£o Silva'</span>,
      age: 35,
      procedure: <span class="string">'Botox'</span>,
      budget: 2000,
      urgency: <span class="string">'high'</span>
    };

    <span class="keyword">const</span> result = <span class="keyword">await</span> AIService.analyzeLead(leadData);

    expect(result).toHaveProperty(<span class="string">'score'</span>);
    expect(result.score).toBeGreaterThan(0);
    expect(result.score).toBeLessThanOrEqual(100);
    expect(result).toHaveProperty(<span class="string">'suggestedActions'</span>);
    expect(Array.isArray(result.suggestedActions)).toBe(<span class="keyword">true</span>);
  });
});
            </div>

            <h3>10.10 Monitoramento e Logs</h3>
            
            <div class="code-block">
<span class="comment">// backend/src/shared/services/monitoring.service.ts</span>

<span class="keyword">export class</span> MonitoringService {
  <span class="keyword">static async</span> logWorkflowExecution(data: {
    workflowId: string;
    status: <span class="string">'success'</span> | <span class="string">'error'</span>;
    duration: number;
    input: any;
    output: any;
    error?: string;
  }) {
    <span class="keyword">await</span> db.workflowLogs.create({
      ...data,
      timestamp: <span class="keyword">new</span> Date()
    });

    <span class="comment">// Se erro, notificar admin</span>
    <span class="keyword">if</span> (data.status === <span class="string">'error'</span>) {
      <span class="keyword">await</span> NotificationService.notifyAdmins({
        type: <span class="string">'workflow_error'</span>,
        message: `Workflow ${data.workflowId} falhou`,
        error: data.error
      });
    }
  }

  <span class="keyword">static async</span> getWorkflowStats(workflowId: string) {
    <span class="keyword">const</span> logs = <span class="keyword">await</span> db.workflowLogs.find({
      workflowId,
      timestamp: { $gte: subDays(<span class="keyword">new</span> Date(), 30) }
    });

    <span class="keyword">return</span> {
      totalExecutions: logs.length,
      successRate: logs.filter(l => l.status === <span class="string">'success'</span>).length / logs.length,
      avgDuration: _.meanBy(logs, <span class="string">'duration'</span>),
      errorRate: logs.filter(l => l.status === <span class="string">'error'</span>).length / logs.length,
      lastExecution: _.maxBy(logs, <span class="string">'timestamp'</span>)
    };
  }
}
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“Š 11. Dashboard de AutomaÃ§Ãµes</h2>
            
            <h3>11.1 MÃ©tricas Principais</h3>
            
            <table>
                <thead>
                    <tr>
                        <th>MÃ©trica</th>
                        <th>DescriÃ§Ã£o</th>
                        <th>Meta</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Taxa de ExecuÃ§Ã£o</strong></td>
                        <td>% de workflows executados com sucesso</td>
                        <td>> 95%</td>
                    </tr>
                    <tr>
                        <td><strong>Tempo MÃ©dio</strong></td>
                        <td>Tempo mÃ©dio de execuÃ§Ã£o de workflows</td>
                        <td>< 5s</td>
                    </tr>
                    <tr>
                        <td><strong>Eventos/Dia</strong></td>
                        <td>Quantidade de eventos processados</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><strong>Taxa de ConversÃ£o</strong></td>
                        <td>Leads qualificados pelo bot que viram clientes</td>
                        <td>> 30%</td>
                    </tr>
                    <tr>
                        <td><strong>ReduÃ§Ã£o de No-Show</strong></td>
                        <td>% de reduÃ§Ã£o apÃ³s lembretes automÃ¡ticos</td>
                        <td>> 40%</td>
                    </tr>
                    <tr>
                        <td><strong>Tempo Economizado</strong></td>
                        <td>Horas economizadas por automaÃ§Ãµes</td>
                        <td>> 4h/dia</td>
                    </tr>
                    <tr>
                        <td><strong>ROI de AutomaÃ§Ã£o</strong></td>
                        <td>Retorno sobre investimento em automaÃ§Ãµes</td>
                        <td>> 300%</td>
                    </tr>
                </tbody>
            </table>

            <h3>11.2 Interface do Dashboard</h3>
            
            <div class="code-block">
<span class="comment">// frontend/src/pages/Automations/Dashboard.tsx</span>

<span class="keyword">import</span> { useQuery } <span class="keyword">from</span> <span class="string">'@tanstack/react-query'</span>;

<span class="keyword">export const</span> AutomationDashboard = () => {
  <span class="keyword">const</span> { data: stats } = useQuery({
    queryKey: [<span class="string">'automation-stats'</span>],
    queryFn: getAutomationStats
  });

  <span class="keyword">return</span> (
    <span class="keyword">&lt;div</span> className=<span class="string">"p-6"</span><span class="keyword">&gt;</span>
      <span class="keyword">&lt;h1</span> className=<span class="string">"text-2xl font-bold mb-6"</span><span class="keyword">&gt;</span>
        Dashboard de AutomaÃ§Ãµes
      <span class="keyword">&lt;/h1&gt;</span>

      <span class="keyword">&lt;div</span> className=<span class="string">"grid grid-cols-4 gap-4 mb-6"</span><span class="keyword">&gt;</span>
        <span class="keyword">&lt;StatCard</span>
          title=<span class="string">"Workflows Ativos"</span>
          value={stats.activeWorkflows}
          icon=<span class="string">"ğŸ”„"</span>
        <span class="keyword">/&gt;</span>
        
        <span class="keyword">&lt;StatCard</span>
          title=<span class="string">"Taxa de Sucesso"</span>
          value={`${stats.successRate}%`}
          icon=<span class="string">"âœ…"</span>
          trend={stats.successRateTrend}
        <span class="keyword">/&gt;</span>
        
        <span class="keyword">&lt;StatCard</span>
          title=<span class="string">"Eventos Hoje"</span>
          value={stats.eventsToday}
          icon=<span class="string">"ğŸ“¡"</span>
        <span class="keyword">/&gt;</span>
        
        <span class="keyword">&lt;StatCard</span>
          title=<span class="string">"Tempo Economizado"</span>
          value={`${stats.timeSaved}h`}
          icon=<span class="string">"â±ï¸"</span>
        <span class="keyword">/&gt;</span>
      <span class="keyword">&lt;/div&gt;</span>

      <span class="keyword">&lt;div</span> className=<span class="string">"grid grid-cols-2 gap-6"</span><span class="keyword">&gt;</span>
        <span class="keyword">&lt;ExecutionChart</span> data={stats.executions} <span class="keyword">/&gt;</span>
        <span class="keyword">&lt;EventsChart</span> data={stats.events} <span class="keyword">/&gt;</span>
      <span class="keyword">&lt;/div&gt;</span>

      <span class="keyword">&lt;RecentExecutions</span> logs={stats.recentLogs} <span class="keyword">/&gt;</span>
    <span class="keyword">&lt;/div&gt;</span>
  );
};
            </div>
        </div>

        <div class="section">
            <h2>âš ï¸ 12. Boas PrÃ¡ticas e Troubleshooting</h2>
            
            <h3>12.1 Boas PrÃ¡ticas</h3>
            
            <div class="highlight-box">
                <h4>âœ… Desenvolvimento</h4>
                <ul>
                    <li><strong>IdempotÃªncia:</strong> Workflows devem poder ser executados mÃºltiplas vezes sem efeitos colaterais</li>
                    <li><strong>Retry Logic:</strong> Implementar tentativas automÃ¡ticas com backoff exponencial</li>
                    <li><strong>Timeouts:</strong> Definir timeouts para evitar execuÃ§Ãµes infinitas</li>
                    <li><strong>Logs Detalhados:</strong> Registrar cada etapa de execuÃ§Ã£o</li>
                    <li><strong>ValidaÃ§Ã£o de Dados:</strong> Sempre validar dados antes de processar</li>
                </ul>
            </div>

            <div class="highlight-box">
                <h4>âœ… SeguranÃ§a</h4>
                <ul>
                    <li><strong>AutenticaÃ§Ã£o:</strong> Sempre validar origem dos webhooks</li>
                    <li><strong>Rate Limiting:</strong> Limitar requisiÃ§Ãµes por IP/tenant</li>
                    <li><strong>SanitizaÃ§Ã£o:</strong> Limpar inputs antes de processar</li>
                    <li><strong>Secrets:</strong> Usar variÃ¡veis de ambiente para credenciais</li>
                    <li><strong>HTTPS Only:</strong> Todas comunicaÃ§Ãµes via HTTPS</li>
                </ul>
            </div>

            <div class="highlight-box">
                <h4>âœ… Performance</h4>
                <ul>
                    <li><strong>Processamento AssÃ­ncrono:</strong> Use RabbitMQ para tarefas pesadas</li>
                    <li><strong>Cache:</strong> Redis para dados frequentes</li>
                    <li><strong>Batch Processing:</strong> Agrupar operaÃ§Ãµes similares</li>
                    <li><strong>Connection Pooling:</strong> Reutilizar conexÃµes</li>
                    <li><strong>Monitoramento:</strong> Alertas para degradaÃ§Ã£o de performance</li>
                </ul>
            </div>

            <h3>12.2 Problemas Comuns</h3>
            
            <div class="warning-box">
                <h4>ğŸ”´ Webhook nÃ£o estÃ¡ sendo recebido</h4>
                <ul>
                    <li>Verificar se URL estÃ¡ acessÃ­vel publicamente</li>
                    <li>Confirmar certificado SSL vÃ¡lido</li>
                    <li>Checar logs do serviÃ§o externo (n8n, Typebot)</li>
                    <li>Validar se rota estÃ¡ registrada corretamente</li>
                    <li>Testar com curl/Postman manualmente</li>
                </ul>
            </div>

            <div class="warning-box">
                <h4>ğŸ”´ Workflow nÃ£o estÃ¡ sendo disparado</h4>
                <ul>
                    <li>Verificar se trigger estÃ¡ ativo</li>
                    <li>Confirmar se condiÃ§Ãµes estÃ£o corretas</li>
                    <li>Checar se evento estÃ¡ sendo publicado no RabbitMQ</li>
                    <li>Ver logs de execuÃ§Ã£o do EventEmitter</li>
                    <li>Validar permissÃµes do tenant</li>
                </ul>
            </div>

            <div class="warning-box">
                <h4>ğŸ”´ Mensagens WhatsApp nÃ£o estÃ£o sendo enviadas</h4>
                <ul>
                    <li>Verificar se Waha estÃ¡ conectado</li>
                    <li>Confirmar se nÃºmero estÃ¡ em formato correto (+55...)</li>
                    <li>Checar se sessÃ£o nÃ£o expirou</li>
                    <li>Ver logs do Waha</li>
                    <li>Validar rate limit do WhatsApp (nÃ£o spam)</li>
                </ul>
            </div>

            <div class="warning-box">
                <h4>ğŸ”´ OpenAI retornando erros</h4>
                <ul>
                    <li>Verificar saldo/crÃ©ditos da conta</li>
                    <li>Confirmar API key vÃ¡lida</li>
                    <li>Checar rate limits</li>
                    <li>Validar formato do prompt</li>
                    <li>Reduzir max_tokens se necessÃ¡rio</li>
                </ul>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ’° 13. PrecificaÃ§Ã£o de AutomaÃ§Ãµes por Plano</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>Recurso</th>
                        <th>Essencial</th>
                        <th>Profissional</th>
                        <th>Empresarial</th>
                        <th>Enterprise</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>n8n Workflows</strong></td>
                        <td>âŒ</td>
                        <td>5 ativos</td>
                        <td>Ilimitados</td>
                        <td>Ilimitados</td>
                    </tr>
                    <tr>
                        <td><strong>Typebot Fluxos</strong></td>
                        <td>âŒ</td>
                        <td>1 fluxo</td>
                        <td>Ilimitados</td>
                        <td>Ilimitados</td>
                    </tr>
                    <tr>
                        <td><strong>WhatsApp</strong></td>
                        <td>âŒ</td>
                        <td>1 nÃºmero</td>
                        <td>3 nÃºmeros</td>
                        <td>Ilimitado</td>
                    </tr>
                    <tr>
                        <td><strong>IA/OpenAI</strong></td>
                        <td>âŒ</td>
                        <td>BÃ¡sica</td>
                        <td>AvanÃ§ada</td>
                        <td>Ilimitada</td>
                    </tr>
                    <tr>
                        <td><strong>Triggers</strong></td>
                        <td>âŒ</td>
                        <td>10 triggers</td>
                        <td>50 triggers</td>
                        <td>Ilimitado</td>
                    </tr>
                    <tr>
                        <td><strong>Eventos/MÃªs</strong></td>
                        <td>âŒ</td>
                        <td>10.000</td>
                        <td>100.000</td>
                        <td>Ilimitado</td>
                    </tr>
                    <tr>
                        <td><strong>Workflows Prontos</strong></td>
                        <td>âŒ</td>
                        <td>5 templates</td>
                        <td>20 templates</td>
                        <td>Todos + Custom</td>
                    </tr>
                    <tr>
                        <td><strong>IntegraÃ§Ãµes</strong></td>
                        <td>âŒ</td>
                        <td>5 integraÃ§Ãµes</td>
                        <td>15 integraÃ§Ãµes</td>
                        <td>Ilimitadas</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="section" id="notificame">
            <h2>ğŸ“± 14. IntegraÃ§Ã£o Notifica.me</h2>
            
            <div class="integration-card">
                <div class="card-header">
                    <div class="card-icon">ğŸ“±</div>
                    <div class="card-title">Notifica.me - Multi-Canal</div>
                </div>
                <div class="card-subtitle">Instagram Direct, Facebook Messenger, WebChat e Email em uma Ãºnica plataforma</div>
                
                <h4>14.1 VisÃ£o Geral</h4>
                <p>O Notifica.me Ã© uma plataforma que centraliza mÃºltiplos canais de atendimento. Diferente do WhatsApp (Waha), o Notifica.me foca em Instagram Direct e Facebook Messenger, alÃ©m de WebChat e Email.</p>

                <div class="highlight-box">
                    <h4>ğŸ¯ EstratÃ©gia de IntegraÃ§Ã£o</h4>
                    <p><strong>White Label Completo:</strong> O usuÃ¡rio conecta Instagram/Facebook diretamente pelo Nexus Atemporal, sem perceber que estÃ¡ usando Notifica.me nos bastidores.</p>
                    <ul>
                        <li>âœ… Interface 100% customizada no Nexus</li>
                        <li>âœ… UsuÃ¡rio nunca acessa painel Notifica.me</li>
                        <li>âœ… Credenciais armazenadas criptografadas</li>
                        <li>âœ… Webhooks bidirecionais</li>
                    </ul>
                </div>

                <h4>14.2 Arquitetura</h4>
                <div class="architecture-diagram">
<pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NEXUS ATEMPORAL (Frontend)            â”‚
â”‚   "Conectar Instagram/Facebook"         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ API Calls
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   NEXUS BACKEND (Camada de AbstraÃ§Ã£o)   â”‚
â”‚   - Armazena API Key Notifica.me        â”‚
â”‚   - Proxy para API                       â”‚
â”‚   - Webhooks                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ HTTPS
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API NOTIFICA.ME (Externa)              â”‚
â”‚   - Instagram Direct                     â”‚
â”‚   - Facebook Messenger                   â”‚
â”‚   - WebChat                              â”‚
â”‚   - Email                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre>
                </div>

                <h4>14.3 Estrutura de Banco de Dados</h4>
                <div class="code-block">
<span class="comment">-- Conta Notifica.me do tenant</span>
<span class="keyword">CREATE TABLE</span> notificame_accounts (
  id UUID <span class="keyword">PRIMARY KEY</span>,
  tenant_id UUID <span class="keyword">REFERENCES</span> tenants(id),
  api_key VARCHAR(255) <span class="keyword">NOT NULL</span> <span class="comment">-- Criptografado</span>,
  account_id VARCHAR(255) <span class="keyword">NOT NULL</span>,
  status VARCHAR(50) <span class="keyword">DEFAULT</span> <span class="string">'active'</span>,
  plan VARCHAR(50),
  created_at TIMESTAMP <span class="keyword">DEFAULT NOW</span>(),
  <span class="keyword">UNIQUE</span>(tenant_id)
);

<span class="comment">-- Canais conectados (Instagram, Facebook, etc)</span>
<span class="keyword">CREATE TABLE</span> notificame_channels (
  id UUID <span class="keyword">PRIMARY KEY</span>,
  tenant_id UUID <span class="keyword">REFERENCES</span> tenants(id),
  notificame_account_id UUID <span class="keyword">REFERENCES</span> notificame_accounts(id),
  channel_type VARCHAR(50) <span class="keyword">NOT NULL</span>, <span class="comment">-- 'instagram', 'facebook', 'webchat', 'email'</span>
  channel_id VARCHAR(255) <span class="keyword">NOT NULL</span>,
  channel_name VARCHAR(255),
  is_active BOOLEAN <span class="keyword">DEFAULT</span> <span class="keyword">true</span>,
  config JSONB,
  connected_at TIMESTAMP <span class="keyword">DEFAULT NOW</span>(),
  <span class="keyword">UNIQUE</span>(tenant_id, channel_type, channel_id)
);

<span class="comment">-- Log de mensagens</span>
<span class="keyword">CREATE TABLE</span> notificame_messages (
  id UUID <span class="keyword">PRIMARY KEY</span>,
  tenant_id UUID <span class="keyword">REFERENCES</span> tenants(id),
  channel_id UUID <span class="keyword">REFERENCES</span> notificame_channels(id),
  message_id VARCHAR(255),
  direction VARCHAR(20), <span class="comment">-- 'inbound' ou 'outbound'</span>
  from_user VARCHAR(255),
  to_user VARCHAR(255),
  content TEXT,
  media_url TEXT,
  status VARCHAR(50),
  sent_at TIMESTAMP,
  delivered_at TIMESTAMP,
  read_at TIMESTAMP,
  created_at TIMESTAMP <span class="keyword">DEFAULT NOW</span>()
);
                </div>

                <h4>14.4 APIs do Backend</h4>
                
                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/notificame/connect
<span class="comment">// Conecta conta Notifica.me (API Key de revendedor)</span>
{
  "apiKey": "sua_chave_api_revendedor"
}

<span class="comment">Response:</span>
{
  "success": true,
  "account": {
    "id": "uuid",
    "accountId": "notificame_id",
    "plan": "premium"
  }
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/notificame/channels/instagram/connect
<span class="comment">// Inicia conexÃ£o do Instagram (retorna URL OAuth)</span>

<span class="comment">Response:</span>
{
  "authorizationUrl": "https://instagram.com/oauth/authorize?..."
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/notificame/channels/instagram/callback
<span class="comment">// Callback apÃ³s autorizaÃ§Ã£o OAuth</span>
{
  "code": "oauth_code_from_instagram"
}

<span class="comment">Response:</span>
{
  "success": true,
  "channel": {
    "id": "uuid",
    "type": "instagram",
    "username": "@sua_clinica",
    "connected": true
  }
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/notificame/channels/facebook/connect
<span class="comment">// Conecta pÃ¡gina do Facebook</span>
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/notificame/channels/webchat/create
<span class="comment">// Cria widget de WebChat</span>
{
  "name": "Chat Site ClÃ­nica",
  "website": "https://minhaclinia.com.br",
  "color": "#8b5cf6",
  "welcomeMessage": "OlÃ¡! Como posso ajudar?"
}

<span class="comment">Response:</span>
{
  "webchatId": "uuid",
  "embedCode": "&lt;script src='...'&gt;&lt;/script&gt;"
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/notificame/messages/send
<span class="comment">// Envia mensagem por qualquer canal</span>
{
  "channelId": "uuid",
  "recipientId": "instagram_user_id",
  "message": "OlÃ¡! Confirmamos seu agendamento.",
  "mediaUrl": "https://..." <span class="comment">// Opcional</span>
}
                </div>

                <div class="api-endpoint">
<span class="method-post api-method">POST</span> /api/notificame/webhook
<span class="comment">// Recebe mensagens do Notifica.me (webhook)</span>
{
  "event": "message.received",
  "data": {
    "message_id": "msg_123",
    "channel_id": "ig_account_123",
    "channel_type": "instagram",
    "from": "user_instagram_id",
    "message": "Quero agendar uma consulta",
    "timestamp": "2025-10-17T10:30:00Z"
  }
}
                </div>

                <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/notificame/channels
<span class="comment">// Lista canais conectados do tenant</span>

<span class="comment">Response:</span>
{
  "channels": [
    {
      "id": "uuid",
      "type": "instagram",
      "name": "@clinica_estetica",
      "connected": true,
      "lastSync": "2025-10-17T10:00:00Z"
    },
    {
      "id": "uuid",
      "type": "facebook",
      "name": "ClÃ­nica EstÃ©tica PÃ¡gina",
      "connected": true
    }
  ]
}
                </div>

                <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/notificame/messages
<span class="comment">// Lista mensagens (inbox unificado)</span>
?channelId=uuid&limit=50&offset=0
                </div>

                <div class="api-endpoint">
<span class="method-get api-method">GET</span> /api/notificame/stats
<span class="comment">// EstatÃ­sticas de mensagens</span>
?dateFrom=2025-10-01&dateTo=2025-10-17

<span class="comment">Response:</span>
{
  "totalMessages": 1523,
  "byChannel": {
    "instagram": 892,
    "facebook": 631
  },
  "responseRate": 0.95,
  "avgResponseTime": "2m 30s"
}
                </div>

                <h4>14.5 Service Layer Completo</h4>
                <div class="code-block">
<span class="comment">// backend/src/modules/integrations/notificame/notificame.service.ts</span>

<span class="keyword">import</span> axios, { AxiosInstance } <span class="keyword">from</span> <span class="string">'axios'</span>;

<span class="keyword">export class</span> NotificameService {
  <span class="keyword">private</span> client: AxiosInstance;
  <span class="keyword">private</span> baseURL = <span class="string">'https://api.notificame.com.br'</span>;

  <span class="keyword">constructor</span>(<span class="keyword">private</span> apiKey: string) {
    <span class="keyword">this</span>.client = axios.create({
      baseURL: <span class="keyword">this</span>.baseURL,
      headers: {
        <span class="string">'Authorization'</span>: `Bearer ${apiKey}`,
        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span>,
      },
      timeout: 30000,
    });
  }

  <span class="comment">// Valida credenciais</span>
  <span class="keyword">async</span> validateCredentials(): Promise&lt;boolean&gt; {
    <span class="keyword">try</span> {
      <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">this</span>.client.get(<span class="string">'/v1/account/validate'</span>);
      <span class="keyword">return</span> response.status === 200;
    } <span class="keyword">catch</span> (error) {
      <span class="keyword">return false</span>;
    }
  }

  <span class="comment">// Instagram: Conectar</span>
  <span class="keyword">async</span> connectInstagram(callbackUrl: string): Promise&lt;string&gt; {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">this</span>.client.post(<span class="string">'/v1/channels/instagram/connect'</span>, {
      callback_url: callbackUrl,
      scopes: [<span class="string">'instagram_direct'</span>, <span class="string">'instagram_business_messaging'</span>],
    });
    <span class="keyword">return</span> response.data.authorization_url;
  }

  <span class="comment">// Instagram: Enviar mensagem</span>
  <span class="keyword">async</span> sendInstagramMessage(data: {
    accountId: string;
    recipientId: string;
    message: string;
    mediaUrl?: string;
  }) {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">this</span>.client.post(<span class="string">'/v1/messages/instagram/send'</span>, {
      account_id: data.accountId,
      recipient_id: data.recipientId,
      message: data.message,
      media_url: data.mediaUrl,
    });
    <span class="keyword">return</span> response.data;
  }

  <span class="comment">// Facebook: Conectar</span>
  <span class="keyword">async</span> connectFacebook(callbackUrl: string): Promise&lt;string&gt; {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">this</span>.client.post(<span class="string">'/v1/channels/facebook/connect'</span>, {
      callback_url: callbackUrl,
      scopes: [<span class="string">'pages_messaging'</span>, <span class="string">'pages_manage_metadata'</span>],
    });
    <span class="keyword">return</span> response.data.authorization_url;
  }

  <span class="comment">// WebChat: Criar widget</span>
  <span class="keyword">async</span> createWebchat(data: {
    name: string;
    website: string;
    color?: string;
    welcomeMessage?: string;
  }) {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">this</span>.client.post(<span class="string">'/v1/channels/webchat/create'</span>, {
      name: data.name,
      website: data.website,
      theme: { primary_color: data.color || <span class="string">'#8b5cf6'</span> },
      welcome_message: data.welcomeMessage,
    });
    <span class="keyword">return</span> response.data;
  }

  <span class="comment">// Configurar Webhook</span>
  <span class="keyword">async</span> setWebhook(webhookUrl: string, events: string[]) {
    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="keyword">this</span>.client.post(<span class="string">'/v1/webhooks/configure'</span>, {
      url: webhookUrl,
      events, <span class="comment">// ['message.received', 'message.delivered']</span>
      secret: process.env.NOTIFICAME_WEBHOOK_SECRET,
    });
    <span class="keyword">return</span> response.data;
  }

  <span class="comment">// Validar assinatura do webhook</span>
  validateWebhookSignature(payload: string, signature: string): boolean {
    <span class="keyword">const</span> crypto = require(<span class="string">'crypto'</span>);
    <span class="keyword">const</span> secret = process.env.NOTIFICAME_WEBHOOK_SECRET;
    <span class="keyword">const</span> hash = crypto
      .createHmac(<span class="string">'sha256'</span>, secret)
      .update(payload)
      .digest(<span class="string">'hex'</span>);
    <span class="keyword">return</span> hash === signature;
  }
}
                </div>

                <h4>14.6 Frontend - PÃ¡gina de IntegraÃ§Ã£o</h4>
                <div class="code-block">
<span class="comment">// frontend/src/pages/Integrations/NotificameSetup.tsx</span>

<span class="keyword">import</span> { useState } <span class="keyword">from</span> <span class="string">'react'</span>;
<span class="keyword">import</span> { useMutation, useQuery } <span class="keyword">from</span> <span class="string">'@tanstack/react-query'</span>;

<span class="keyword">export const</span> NotificameSetup = () => {
  <span class="keyword">const</span> [apiKey, setApiKey] = useState(<span class="string">''</span>);
  <span class="keyword">const</span> [step, setStep] = useState(<span class="string">'connect'</span>); <span class="comment">// connect | channels</span>

  <span class="comment">// Conectar conta Notifica.me</span>
  <span class="keyword">const</span> connectMutation = useMutation({
    mutationFn: <span class="keyword">async</span> (apiKey: string) => {
      <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">'/api/notificame/connect'</span>, {
        method: <span class="string">'POST'</span>,
        headers: { <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span> },
        body: JSON.stringify({ apiKey }),
      });
      <span class="keyword">return</span> res.json();
    },
    onSuccess: () => {
      setStep(<span class="string">'channels'</span>);
    },
  });

  <span class="comment">// Listar canais conectados</span>
  <span class="keyword">const</span> { data: channels } = useQuery({
    queryKey: [<span class="string">'notificame-channels'</span>],
    queryFn: <span class="keyword">async</span> () => {
      <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">'/api/notificame/channels'</span>);
      <span class="keyword">return</span> res.json();
    },
    enabled: step === <span class="string">'channels'</span>,
  });

  <span class="comment">// Conectar Instagram</span>
  <span class="keyword">const</span> connectInstagram = <span class="keyword">async</span> () => {
    <span class="keyword">const</span> res = <span class="keyword">await</span> fetch(<span class="string">'/api/notificame/channels/instagram/connect'</span>, {
      method: <span class="string">'POST'</span>,
    });
    <span class="keyword">const</span> { authorizationUrl } = <span class="keyword">await</span> res.json();
    
    <span class="comment">// Abrir popup OAuth</span>
    window.open(authorizationUrl, <span class="string">'_blank'</span>, <span class="string">'width=600,height=700'</span>);
  };

  <span class="keyword">if</span> (step === <span class="string">'connect'</span>) {
    <span class="keyword">return</span> (
      <span class="keyword">&lt;div</span> className=<span class="string">"max-w-2xl mx-auto p-6"</span><span class="keyword">&gt;</span>
        <span class="keyword">&lt;h1</span> className=<span class="string">"text-2xl font-bold mb-4"</span><span class="keyword">&gt;</span>
          Conectar Notifica.me
        <span class="keyword">&lt;/h1&gt;</span>
        
        <span class="keyword">&lt;p</span> className=<span class="string">"mb-6 text-gray-600"</span><span class="keyword">&gt;</span>
          Cole sua chave API de revendedor do Notifica.me
        <span class="keyword">&lt;/p&gt;</span>

        <span class="keyword">&lt;input</span>
          type=<span class="string">"password"</span>
          value={apiKey}
          onChange={(e) => setApiKey(e.target.value)}
          placeholder=<span class="string">"API Key"</span>
          className=<span class="string">"w-full p-3 border rounded mb-4"</span>
        <span class="keyword">/&gt;</span>

        <span class="keyword">&lt;button</span>
          onClick={() => connectMutation.mutate(apiKey)}
          disabled={!apiKey || connectMutation.isPending}
          className=<span class="string">"bg-purple-600 text-white px-6 py-3 rounded"</span>
        <span class="keyword">&gt;</span>
          {connectMutation.isPending ? <span class="string">'Conectando...'</span> : <span class="string">'Conectar'</span>}
        <span class="keyword">&lt;/button&gt;</span>
      <span class="keyword">&lt;/div&gt;</span>
    );
  }

  <span class="keyword">return</span> (
    <span class="keyword">&lt;div</span> className=<span class="string">"max-w-4xl mx-auto p-6"</span><span class="keyword">&gt;</span>
      <span class="keyword">&lt;h1</span> className=<span class="string">"text-2xl font-bold mb-6"</span><span class="keyword">&gt;</span>
        Conectar Canais
      <span class="keyword">&lt;/h1&gt;</span>

      <span class="keyword">&lt;div</span> className=<span class="string">"grid grid-cols-2 gap-6"</span><span class="keyword">&gt;</span>
        <span class="comment">{/* Instagram */}</span>
        <span class="keyword">&lt;div</span> className=<span class="string">"border rounded-lg p-6"</span><span class="keyword">&gt;</span>
          <span class="keyword">&lt;div</span> className=<span class="string">"text-4xl mb-3"</span><span class="keyword">&gt;</span>ğŸ“·<span class="keyword">&lt;/div&gt;</span>
          <span class="keyword">&lt;h3</span> className=<span class="string">"text-xl font-bold mb-2"</span><span class="keyword">&gt;</span>Instagram<span class="keyword">&lt;/h3&gt;</span>
          <span class="keyword">&lt;p</span> className=<span class="string">"text-gray-600 mb-4"</span><span class="keyword">&gt;</span>
            Atenda clientes pelo Direct
          <span class="keyword">&lt;/p&gt;</span>
          
          {channels?.channels.some(c => c.type === <span class="string">'instagram'</span>) ? (
            <span class="keyword">&lt;div</span> className=<span class="string">"text-green-600"</span><span class="keyword">&gt;</span>
              âœ“ Conectado: {channels.channels.find(c => c.type === <span class="string">'instagram'</span>).name}
            <span class="keyword">&lt;/div&gt;</span>
          ) : (
            <span class="keyword">&lt;button</span>
              onClick={connectInstagram}
              className=<span class="string">"bg-purple-600 text-white px-4 py-2 rounded"</span>
            <span class="keyword">&gt;</span>
              Conectar Instagram
            <span class="keyword">&lt;/button&gt;</span>
          )}
        <span class="keyword">&lt;/div&gt;</span>

        <span class="comment">{/* Facebook */}</span>
        <span class="keyword">&lt;div</span> className=<span class="string">"border rounded-lg p-6"</span><span class="keyword">&gt;</span>
          <span class="keyword">&lt;div</span> className=<span class="string">"text-4xl mb-3"</span><span class="keyword">&gt;</span>ğŸ‘¥<span class="keyword">&lt;/div&gt;</span>
          <span class="keyword">&lt;h3</span> className=<span class="string">"text-xl font-bold mb-2"</span><span class="keyword">&gt;</span>Facebook<span class="keyword">&lt;/h3&gt;</span>
          <span class="keyword">&lt;p</span> className=<span class="string">"text-gray-600 mb-4"</span><span class="keyword">&gt;</span>
            Atenda via Messenger
          <span class="keyword">&lt;/p&gt;</span>
          <span class="keyword">&lt;button</span> className=<span class="string">"bg-blue-600 text-white px-4 py-2 rounded"</span><span class="keyword">&gt;</span>
            Conectar Facebook
          <span class="keyword">&lt;/button&gt;</span>
        <span class="keyword">&lt;/div&gt;</span>

        <span class="comment">{/* WebChat */}</span>
        <span class="keyword">&lt;div</span> className=<span class="string">"border rounded-lg p-6"</span><span class="keyword">&gt;</span>
          <span class="keyword">&lt;div</span> className=<span class="string">"text-4xl mb-3"</span><span class="keyword">&gt;</span>ğŸ’¬<span class="keyword">&lt;/div&gt;</span>
          <span class="keyword">&lt;h3</span> className=<span class="string">"text-xl font-bold mb-2"</span><span class="keyword">&gt;</span>WebChat<span class="keyword">&lt;/h3&gt;</span>
          <span class="keyword">&lt;p</span> className=<span class="string">"text-gray-600 mb-4"</span><span class="keyword">&gt;</span>
            Chat no seu site
          <span class="keyword">&lt;/p&gt;</span>
          <span class="keyword">&lt;button</span> className=<span class="string">"bg-purple-600 text-white px-4 py-2 rounded"</span><span class="keyword">&gt;</span>
            Criar WebChat
          <span class="keyword">&lt;/button&gt;</span>
        <span class="keyword">&lt;/div&gt;</span>

        <span class="comment">{/* Email */}</span>
        <span class="keyword">&lt;div</span> className=<span class="string">"border rounded-lg p-6"</span><span class="keyword">&gt;</span>
          <span class="keyword">&lt;div</span> className=<span class="string">"text-4xl mb-3"</span><span class="keyword">&gt;</span>ğŸ“§<span class="keyword">&lt;/div&gt;</span>
          <span class="keyword">&lt;h3</span> className=<span class="string">"text-xl font-bold mb-2"</span><span class="keyword">&gt;</span>Email<span class="keyword">&lt;/h3&gt;</span>
          <span class="keyword">&lt;p</span> className=<span class="string">"text-gray-600 mb-4"</span><span class="keyword">&gt;</span>
            Integrar Gmail/Outlook
          <span class="keyword">&lt;/p&gt;</span>
          <span class="keyword">&lt;button</span> className=<span class="string">"bg-gray-600 text-white px-4 py-2 rounded"</span><span class="keyword">&gt;</span>
            Conectar Email
          <span class="keyword">&lt;/button&gt;</span>
        <span class="keyword">&lt;/div&gt;</span>
      <span class="keyword">&lt;/div&gt;</span>
    <span class="keyword">&lt;/div&gt;</span>
  );
};
                </div>

                <h4>14.7 Fluxo de IntegraÃ§Ã£o White Label</h4>
                <div class="workflow-box">
                    <h4>ğŸ“± Conectar Instagram (ExperiÃªncia do UsuÃ¡rio)</h4>
                    <ol class="workflow-steps">
                        <li>UsuÃ¡rio clica em "Conectar Instagram" no Nexus</li>
                        <li>Backend chama API Notifica.me para gerar URL OAuth</li>
                        <li>Popup abre com login do Instagram</li>
                        <li>Instagram redireciona com code para callback do Nexus</li>
                        <li>Backend finaliza conexÃ£o via Notifica.me</li>
                        <li>Canal salvo no banco como ativo</li>
                        <li>UsuÃ¡rio vÃª "Instagram Conectado âœ“" no Nexus</li>
                    </ol>
                    <p><strong>Importante:</strong> UsuÃ¡rio nunca vÃª interface do Notifica.me!</p>
                </div>

                <h4>14.8 Inbox Unificado</h4>
                <div class="highlight-box">
                    <h4>ğŸ’¬ Centralizar Mensagens no Nexus</h4>
                    <p>Todas as mensagens de Instagram, Facebook, WebChat e Email aparecem em um Ãºnico inbox no Nexus Atemporal:</p>
                    <ul>
                        <li>âœ… Conversas agrupadas por cliente</li>
                        <li>âœ… HistÃ³rico completo cross-channel</li>
                        <li>âœ… Atribuir conversas para atendentes</li>
                        <li>âœ… IntegraÃ§Ã£o com Typebot (bot responde primeiro)</li>
                        <li>âœ… Transferir para Chatwoot se necessÃ¡rio</li>
                    </ul>
                </div>

                <h4>14.9 IntegraÃ§Ã£o com AutomaÃ§Ãµes</h4>
                <div class="code-block">
<span class="comment">// Quando mensagem Ã© recebida via webhook</span>

<span class="keyword">async</span> handleIncomingMessage(data: any) {
  <span class="comment">// 1. Salvar mensagem no banco</span>
  <span class="keyword">const</span> message = <span class="keyword">await</span> db.notificameMessages.create({...});

  <span class="comment">// 2. Disparar evento no sistema</span>
  <span class="keyword">await</span> EventEmitterService.emit(<span class="string">'notificame.message.received'</span>, {
    tenantId,
    channelType: <span class="string">'instagram'</span>,
    from: data.from,
    message: data.message,
  });

  <span class="comment">// 3. Se bot ativo, passar para Typebot</span>
  <span class="keyword">if</span> (channel.config?.botEnabled) {
    <span class="keyword">const</span> botResponse = <span class="keyword">await</span> TypebotService.process(data.message);
    
    <span class="keyword">if</span> (botResponse.needsHuman) {
      <span class="comment">// Transferir para atendente humano</span>
      <span class="keyword">await</span> ChatwootService.transfer(data.from);
    } <span class="keyword">else</span> {
      <span class="comment">// Bot responde automaticamente</span>
      <span class="keyword">await</span> <span class="keyword">this</span>.sendMessage(botResponse.message);
    }
  }

  <span class="comment">// 4. Criar lead se novo contato</span>
  <span class="keyword">const</span> lead = <span class="keyword">await</span> LeadsService.findOrCreate(data.from);
  
  <span class="comment">// 5. IA analisa intenÃ§Ã£o</span>
  <span class="keyword">const</span> intent = <span class="keyword">await</span> AIService.detectIntent(data.message);
  
  <span class="keyword">if</span> (intent === <span class="string">'scheduling'</span>) {
    <span class="comment">// Disparar workflow de agendamento</span>
    <span class="keyword">await</span> N8nService.trigger(<span class="string">'scheduling-flow'</span>, { leadId: lead.id });
  }
}
                </div>

                <h4>14.10 ComparaÃ§Ã£o: Waha vs Notifica.me</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Recurso</th>
                            <th>Waha (WhatsApp)</th>
                            <th>Notifica.me</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Canais</strong></td>
                            <td>WhatsApp</td>
                            <td>Instagram, Facebook, WebChat, Email</td>
                        </tr>
                        <tr>
                            <td><strong>Oficial</strong></td>
                            <td>NÃ£o oficial</td>
                            <td>APIs oficiais Meta</td>
                        </tr>
                        <tr>
                            <td><strong>Custo</strong></td>
                            <td>Self-hosted (grÃ¡tis)</td>
                            <td>Plano por canal</td>
                        </tr>
                        <tr>
                            <td><strong>Uso no Nexus</strong></td>
                            <td>Atendimento principal</td>
                            <td>Complementar (redes sociais)</td>
                        </tr>
                        <tr>
                            <td><strong>IntegraÃ§Ã£o</strong></td>
                            <td>Docker + API REST</td>
                            <td>API REST + OAuth</td>
                        </tr>
                    </tbody>
                </table>

                <h4>14.11 PrecificaÃ§Ã£o Sugerida nos Planos</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Plano Nexus</th>
                            <th>Notifica.me IncluÃ­do</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Essencial</td>
                            <td>âŒ NÃ£o disponÃ­vel</td>
                        </tr>
                        <tr>
                            <td>Profissional</td>
                            <td>1 canal (Instagram OU Facebook)</td>
                        </tr>
                        <tr>
                            <td>Empresarial</td>
                            <td>Todos os canais ilimitados</td>
                        </tr>
                        <tr>
                            <td>Enterprise</td>
                            <td>Todos + suporte dedicado</td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <h4>âš ï¸ Importante</h4>
                    <ul>
                        <li><strong>Credenciais Criptografadas:</strong> API Key deve ser armazenada com AES-256</li>
                        <li><strong>Webhook Secret:</strong> Sempre validar assinatura</li>
                        <li><strong>Rate Limits:</strong> Respeitar limites do Notifica.me</li>
                        <li><strong>Logs Detalhados:</strong> Registrar todas as chamadas para debug</li>
                        <li><strong>Fallback:</strong> Se Notifica.me cair, enfileirar mensagens</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ“š 15. Recursos Adicionais</h2>
            
            <h3>14.1 DocumentaÃ§Ã£o Oficial</h3>
            <ul style="line-height: 2;">
                <li>ğŸ”— <a href="https://docs.n8n.io" target="_blank">n8n Documentation</a></li>
                <li>ğŸ”— <a href="https://docs.typebot.io" target="_blank">Typebot Documentation</a></li>
                <li>ğŸ”— <a href="https://waha.devlike.pro" target="_blank">Waha Documentation</a></li>
                <li>ğŸ”— <a href="https://platform.openai.com/docs" target="_blank">OpenAI API Reference</a></li>
                <li>ğŸ”— <a href="https://www.rabbitmq.com/documentation.html" target="_blank">RabbitMQ Docs</a></li>
            </ul>

            <h3>14.2 VÃ­deos Tutoriais (Criar)</h3>
            <ul style="line-height: 2;">
                <li>ğŸ“¹ Como criar seu primeiro workflow no n8n</li>
                <li>ğŸ“¹ Configurando chatbot no Typebot</li>
                <li>ğŸ“¹ Conectando WhatsApp com Waha</li>
                <li>ğŸ“¹ Criando triggers personalizados</li>
                <li>ğŸ“¹ Usando IA para qualificar leads</li>
            </ul>

            <h3>14.3 Comunidade e Suporte</h3>
            <ul style="line-height: 2;">
                <li>ğŸ’¬ Discord da Nexus Atemporal</li>
                <li>ğŸ“§ suporte@nexusatemporal.com.br</li>
                <li>ğŸ“± WhatsApp: +55 11 9999-9999</li>
                <li>ğŸ“ Academia Nexus (treinamentos)</li>
            </ul>
        </div>

        <div class="section">
            <h2>ğŸ¯ 15. Roadmap Futuro</h2>
            
            <h3>Q1 2026</h3>
            <ul style="line-height: 2;">
                <li>âœ¨ Builder visual de workflows no CRM</li>
                <li>âœ¨ Marketplace de workflows da comunidade</li>
                <li>âœ¨ IntegraÃ§Ã£o com Instagram Direct</li>
                <li>âœ¨ IA para geraÃ§Ã£o de conteÃºdo de marketing</li>
            </ul>

            <h3>Q2 2026</h3>
            <ul style="line-height: 2;">
                <li>âœ¨ Assistente de voz (telefonia)</li>
                <li>âœ¨ AnÃ¡lise de imagens com IA (fotos antes/depois)</li>
                <li>âœ¨ PrediÃ§Ã£o de receita com Machine Learning</li>
                <li>âœ¨ AutomaÃ§Ã£o de pÃ³s-venda completa</li>
            </ul>

            <h3>Q3 2026</h3>
            <ul style="line-height: 2;">
                <li>âœ¨ Agente IA autÃ´nomo para vendas</li>
                <li>âœ¨ IntegraÃ§Ã£o com ERPs (Omie, Conta Azul)</li>
                <li>âœ¨ Marketplace de integraÃ§Ãµes</li>
                <li>âœ¨ API pÃºblica para desenvolvedores</li>
            </ul>
        </div>

        <div class="section">
            <p style="text-align: center; color: #666; margin-top: 40px; padding-top: 40px; border-top: 2px solid #e5e7eb;">
                <strong style="font-size: 1.2em; color: #8b5cf6;">Nexus Atemporal</strong><br>
                Sistema de AutomaÃ§Ãµes e IntegraÃ§Ãµes<br>
                DocumentaÃ§Ã£o TÃ©cnica v1.0 - Outubro 2025<br><br>
                <a href="mailto:contato@nexusatemporal.com.br" style="color: #8b5cf6;">contato@nexusatemporal.com.br</a><br>
                <a href="https://nexusatemporal.com.br" style="color: #8b5cf6;">https://nexusatemporal.com.br</a>
            </p>
        </div>

        <div class="button-container">
            <button class="button" onclick="window.print()">ğŸ“„ Baixar como PDF</button>
            <button class="button" onclick="alert('Entre em contato para agendar uma demo!')">ğŸš€ Agendar Demo</button>
        </div>
    </div>
</body>
</html>